(function(){var e=window.utils=window.utils||{};e.savePrefix="";e.save=function(a,c){"undefined"!==typeof Storage&&("object"==typeof c&&(c=JSON.stringify(c)),localStorage.setItem(e.savePrefix+a,c))};e.load=function(a,c){if("undefined"!==typeof Storage){var b=localStorage.getItem(e.savePrefix+a);if(null==b)return c;switch(typeof c){case "number":return Number(b);case "boolean":return"true"==b;case "object":return JSON.parse(b);default:return b}}};e.clearSave=function(){if("undefined"!==typeof Storage)for(var a in localStorage)localStorage.removeItem(a)};
e.lerp=function(a,c,b){return(1-b)*a+b*c};e.easeOutCubic=function(a,c,b,n){return b*((a=a/n-1)*a*a+1)+c};var h=!1;e.audioFixCheck=function(){try{!h&&createjs.WebAudioPlugin.context&&"suspended"===createjs.WebAudioPlugin.context.state&&createjs.WebAudioPlugin.context.resume(),h=!0}catch(a){console.error("There was an error while trying to resume the SoundJS Web Audio context..."),console.error(a)}};e.playSound=function(a){return(a=e.randomElement(a))?createjs.Sound.play(a.file,a):null};e.mouseOverSound=
null;e.setupSpriteButton=function(a,c,b,n,d,k){k=void 0===k?null:k;a.on("pressup",function(){(null==k||k())&&a.gotoAndPlay(c)});a.on("mouseout",function(){(null==k||k())&&a.gotoAndPlay(c)});a.on("mouseover",function(){if(null==k||k())a.gotoAndPlay(b),e.mouseOverSound&&e.playSound(e.mouseOverSound),null!=d&&d(a)});a.on("mousedown",function(){(null==k||k())&&a.gotoAndPlay(n)})};e.buttonify=function(a,c,b){a.setBounds(c.x,c.y,c.width,c.height);a.hitArea=new createjs.Shape;b(a.hitArea.graphics);a.alpha=
.5;a.on("mouseover",function(b){this.alpha=1},a);a.on("mouseout",function(b){this.alpha=.5},a)};e.createLabelButton=function(a,c){var b=new createjs.Text(a,c+"px monospace","#000"),n=b.getBounds();n.height+=5;e.buttonify(b,n,function(b){b.beginFill("#000");b.drawRect(n.x,n.y,n.width,n.height);b.endFill()});return b};e.createLabeledButton=function(a,c,b){var n=new createjs.Container;n.label=new createjs.Text(a,b+"px monospace","#000");n.addChild(n.label);"string"==typeof c&&(c={button:c});a=n.label.getBounds().width;
for(var d in c){var k=e.createLabelButton(c[d],b);k.x=a;n.addChild(k);n[d]=k;a+=k.getBounds().width}return n};e.makeTogglerFn=function(a,c,b,n){var d=function(d){a[c]=!a[c];e.save(n,a[c]);b.text=a[c]?"[ON]":"[OFF]"};e.load(n,!1)&&d({currentTarget:b});return d};e.format=function(){for(var a=arguments[0],c=1;c<arguments.length;++c)a=a.replace("{"+(c-1)+"}",arguments[c]);return a};e.isPortrait=!1;var v=null,y=null;e.setupWindowsResize=function(a,c){y=c||document.querySelector("canvas");v=a;e.resizeCanvas();
window.addEventListener("resize",e.resizeCanvas,!1)};e.resizeCanvas=function(){y.oncontextmenu=function(b){b.preventDefault()};var a=window.innerHeight,c=a*v;c>window.innerWidth&&(c=window.innerWidth,a=c/v);e.isPortrait=window.innerHeight>window.innerWidth;y.style.width=c+"px";y.style.height=a+"px";y.style.marginBottom=(window.innerHeight-c)/2+"px";y.style.marginLeft=(window.innerWidth-c)/2+"px"};e.getUrlParameters=function(){for(var a,c=/\+/g,b=/([^&=]+)=?([^&]*)/g,n=window.location.search.substring(1),
d={};a=b.exec(n);)d[decodeURIComponent(a[1].replace(c," "))]=decodeURIComponent(a[2].replace(c," "));return d};e.toStrRecurisve=function(a,c){var b;c=c||0;if("object"===typeof a){var n="";for(b=0;b<c;++b)n+="  ";b="\n"+n+"{\n";for(var d in a)b+=n+"  "+d+": "+e.toStrRecurisve(a[d],c+1);b+=n+"}\n"}else b=a+"\n";return b};e.randomInt=function(a,c){return Math.floor(Math.random()*(c-a+1))+a};e.randomElement=function(a){return 1==a.length?a[0]:a[e.randomInt(0,a.length-1)]};e.convertNumberToSprites=function(a,
c,b,n,d,k,e){for(var l=a,h=0==a?[0]:[];a<c&&0<l;)h[h.length]=l%10,l=Math.floor(l/10);a=0;for(c=b.length-1;0<=c;--c){var l=b[c],r;r=0==h.length?9:c>=h.length?0:h[c];l.gotoAndStop(k[r]);l.x=a;0<c&&(a+=d[r])}n.x=.5*(e-a)};e.playSound=function(a){return(a=e.randomElement(a))?createjs.Sound.play(a.file,a):null}})();var SoundsConfig={mainExtension:"ogg",alternateExtensions:["mp3"],bgm_game:[{file:"bgm_game",volume:.4,loop:-1}],bgm_menu:[{file:"bgm_menu",volume:.55,loop:-1}],fanfare_boss:[{file:"fanfare_boss",volume:1}],fanfare_win:[{file:"fanfare_win",volume:.9}],fanfare_lose:[{file:"fanfare_lose",volume:1}],button_click_back:[{file:"button_click_back",volume:.6}],button_click_ok:[{file:"button_click_ok",volume:.1}],button_over:[{file:"button_over",volume:.7}],character_move:[{file:"character_move",volume:.35}],
character_place:[{file:"character_place",volume:.3}],character_select:[{file:"character_select",volume:.3}],star_appear_1:[{file:"star_appear_1",volume:1}],star_appear_2:[{file:"star_appear_2",volume:1}],star_appear_3:[{file:"star_appear_3",volume:1}],character_6_shoot:[{file:"character_6_shoot_02",volume:.7},{file:"character_6_shoot_03",volume:.7}],boss_1_death:[{file:"boss1_death02",volume:.8}],boss_2_death:[{file:"boss2_death01",volume:.7}],boss_3_death:[{file:"enemy7_death01",volume:.5}],enemy_1_death:[{file:"enemy1_death01",
volume:1},{file:"enemy1_death03",volume:1}],enemy_2_death:[{file:"enemy2_death01",volume:1},{file:"enemy2_death02",volume:1}],enemy_3_death:[{file:"enemy3_death01",volume:.9},{file:"enemy3_death02",volume:.9}],enemy_4_death:[{file:"enemy4_death01",volume:.9},{file:"enemy4_death03",volume:.9}],enemy_5_death:[{file:"enemy5_death02",volume:.9},{file:"enemy5_death03",volume:.9}],enemy_6_death:[{file:"enemy6_death01",volume:.5},{file:"enemy6_death03",volume:.5}],enemy_7_death:[{file:"enemy7_death02",volume:.5},
{file:"enemy7_death03",volume:.5}],snowbal_hit:[{file:"snowbal_hit_01",volume:.8},{file:"snowbal_hit_02",volume:.8}],snowbal_throw:[{file:"snowbal_throw_01",volume:.6},{file:"snowbal_throw_03",volume:.6}],skill_attack_area:[{file:"skill_attack_area",volume:.2}],skill_laser:[{file:"skill_laser",volume:.8}],skill_laser_expl:[{file:"skill_laser_expl",volume:.8}],skill_shield_1:[{file:"skill_shield_1",volume:.8}],skill_shield_2:[{file:"skill_shield_2",volume:.8}],skill_slow_enemies:[{file:"skill_slow_enemies",
volume:.6}],skill_slow_players_1:[{file:"skill_slow_players_1",volume:.8}],skill_slow_players_2:[{file:"skill_slow_players_2",volume:.8}],skill_storm:[{file:"skill_storm",volume:.8}],skill_teleport:[{file:"skill_teleport",volume:1}],skill_speedup_in:[{file:"skill_speedup_in",volume:1}],skill_speedup_out:[{file:"skill_speedup_out",volume:1}]},MP3_Offsets={bgm_game:{startOffset:24,endOffset:57},bgm_menu:{startOffset:37}};var CharacterConfig={char_1:{name:"gumball",sprite:"character_1",shootSFX:"snowbal_throw",hitSFX:"snowbal_hit",shootOffset:{x:17,y:15},color:{r:97,g:203,b:225},unlockLevel:-1,levels:[{cost:0,walkSpeed:3,attackTime:3,attackStrength:5,attackRange:2.5,skill:null},{cost:8,walkSpeed:3,attackTime:2.5,attackStrength:7,attackRange:2.5,skill:null},{cost:14,walkSpeed:3,attackTime:2.5,attackStrength:10,attackRange:3,skill:null},{cost:22,walkSpeed:4,attackTime:2,attackStrength:14,attackRange:3.5,skill:null},
{cost:32,walkSpeed:4,attackTime:2,attackStrength:20,attackRange:3.5,skill:null}]},char_2:{name:"darwin",sprite:"character_2",shootSFX:"snowbal_throw",hitSFX:"snowbal_hit",shootOffset:{x:25,y:22},color:{r:243,g:112,b:32},unlockLevel:0,levels:[{cost:0,walkSpeed:3,attackTime:2.5,attackStrength:5,attackRange:2.5,skill:null},{cost:8,walkSpeed:3,attackTime:2,attackStrength:7,attackRange:2.5,skill:null},{cost:14,walkSpeed:3,attackTime:1.3,attackStrength:7,attackRange:3,skill:null},{cost:22,walkSpeed:4,attackTime:1.3,
attackStrength:10,attackRange:3.5,skill:null},{cost:32,walkSpeed:4,attackTime:1.3,attackStrength:14,attackRange:3.5,skill:null}]},char_3:{name:"anais",sprite:"character_3",shootSFX:"snowbal_throw",hitSFX:"skill_slow_enemies",shootOffset:{x:14,y:14},color:{r:253,g:185,b:196},unlockLevel:1,levels:[{cost:0,walkSpeed:2,attackTime:2.7,attackStrength:3,attackRange:2.5,skill:"slowball_1"},{cost:8,walkSpeed:2,attackTime:2.3,attackStrength:5,attackRange:2.5,skill:"slowball_1"},{cost:14,walkSpeed:3,attackTime:1.8,
attackStrength:5,attackRange:3,skill:"slowball_2"},{cost:22,walkSpeed:3,attackTime:1.6,attackStrength:7,attackRange:3.5,skill:"slowball_2"},{cost:32,walkSpeed:3,attackTime:1.6,attackStrength:10,attackRange:3.5,skill:"slowball_3"}]},char_4:{name:"masami",sprite:"character_4",shootSFX:"skill_storm",hitSFX:"snowbal_hit",shootOffset:{x:0,y:0},color:{r:255,g:255,b:255},unlockLevel:3,levels:[{cost:0,walkSpeed:1.5,attackTime:5,attackStrength:2,attackRange:3,skill:"storm_1"},{cost:8,walkSpeed:1.5,attackTime:5,
attackStrength:4,attackRange:3,skill:"storm_1"},{cost:14,walkSpeed:2,attackTime:5,attackStrength:6,attackRange:3.5,skill:"storm_2"},{cost:22,walkSpeed:2,attackTime:3,attackStrength:8,attackRange:3.5,skill:"storm_2"},{cost:32,walkSpeed:2,attackTime:2.5,attackStrength:10,attackRange:4,skill:"storm_3"}]},char_5:{name:"penny",sprite:"character_5",shootSFX:"snowbal_throw",hitSFX:"snowbal_hit",shootOffset:{x:27,y:21},color:{r:254,g:219,b:28},unlockLevel:5,levels:[{cost:0,walkSpeed:2,attackTime:2.5,attackStrength:4,
attackRange:2.5,skill:"speed_aura_1"},{cost:8,walkSpeed:2,attackTime:2,attackStrength:6,attackRange:2.5,skill:"speed_aura_1"},{cost:14,walkSpeed:3,attackTime:1.3,attackStrength:7,attackRange:3,skill:"speed_aura_2"},{cost:22,walkSpeed:3,attackTime:1.3,attackStrength:10,attackRange:3.5,skill:"speed_aura_2"},{cost:32,walkSpeed:3,attackTime:1.3,attackStrength:12,attackRange:3.5,skill:"speed_aura_3"}]},char_6:{name:"ocho",sprite:"character_6",shootSFX:"character_6_shoot",hitSFX:"snowbal_hit",shootOffset:{x:0,
y:22},color:{r:37,g:36,b:36},unlockLevel:7,levels:[{cost:0,walkSpeed:0,attackTime:5,attackStrength:10,attackRange:2.5,skill:"teleport"},{cost:8,walkSpeed:0,attackTime:5,attackStrength:13,attackRange:2.5,skill:"teleport"},{cost:14,walkSpeed:0,attackTime:5,attackStrength:15,attackRange:3.5,skill:"teleport"},{cost:22,walkSpeed:0,attackTime:3,attackStrength:17,attackRange:3.5,skill:"teleport"},{cost:32,walkSpeed:0,attackTime:2.5,attackStrength:20,attackRange:3.5,skill:"teleport"}]},char_7:{name:"tobias",
sprite:"character_7",shootSFX:"snowbal_throw",hitSFX:"skill_attack_area",shootOffset:{x:37,y:26},color:{r:231,g:127,b:105},unlockLevel:9,levels:[{cost:0,walkSpeed:2,attackTime:5,attackStrength:10,attackRange:2.5,skill:"attack_area"},{cost:8,walkSpeed:2,attackTime:5,attackStrength:10,attackRange:3,skill:"attack_area"},{cost:14,walkSpeed:3,attackTime:5,attackStrength:15,attackRange:3.5,skill:"attack_area"},{cost:22,walkSpeed:3,attackTime:3,attackStrength:15,attackRange:3.5,skill:"attack_area"},{cost:32,
walkSpeed:3,attackTime:2.5,attackStrength:15,attackRange:3.5,skill:"attack_area"}]},char_8:{name:"bobert",sprite:"character_8",shootSFX:"skill_laser",hitSFX:"skill_laser_expl",shootOffset:{x:8,y:23},color:{r:126,g:134,b:150},unlockLevel:11,levels:[{cost:0,walkSpeed:4,attackTime:5,attackStrength:20,attackRange:2.5,skill:"laser"},{cost:8,walkSpeed:4,attackTime:5,attackStrength:20,attackRange:2.5,skill:"laser"},{cost:14,walkSpeed:5,attackTime:5,attackStrength:20,attackRange:3.5,skill:"laser"},{cost:22,
walkSpeed:5,attackTime:3,attackStrength:20,attackRange:3.5,skill:"laser"},{cost:32,walkSpeed:5,attackTime:2.5,attackStrength:20,attackRange:3.5,skill:"laser"}]}};var EnemyConfig={enemy_2:{sprite:"enemy_2",walkSpeed:.75,health:13,skill:null},enemy_5:{sprite:"enemy_5",walkSpeed:.75,health:26,skill:"spawn_minion"},enemy_1:{sprite:"enemy_1",walkSpeed:1.1,health:7,skill:null},boss_1:{sprite:"boss_1",walkSpeed:.67,health:80,skill:null},enemy_4:{sprite:"enemy_4",walkSpeed:1.25,health:25,skill:null},enemy_3:{sprite:"enemy_3",walkSpeed:.75,health:85,skill:null},boss_2:{sprite:"boss_2",walkSpeed:.75,health:130,skill:"slow_players_2"},enemy_6:{sprite:"enemy_6",walkSpeed:1.5,
health:60,skill:"slow_players_1"},enemy_7:{sprite:"enemy_7",walkSpeed:1.5,health:45,skill:"shield_1"},boss_3:{sprite:"boss_3",walkSpeed:.75,health:130,skill:"shield_2"}};var LevelConfig=[{map:"map0",stars:[5,5,3,0],waves:[{time:5,enemy:"enemy_2",count:1,path:"A"},{time:5,enemy:"enemy_2",count:1,path:"A"},{time:10,enemy:"enemy_2",count:2,path:"A"},{time:10,enemy:"enemy_2",count:2,path:"A"}]},{map:"map0",stars:[6,6,4,0],waves:[{time:5,enemy:"enemy_2",count:1,path:"A"},{time:1,enemy:"enemy_2",count:1,path:"A"},{time:10,enemy:"enemy_2",count:2,path:"A"},{time:1,enemy:"enemy_2",count:1,path:"A"},{time:10,enemy:"enemy_2",count:2,path:"A"},{time:1,enemy:"enemy_2",count:2,
path:"A"}]},{map:"map0",stars:[8,8,4,0],waves:[{time:3,enemy:"enemy_2",count:2,path:"A"},{time:5,enemy:"enemy_5",count:1,path:"A"},{time:10,enemy:"enemy_2",count:3,path:"A"},{time:5,enemy:"enemy_2",count:2,path:"A"},{time:15,enemy:"enemy_2",count:3,path:"A"},{time:10,enemy:"enemy_5",count:1,path:"A"},{time:1,enemy:"enemy_2",count:2,path:"A"}]},{map:"map0",stars:[9,9,4,0],waves:[{time:5,enemy:"enemy_5",count:1,path:"A"},{time:5,enemy:"enemy_2",count:2,path:"A"},{time:3,enemy:"enemy_2",count:2,path:"A"},
{time:15,enemy:"enemy_5",count:1,path:"A"},{time:5,enemy:"enemy_2",count:2,path:"A"},{time:3,enemy:"enemy_2",count:1,path:"A"},{time:10,enemy:"enemy_5",count:1,path:"A"},{time:5,enemy:"enemy_2",count:3,path:"A"},{time:3,enemy:"enemy_2",count:3,path:"A"}]},{map:"map0",stars:[8,8,4,0],waves:[{time:1,enemy:"enemy_2",count:3,path:"A"},{time:10,enemy:"enemy_2",count:3,path:"A"},{time:3,enemy:"enemy_5",count:1,path:"A"},{time:3,enemy:"enemy_2",count:3,path:"A"},{time:35,enemy:"boss_1",count:1,path:"A"},
{time:2,enemy:"enemy_2",count:3,path:"A"}]},{map:"map1",stars:[10,10,5,0],waves:[{time:1,enemy:"enemy_5",count:2,path:"A"},{time:1,enemy:"enemy_5",count:1,path:"A"},{time:5,enemy:"enemy_5",count:2,path:"A"},{time:2,enemy:"enemy_4",count:2,path:"A"},{time:.5,enemy:"enemy_4",count:2,path:"A"},{time:15,enemy:"enemy_5",count:2,path:"A"},{time:3,enemy:"enemy_4",count:2,path:"A"},{time:.5,enemy:"enemy_4",count:3,path:"A"}]},{map:"map1",stars:[12,12,5,0],waves:[{time:3,enemy:"enemy_4",count:2,path:"A"},
{time:.5,enemy:"enemy_4",count:1,path:"A"},{time:.5,enemy:"enemy_4",count:2,path:"A"},{time:20,enemy:"enemy_4",count:1,path:"A"},{time:.5,enemy:"enemy_4",count:3,path:"A"},{time:.5,enemy:"enemy_4",count:2,path:"A"},{time:15,enemy:"enemy_4",count:3,path:"A"},{time:.5,enemy:"enemy_4",count:2,path:"A"},{time:.5,enemy:"enemy_4",count:1,path:"A"},{time:5,enemy:"enemy_4",count:3,path:"A"},{time:.5,enemy:"enemy_4",count:2,path:"A"}]},{map:"map1",stars:[13,13,5,0],waves:[{time:1,enemy:"enemy_4",count:2,path:"A"},
{time:1,enemy:"enemy_4",count:3,path:"A"},{time:5,enemy:"enemy_5",count:3,path:"A"},{time:2,enemy:"enemy_3",count:1,path:"A"},{time:15,enemy:"enemy_5",count:2,path:"A"},{time:1,enemy:"enemy_4",count:2,path:"A"},{time:1,enemy:"enemy_3",count:1,path:"A"},{time:1,enemy:"enemy_4",count:2,path:"A"},{time:10,enemy:"enemy_5",count:1,path:"A"},{time:3,enemy:"enemy_4",count:3,path:"A"},{time:10,enemy:"enemy_5",count:1,path:"A"},{time:.5,enemy:"enemy_5",count:1,path:"A"}]},{map:"map1",stars:[14,14,5,0],waves:[{time:0,
enemy:"enemy_3",count:2,path:"A"},{time:5,enemy:"enemy_4",count:5,path:"A"},{time:20,enemy:"enemy_3",count:5,path:"A"},{time:.5,enemy:"enemy_5",count:2,path:"A"},{time:5,enemy:"enemy_4",count:5,path:"A"},{time:10,enemy:"enemy_3",count:3,path:"A"},{time:1,enemy:"enemy_3",count:2,path:"A"},{time:2,enemy:"enemy_5",count:1,path:"A"},{time:5,enemy:"enemy_4",count:2,path:"A"},{time:1,enemy:"enemy_4",count:2,path:"A"}]},{map:"map1",stars:[14,14,5,0],waves:[{time:1,enemy:"enemy_4",count:1,path:"A"},{time:.5,
enemy:"enemy_4",count:2,path:"A"},{time:5,enemy:"enemy_3",count:2,path:"A"},{time:15,enemy:"enemy_5",count:3,path:"A"},{time:10,enemy:"enemy_4",count:3,path:"A"},{time:1,enemy:"enemy_5",count:3,path:"A"},{time:1,enemy:"enemy_4",count:2,path:"A"},{time:10,enemy:"enemy_5",count:1,path:"A"},{time:2,enemy:"enemy_4",count:2,path:"A"},{time:0,enemy:"boss_2",count:1,path:"A"},{time:10,enemy:"enemy_4",count:3,path:"A"}]},{map:"map2",stars:[8,8,3,0],waves:[{time:1,enemy:"enemy_5",count:2,path:"A"},{time:5,
enemy:"enemy_3",count:1,path:"B"},{time:.5,enemy:"enemy_5",count:1,path:"B"},{time:5,enemy:"enemy_6",count:1,path:"B"},{time:5,enemy:"enemy_3",count:2,path:"A"},{time:5,enemy:"enemy_3",count:3,path:"A"},{time:.5,enemy:"enemy_3",count:2,path:"B"},{time:30,enemy:"enemy_6",count:1,path:"B"},{time:.8,enemy:"enemy_6",count:2,path:"A"}]},{map:"map2",stars:[13,13,5,0],waves:[{time:1,enemy:"enemy_6",count:3,path:"A"},{time:.4,enemy:"enemy_6",count:2,path:"B"},{time:2,enemy:"enemy_5",count:2,path:"A"},{time:1,
enemy:"enemy_5",count:1,path:"B"},{time:1,enemy:"enemy_5",count:2,path:"A"},{time:10,enemy:"enemy_3",count:2,path:"B"},{time:1,enemy:"enemy_3",count:3,path:"A"},{time:1,enemy:"enemy_3",count:1,path:"A"},{time:25,enemy:"enemy_6",count:3,path:"A"},{time:.4,enemy:"enemy_6",count:2,path:"B"}]},{map:"map2",stars:[9,9,4,0],waves:[{time:0,enemy:"enemy_5",count:1,path:"A"},{time:.4,enemy:"enemy_5",count:2,path:"A"},{time:.4,enemy:"enemy_5",count:1,path:"A"},{time:5,enemy:"enemy_7",count:1,path:"B"},{time:.7,
enemy:"enemy_7",count:1,path:"A"},{time:1,enemy:"enemy_3",count:2,path:"A"},{time:.4,enemy:"enemy_5",count:1,path:"A"},{time:.4,enemy:"enemy_5",count:1,path:"A"},{time:.4,enemy:"enemy_5",count:1,path:"A"},{time:5,enemy:"enemy_7",count:1,path:"A"},{time:1,enemy:"enemy_7",count:1,path:"B"}]},{map:"map2",stars:[12,12,5,0],waves:[{time:3,enemy:"enemy_7",count:1,path:"A"},{time:1,enemy:"enemy_7",count:2,path:"A"},{time:1,enemy:"enemy_7",count:1,path:"B"},{time:15,enemy:"enemy_7",count:2,path:"A"},{time:1,
enemy:"enemy_7",count:3,path:"A"},{time:1,enemy:"enemy_7",count:2,path:"B"},{time:20,enemy:"enemy_7",count:1,path:"A"},{time:1,enemy:"enemy_7",count:1,path:"A"},{time:1,enemy:"enemy_7",count:2,path:"B"},{time:1,enemy:"enemy_7",count:2,path:"A"},{time:15,enemy:"enemy_7",count:1,path:"B"},{time:1,enemy:"enemy_7",count:1,path:"B"},{time:1,enemy:"enemy_7",count:2,path:"A"}]},{map:"map2",stars:[12,12,5,0],waves:[{time:5,enemy:"enemy_6",count:1,path:"A"},{time:1,enemy:"enemy_6",count:2,path:"A"},{time:1,
enemy:"enemy_6",count:1,path:"A"},{time:10,enemy:"enemy_7",count:3,path:"A"},{time:.7,enemy:"enemy_7",count:2,path:"B"},{time:3,enemy:"enemy_3",count:2,path:"A"},{time:1,enemy:"enemy_3",count:1,path:"A"},{time:4,enemy:"enemy_5",count:2,path:"B"},{time:.7,enemy:"enemy_5",count:3,path:"A"},{time:8,enemy:"boss_3",count:1,path:"A"},{time:13,enemy:"enemy_7",count:2,path:"B"},{time:.5,enemy:"enemy_7",count:1,path:"A"},{time:5,enemy:"enemy_6",count:2,path:"A"}]}];var SkillsConfig={storm_1:{duration:1.5,cooldown:0,strength:1,range:3},storm_2:{duration:2,cooldown:0,strength:1.5,range:3.5},storm_3:{duration:2.5,cooldown:0,strength:2,range:4},slowball_1:{duration:2,cooldown:0,strength:.9,range:.5},slowball_2:{duration:3,cooldown:0,strength:.7,range:.8},slowball_3:{duration:3,cooldown:0,strength:.5,range:1},speed_aura_1:{duration:0,cooldown:0,strength:.2,range:4},speed_aura_2:{duration:0,cooldown:0,strength:.4,range:6},speed_aura_3:{duration:0,cooldown:0,strength:.6,
range:8},attack_area:{duration:0,cooldown:0,strength:0,range:0},laser:{duration:0,cooldown:0,strength:0,range:0},teleport:{duration:0,cooldown:0,strength:0,range:0},shield_1:{duration:3,cooldown:5,strength:0,range:0},shield_2:{duration:4,cooldown:3,strength:0,range:0},spawn_minion:{duration:0,cooldown:0,strength:0,range:0},slow_players_1:{duration:4,cooldown:6,strength:.1,range:4},slow_players_2:{duration:6,cooldown:5,strength:.3,range:6}};(function(e){"object"===typeof module&&"object"===typeof module.exports?module.exports=e():"function"===typeof define&&define.amd?define([],e):(e=e(),window.astar=e.astar,window.Graph=e.Graph)})(function(){function e(b){for(var a=[];b.parent;)a.unshift(b),b=b.parent;return a}function h(){return new a(function(b){return b.f})}function v(b,a){a=a||{};this.nodes=[];this.diagonal=!!a.diagonal;this.grid=[];for(var d=0;d<b.length;d++){this.grid[d]=[];for(var c=0,n=b[d];c<n.length;c++){var e=new y(d,c,n[c]);
this.grid[d][c]=e;this.nodes.push(e)}}this.init()}function y(b,a,d){this.x=b;this.y=a;this.weight=d}function a(b){this.content=[];this.scoreFunction=b}var c={search:function(b,a,d,k){b.cleanDirty();k=k||{};var n=k.heuristic||c.heuristics.manhattan;k=k.closest||!1;var l=h(),t=a;a.h=n(a,d);b.markDirty(a);for(l.push(a);0<l.size();){a=l.pop();if(a===d)return e(a);a.closed=!0;for(var v=b.neighbors(a),y=0,L=v.length;y<L;++y){var A=v[y];if(!A.closed&&!A.isWall()){var C=a.g+A.getCost(a),p=A.visited;if(!p||
C<A.g)A.visited=!0,A.parent=a,A.h=A.h||n(A,d),A.g=C,A.f=A.g+A.h,b.markDirty(A),k&&(A.h<t.h||A.h===t.h&&A.g<t.g)&&(t=A),p?l.rescoreElement(A):l.push(A)}}}return k?e(t):[]},heuristics:{manhattan:function(b,a){return Math.abs(a.x-b.x)+Math.abs(a.y-b.y)},diagonal:function(b,a){var d=Math.abs(a.x-b.x),c=Math.abs(a.y-b.y);return 1*(d+c)+(Math.sqrt(2)-2)*Math.min(d,c)}},cleanNode:function(b){b.f=0;b.g=0;b.h=0;b.visited=!1;b.closed=!1;b.parent=null}};v.prototype.init=function(){this.dirtyNodes=[];for(var b=
0;b<this.nodes.length;b++)c.cleanNode(this.nodes[b])};v.prototype.cleanDirty=function(){for(var b=0;b<this.dirtyNodes.length;b++)c.cleanNode(this.dirtyNodes[b]);this.dirtyNodes=[]};v.prototype.markDirty=function(b){this.dirtyNodes.push(b)};v.prototype.neighbors=function(b){var a=[],d=b.x;b=b.y;var c=this.grid;c[d-1]&&c[d-1][b]&&a.push(c[d-1][b]);c[d+1]&&c[d+1][b]&&a.push(c[d+1][b]);c[d]&&c[d][b-1]&&a.push(c[d][b-1]);c[d]&&c[d][b+1]&&a.push(c[d][b+1]);this.diagonal&&(c[d-1]&&c[d-1][b-1]&&a.push(c[d-
1][b-1]),c[d+1]&&c[d+1][b-1]&&a.push(c[d+1][b-1]),c[d-1]&&c[d-1][b+1]&&a.push(c[d-1][b+1]),c[d+1]&&c[d+1][b+1]&&a.push(c[d+1][b+1]));return a};v.prototype.toString=function(){for(var b=[],a=this.grid,c=0;c<a.length;c++){for(var e=[],h=a[c],l=0;l<h.length;l++)e.push(h[l].weight);b.push(e.join(" "))}return b.join("\n")};y.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};y.prototype.getCost=function(b){return b&&b.x!=this.x&&b.y!=this.y?1.41421*this.weight:this.weight};y.prototype.isWall=
function(){return 0===this.weight};a.prototype={push:function(b){this.content.push(b);this.sinkDown(this.content.length-1)},pop:function(){var b=this.content[0],a=this.content.pop();0<this.content.length&&(this.content[0]=a,this.bubbleUp(0));return b},remove:function(b){var a=this.content.indexOf(b),c=this.content.pop();a!==this.content.length-1&&(this.content[a]=c,this.scoreFunction(c)<this.scoreFunction(b)?this.sinkDown(a):this.bubbleUp(a))},size:function(){return this.content.length},rescoreElement:function(b){this.sinkDown(this.content.indexOf(b))},
sinkDown:function(b){for(var a=this.content[b];0<b;){var c=(b+1>>1)-1,e=this.content[c];if(this.scoreFunction(a)<this.scoreFunction(e))this.content[c]=a,this.content[b]=e,b=c;else break}},bubbleUp:function(b){for(var a=this.content.length,c=this.content[b],e=this.scoreFunction(c);;){var h=b+1<<1,l=h-1,t=null,v;l<a&&(v=this.scoreFunction(this.content[l]),v<e&&(t=l));h<a&&this.scoreFunction(this.content[h])<(null===t?e:v)&&(t=h);if(null!==t)this.content[b]=this.content[t],this.content[t]=c,b=t;else break}}};
return{astar:c,Graph:v}});(function(){function e(b){b=b.currentTarget;var a=b.troop;switch(G){case F.PLACING:w==a&&(G=F.NORMAL,x.removeChild(a),I.removeChild(a.rangeMarker),b.text="\n"+a.id+"\n",utils.playSound(SoundsConfig.button_click_back),H.visible=!1);break;case F.NORMAL:if(a.state==B.LIMBO)for(S||1!=O||J({x:580,y:55},65,180),G=F.PLACING,a.gotoAndPlay("idle_down"),a.attackTimer=0,x.addChild(a),I.addChild(a.rangeMarker),b.text="\nCancel\n",b.notSpawned.gotoAndPlay("hud_portrait_btn_down"),a.rangeMarker.x=H.x=a.x=main.stage.mouseX,
a.rangeMarker.y=H.y=a.y=main.stage.mouseY,H.visible=!0,H.gotoAndPlay("character_select"),w=a,utils.playSound(SoundsConfig.character_select),b=P.length-1;0<=b;--b)a=P[b],a.highlight.visible=null==a.troop}}function h(b){b=b.image;var a=b.lastIndexOf("/"),c=b.lastIndexOf("."),g=new p.Sprite(ss.paths);g.gotoAndStop(b.substring(a+1,c));return g}function v(){for(var b=0,a=Q.waves.length-1;a>=aa;--a)b+=Q.waves[a].count,"enemy_5"==Q.waves[a].enemy&&(b+=Q.waves[a].count);for(a=Z.length-1;0<=a;--a)++b,"spawn_minion"==
Z[a].pool[0].config.skill&&++b;for(a=M.length-1;0<=a;--a){++b;var c=M[a];null!=c.config.skill&&"spawn_minion"==c.config.skill&&++b}10>b?(ba.visible=!1,E.gotoAndPlay("hud_counter_"+b),E.x=6):(ba.visible=!0,E.x=15,100<=b?(E.gotoAndPlay("hud_counter_9"),ba.gotoAndPlay("hud_counter_9")):10<=b&&(a=Math.floor(b/10),E.gotoAndPlay("hud_counter_"+b%10),ba.gotoAndPlay("hud_counter_"+a)))}function y(){0<=K&&3>=K&&(1==K?Y.gotoAndPlay("hud_stars_1_alert"):(Y.gotoAndPlay("hud_stars_"+K),ha=.5))}function a(b,a){b.currentAnimation!=
a&&"special"!=b.currentAnimation&&(b.gotoAndPlay(a),b.currentAnimationFrame=utils.randomInt(0,b.spriteSheet.getAnimation(a).frames.length-1))}function c(b,a,c){return b.y>a.y?1:b.y<a.y?-1:b.x>a.x?1:0}function b(b,c,U,g,d,f,e){if(0!=f){var D=!1;c+=g;U+=d;d=c-b.x;g=U-b.y;var ma=Math.sqrt(d*d+g*g);f*=e;ma>f?(d/=ma,g/=ma,b.x+=d*f,b.y+=g*f,0<d?b.scaleX=1:0>d&&(b.scaleX=-1),0>g?a(b,"walk_up"):a(b,"walk_down")):(b.x=c,b.y=U,D=!0);return D}}function n(a){var c=a.pool.pop();c.pathIdx=a.pathIdx;c.xOffset=u.radius*
Math.random()-u.radiusHalf;c.path=a.path;c.x=a.pos.x+c.xOffset;c.yOffset=u.radius*Math.random()-u.radiusHalf;c.y=a.pos.y+c.yOffset;b(c,c.path[c.pathIdx].x,c.path[c.pathIdx].y,c.xOffset,c.yOffset,c.config.walkSpeed,.01);I.addChild(c.healthBar);d(c,c.config.health);x.addChild(c);c.shieldFX&&(x.addChild(c.shieldFX),c.shieldFX.gotoAndPlay("fx_end"),c.shieldTime=-1,c.skillCooldown=SkillsConfig[c.config.skill].cooldown,c.skillCooldown*=1.5+Math.random());M.push(c);c.isBoss&&(utils.playSound(SoundsConfig.fanfare_boss),
V.visible=!0)}function d(b,a){b.health=a;var c=0>a?0:a/b.config.health,g=Math.floor(utils.lerp(0,255,p.Ease.sineIn(c))),d=255-g;b.healthBar.graphics.clear().beginFill(p.Graphics.getRGB(d,g,0)).drawRect(0,0,b.healthBar.maxSize*c,5);b.isBoss&&(V.bar.scaleX=c,V.bar.x=(1-c)*main.stage.canvas.width*.5)}function k(b,a){(null==b.config.skill||0>b.config.skill.indexOf("shield")||0>=b.shieldTime)&&d(b,b.health-a)}function r(b,a,c,g,d){g=void 0===g?0:g;d=void 0===d?0:d;for(var f=[],U=a.length-1;0<=U;--U){var e=
a[U];e.parent&&t(e,b,g,d)<c&&f.push(e)}return f}function l(b,a,c,g,d){g=void 0===g?0:g;d=void 0===d?0:d;for(var f=null,U=999999,e=a.length-1;0<=e;--e){var D=a[e],na=t(D,b,g,d);na<c&&(null==f||na<U)&&(f=D,U=na)}return f}function t(b,a,c,g){c=void 0===c?0:c;g=void 0===g?0:g;c=b.x-a.x+(void 0===c?0:c);b=b.y-a.y+(void 0===g?0:g);return c*c+b*b}function R(b){x.removeChild(b);b.pool.push(b);b.slowEffectRemainingTime=0;b.slowEffectFactor=0;b.damageOverTime=null;b.framerate=b.spriteSheet.framerate;b.healthBar.parent&&
I.removeChild(b.healthBar);b.shieldFX&&x.removeChild(b.shieldFX);b.slowFX&&(x.removeChild(b.slowFX),W.push(b.slowFX),b.slowFX=null)}function J(b,a,c){++O;L(b,a,c);z.message.gotoAndPlay("tutorial_0"+O);switch(O){case X.ENEMY_INFO:z.okBtn.visible=!0;z.okBtn.y=-110;break;case X.STARS_AND_LEVEL_UP:z.okBtn.visible=!0;z.okBtn.y=-110;break;default:z.okBtn.visible=!1}O==X.MOVEMENT?(z.message.x=-210,z.message.y=-150):(z.message.x=0,z.message.y=0);N.addChild(z)}function L(b,a,c){z.highlight.graphics.clear();
z.highlight.graphics.beginRadialGradientFill(["rgba(0,0,0,0)","rgba(0,0,0,1)"],[.6,1],b.x,b.y,0,b.x,b.y,a);z.highlight.graphics.drawRect(0,0,main.stage.canvas.width,main.stage.canvas.height);z.highlight.cache(0,0,main.stage.canvas.width,main.stage.canvas.height);z.overlay.cache(0,0,main.stage.canvas.width,main.stage.canvas.height);z.arrow.x=b.x;z.arrow.y=b.y;z.arrow.rotation=c}function A(){S||O!=X.MOVEMENT||(J({x:400,y:550},120,-90),z.arrow.x-=50)}var C=window.game=window.game||{},p=window.createjs,
u={waitTime:.5,radius:40},F={NORMAL:0,PLACING:1,RELOCATING:2},B={LIMBO:-1,NORMAL:0,SHOOT:1,RECOVERY:2,MOVING:3},G=F.NORMAL,N=C.container=new p.Container,I=new p.Container,m=null,x=null,ja=new p.Shape,ca=!1,ia=null,H=null,Y=null,oa=null,ta=null,ba=null,E=null,V=null,T=[],pa=[],P=[],w=null,qa={},M=[],da=[],ra=null,ka=null,W=[],Q=null,K=0,aa=0,ga=0,Z=[],la=0,ea=0,sa={x:0,y:0},fa=null,S=!0;C.init=function(){fa=utils.playSound(SoundsConfig.bgm_game);fa.stop();debug&&debug.muteBGM&&(fa.muted=!0);z=new p.Container;
z.arrow=main.createScreenItem("tutorial","tutorial_arrow");z.message=main.createScreenItem("locale","tutorial_01");z.highlight=new p.Shape;z.highlight.cache();z.overlay=new p.Shape;z.overlay.alpha=.5;z.overlay.graphics.beginFill("black");z.overlay.graphics.drawRect(-1,-1,main.stage.canvas.width+1,main.stage.canvas.height+1);z.overlay.graphics.endFill();z.overlay.filters=[new p.AlphaMaskFilter(z.highlight.cacheCanvas)];debug&&z.overlay.addEventListener("click",function(){console.log(main.stage.mouseX,
main.stage.mouseY)});z.okBtn=main.createScreenItem("character_selection_levelup_unlock","btn_continue_idle");utils.setupSpriteButton(z.okBtn,"btn_continue_idle","btn_continue_over","btn_continue_down");z.okBtn.addEventListener("click",function(b){O==X.ENEMY_INFO?J(T[0],60,180):N.removeChild(z)});z.addChild(z.overlay,z.message,z.arrow,z.okBtn);N.visible=!1;ja.graphics.beginFill("black").drawRect(0,0,main.stage.canvas.width,main.stage.canvas.height).endFill();ja.alpha=.01;ja.on("click",function(b){ca=
!0});for(var b=0;15>b;++b){var a={highlight:main.createScreenItem("ui","slot_free"),fg:main.createScreenItem("ui","slot_fg"),bg:main.createScreenItem("ui","slot_bg")};pa.push(a)}for(var c in SkillsConfig)b=SkillsConfig[c],b.range*=40,b.range*=b.range;for(var g in EnemyConfig)for(c=qa[g]=[],a=EnemyConfig[g],a.walkSpeed*=40,a.isBoss=0<=a.sprite.indexOf("boss"),b=50;0<=b;--b){var d=new p.Sprite(ss[a.sprite]);d.config=a;d.isBoss=a.isBoss;d.pool=c;d.healthBar=new p.Shape;d.healthBar.maxSize=20;d.deathSFX=
SoundsConfig[g+"_death"];null!=a.skill&&(0<=a.skill.indexOf("shield")?(d.shieldFX=new p.Sprite(ss[a.sprite]),d.shieldTime=0,d.skillCooldown=SkillsConfig[a.skill].cooldown):0<=a.skill.indexOf("slow_players")&&(d.skillCooldown=SkillsConfig[a.skill].cooldown));c.push(d)}for(b=35;0<=b;--b)g=new p.Sprite(ss.fx),W.push(g);u.radiusHalf=u.radius/2;ia=new p.Container;H=main.createScreenItem("ui","character_select");H.visible=!1;ia.addChild(H);g=main.createScreenItem("ui","btn_sfx_on_idle");main.registerSFXToggle(g);
V=new p.Container;V.bar=main.createScreenItem("ui","hud_boss_hp_bar");V.addChild(main.createScreenItem("ui","hud_boss_hp_bg"),V.bar);b=main.createScreenItem("ui","hud_pause_btn_idle");utils.setupSpriteButton(b,"hud_pause_btn_idle","hud_pause_btn_over","hud_pause_btn_down");b.addEventListener("click",function(b){menu.showPopup(menu.pausePopup)});Y=main.createScreenItem("ui","hud_stars_3");oa=main.createScreenItem("ui","hud_stars_flash_end");ta=main.createScreenItem("ui","hud_counter_bg");ba=main.createScreenItem("ui",
"hud_counter_8");--ba.y;E=main.createScreenItem("ui","hud_counter_8");--E.y;c=new p.Container;c.x=35;c.addChild(ta,ba,E);ia.addChild(main.createScreenItem("ui","hud_pause_bg"),Y,oa,c,g,b,V);g=0;for(var f in CharacterConfig){a=CharacterConfig[f];for(b=0;b<a.levels.length;++b)c=a.levels[b],c.walkSpeed*=40,c.attackRange*=40;b=ss[a.sprite];c=new p.Sprite(b);c.id=f;c.state=B.LIMBO;c.levels=a.levels;c.rangeMarker=main.createScreenItem("ui","ui_range");c.rangeMarker.filters=[new p.ColorFilter(a.color.r/
255,a.color.g/255,a.color.b/255)];d=c.rangeMarker.getBounds();c.rangeMarker.cache(d.x,d.y,d.width,d.height);c.shootSFX=a.shootSFX;c.hitSFX=a.hitSFX;c.shootOffset=a.shootOffset;T[g]=c;a=c.btn=new p.Container;a.troop=c;a.notSpawned=main.createScreenItem("ui","hud_portrait_btn_idle");a.highlight=main.createScreenItem("ui","hud_highlight");a.highlight.visible=!1;a.addChild(main.createScreenItem("ui","hud_portrait_"+(g+1)),a.highlight,a.notSpawned);ia.addChild(a);a.addEventListener("mouseover",function(b){return function(a){if(G!=
F.PLACING&&G!=F.RELOCATING||w==b.troop)b.notSpawned.gotoAndPlay("hud_portrait_btn_over"),b.highlight.visible=!0}}(a));a.addEventListener("mouseout",function(b){return function(a){G==F.PLACING&&w==b.troop?b.notSpawned.gotoAndPlay("hud_portrait_btn_down"):(b.notSpawned.gotoAndPlay("hud_portrait_btn_idle"),b.highlight.visible=!1)}}(a));var d=a.getBounds(),h=a.notSpawned.getBounds();a.hitArea=new p.Shape;a.hitArea.graphics.beginFill("#000");a.hitArea.graphics.drawRect(d.x,d.y,d.width,d.height);a.hitArea.graphics.drawRect(h.x,
h.y,h.width,h.height);a.troop=c;a.on("click",e);c.projectilePool=[];c.flyingProjectiles=[];c.hittingProjectiles=[];if(null==c.skill||0>c.skill.indexOf("storm"))for(a=25,"laser"==c.skill&&(a*=2);0<a--;)d=new p.Sprite(b),d.enemyHits=[],c.projectilePool.push(d);++g}};C.start=function(b,a){b>=LevelConfig.length&&(console.log("Level Index",b,"is invalid!. Starting Level Index",LevelConfig.length-1),b=LevelConfig.length-1);S=0!=b;fa.play();N.visible=!0;Q=LevelConfig[b];K=Q.stars.length-1;var c=tilemaps[Q.map];
m=new hb.Tilemap(c,h);ra=m.objectGroup.path;ka=c.walkArea;x=m.layers.game;m.addChildAt(I,m.getChildIndex(x));var c=m.objectGroup.foxholes,g;for(g in c){var d=c[g],f=pa.pop();f.x=d.x;f.y=d.y;f.troop=null;f.highlight.visible=!1;f.bg.x=f.fg.x=f.highlight.x=d.x+20;f.bg.y=f.fg.y=f.highlight.y=d.y+20;f.fg.y+=1;--f.highlight.y;f.bg.y-=2;x.addChild(f.bg,f.fg,f.highlight);P.push(f)}for(g=0;g<T.length;++g){c=T[g];c.state=B.LIMBO;c.fastRate=0;c.slowRate=0;c.slowTime=0;var d=c.levels[main.charactersLevel[c.id]],
e;for(e in d)c[e]=d[e];c.attackRangeSq=c.attackRange*c.attackRange;c.rangeMarker.scaleX=c.rangeMarker.scaleY=c.attackRange/160;d=S?a.indexOf(c.id):"char_1"==c.id?0:-1;0>main.charactersLevel[c.id]||0>d?(c.btn.mouseEnabled=!1,c.btn.visible=!1):(c.btn.mouseEnabled=!0,c.btn.visible=!0,c.btn.notSpawned.visible=!0,c.btn.notSpawned.gotoAndPlay("ui","hud_portrait_btn_idle"),c.btn.highlight.visible=!1,c.btn.x=10+d*c.btn.getBounds().width*1.1)}N.addChild(m);N.addChild(ja);N.addChild(ia);ga=aa=0;Z.length=0;
la=u.waitTime;ea=0;y();V.visible=!1;G=F.NORMAL;v();S||(O=Q.waves[aa].time=0,J({x:60,y:520},130,0))};C.update=function(a){if(S||null==z.parent)ga+=a;var d=aa>=Q.waves.length;if(!d){var e=Q.waves[aa];if(ga>=e.time){++aa;ga-=e.time;var g={};g.pool=qa[e.enemy];for(var h in ra){var f=ra[h];if(f.name===e.path){g.path=f.polyline;break}}g.pos=g.path[0];for(h=g.pathIdx=0;h<e.count;++h)Z.push(g)}else 0<aa&&0==Z.length&&0==M.length&&2<e.time-ga&&(ga=a+e.time-2)}for(h=da.length-1;0<=h;--h)f=da[h],"die_end"===
f.currentAnimation&&(da.splice(h,1),R(f),f.isBoss&&(V.visible=!1));if(0<Z.length&&(la-=a,0>=la)){la=u.waitTime;h=Z.pop();if(debug&&0==h.pool.length){console.log("ERROR: enemy pool empty!");return}n(h)}for(h=T.length-1;0<=h;--h)if(g=T[h],g.parent){g.slowTime-=a;0>=g.slowTime&&(g.slowRate=0,g.slowFX&&0<=g.slowFX.currentAnimation.indexOf("loop")&&g.slowFX.gotoAndPlay("fx_slow_out"));g.slowFX&&(g.slowFX.x=g.x,g.slowFX.y=g.y+2,0<=g.slowFX.currentAnimation.indexOf("end")&&(x.removeChild(g.slowFX),W.push(g.slowFX),
g.slowFX=null));g.fastFX&&0==g.fastRate&&0<=g.fastFX.currentAnimation.indexOf("loop")&&(g.fastFX.gotoAndPlay("fx_speedup_out"),utils.playSound(SoundsConfig.skill_speedup_out));g.fastFX&&(g.fastFX.x=g.x,g.fastFX.y=g.y+1,0<=g.fastFX.currentAnimation.indexOf("end")&&(x.removeChild(g.fastFX),W.push(g.fastFX),g.fastFX=null));e=1+g.fastRate-g.slowRate;g.rangeMarker.x=g.x;g.rangeMarker.y=g.y;g.rangeMarker.rotation+=10*a;0<g.attackTimer&&(g.attackTimer-=a*e);for(var m=g.flyingProjectiles.length-1;0<=m;--m){var q=
g.flyingProjectiles[m];q.x+=q.speedX*a;q.y+=q.speedY*a;var E=l(q,M,400,0,-15);if(E&&0>q.enemyHits.indexOf(E)){if(q.enemyHits.push(E),k(E,g.attackStrength),"laser"==g.skill?(f=g.projectilePool.pop(),f.x=E.x,f.y=E.y,f.rotation=0,f.gotoAndPlay("projectile_hit"),g.hittingProjectiles.push(f),x.addChild(f)):(utils.playSound(SoundsConfig.snowbal_hit),q.gotoAndPlay("projectile_hit"),q.rotation=0,g.flyingProjectiles.splice(m,1),g.hittingProjectiles.push(q)),utils.playSound(SoundsConfig[g.hitSFX]),null!=g.skill)if(0<=
g.skill.indexOf("slowball"))for(var q=SkillsConfig[g.skill],D=r(E,M,q.range);0<D.length;)f=D.pop(),f.slowEffectRemainingTime=q.duration,f.slowEffectFactor=q.strength;else if(0<=g.skill.indexOf("attack_area"))for(D=r(E,M,g.attackRangeSq);0<D.length;)if(f=D.pop(),f!=E){var C=t(q,f),C=1-p.Ease.circOut(C/g.attackRangeSq);k(f,g.attackStrength*C)}}else if(-40>q.x||q.x>main.stage.canvas.width+40||-40>q.y||q.y>main.stage.canvas.height+40)g.flyingProjectiles.splice(m,1),g.projectilePool.push(q)}for(m=g.hittingProjectiles.length-
1;0<=m;--m)q=g.hittingProjectiles[m],"projectile_end"==q.currentAnimation&&(g.hittingProjectiles.splice(m,1),g.projectilePool.push(q),x.removeChild(q));switch(g.state){case B.SHOOT:if(0<=g.currentAnimation.indexOf("release"))if(g.state=B.RECOVERY,null!=g.skill&&0<=g.skill.indexOf("storm"))for(D=r(g,M,g.attackRangeSq),m=SkillsConfig[g.skill];0<D.length;)f=D.pop(),f.damageOverTime={},f.damageOverTime.remainingTime=m.duration,f.damageOverTime.dps=m.strength,k(f,g.attackStrength),q=g.projectilePool.pop(),
g.hittingProjectiles.push(q),q.x=f.x,q.y=f.y,q.gotoAndPlay("projectile_hit"),x.addChild(q);else q=g.projectilePool.pop(),g.flyingProjectiles.push(q),q.enemyHits.length=0,q.x=g.x,q.x=0<g.scaleX?q.x+g.shootOffset.x:q.x-g.shootOffset.x,q.y=g.y-g.shootOffset.y,q.gotoAndPlay("projectile"),x.addChild(q),f=g.target.x-q.x,m=g.target.y-q.y,C=Math.sqrt(f*f+m*m),q.speedX=f/C*250,q.speedY=m/C*250,q.rotation=90-180*Math.atan2(f,m)/Math.PI+180;case B.RECOVERY:0<=g.currentAnimation.indexOf("end")&&(g.state=B.NORMAL);
case B.NORMAL:if(!S&&z.parent&&O==X.STARS_AND_LEVEL_UP)continue;0>=g.attackTimer&&(E=l(g,M,g.attackRangeSq))&&(g.state=B.SHOOT,g.target=E,g.attackTimer+=g.attackTime,20<g.y-E.y?g.gotoAndPlay("shoot_up_ready"):g.gotoAndPlay("shoot_down_ready"),g.scaleX=E.x<g.x?-1:1,utils.playSound(SoundsConfig[g.shootSFX]));break;case B.MOVING:f=!1;if("teleport"==g.skill)if("teleport_out_end"==g.currentAnimation)g.x=g.foxhole.x+20,g.y=g.foxhole.y+20,g.gotoAndPlay("teleport_in");else{if("teleport_in_end"==g.currentAnimation||
0<=g.currentAnimation.indexOf("idle"))f=!0}else 0==g.tilesPath.length?f=!0:(q=g.tilesPath[0],b(g,40*q.x,40*q.y,20,20,g.walkSpeed,a*e)&&g.tilesPath.shift());f&&(g.state=B.NORMAL,g.x=g.foxhole.x+20,g.y=g.foxhole.y+20,g.gotoAndPlay("idle_down"))}if(null!=g.skill&&g.state!=B.LIMBO&&0<=g.skill.indexOf("speed_aura"))for(f=SkillsConfig[g.skill],m=r(g,T,f.range),E=0;E<T.length;++E)D=T[E],D.state!=B.LIMBO&&0<=m.indexOf(D)?(0==D.fastRate&&(q=D.fastFX=W.pop(),q.gotoAndPlay("fx_speedup_in"),q.x=D.x,q.y=D.y+1,
x.addChild(q),utils.playSound(SoundsConfig.skill_speedup_in)),D.fastRate<f.strength&&(D.fastRate=f.strength)):0!=D.fastRate&&(D.fastRate=0,D.fastFX.gotoAndPlay("fx_speedup_out"),utils.playSound(SoundsConfig.skill_speedup_out));g.framerate=g.spriteSheet.framerate*e+.01}for(h=M.length-1;0<=h;--h){f=M[h];if(null!=f.config.skill)if(0<=f.config.skill.indexOf("shield"))0<=f.shieldTime?(f.shieldTime-=a,0>=f.shieldTime&&(f.skillCooldown=SkillsConfig[f.config.skill].cooldown,f.shieldFX.gotoAndPlay("fx_out"))):
0<f.skillCooldown&&(f.skillCooldown-=a,0>=f.skillCooldown&&(f.gotoAndPlay("special"),f.shieldFX.gotoAndPlay("fx_in"),f.shieldTime=SkillsConfig[f.config.skill].duration,"shield_1"==f.config.skill?utils.playSound(SoundsConfig.skill_shield_1):"shield_2"==f.config.skill&&utils.playSound(SoundsConfig.skill_shield_2)));else if(0<=f.config.skill.indexOf("slow_players")&&0<f.skillCooldown&&(f.skillCooldown-=a,0>=f.skillCooldown))if(e=SkillsConfig[f.config.skill],m=r(f,T,e.range),0==m.length)f.skillCooldown=
e.cooldown/4;else{f.gotoAndPlay("special");for(f.skillCooldown=e.cooldown;0<m.length;)g=m.pop(),0==g.slowRate&&(q=g.slowFX=W.pop(),q.gotoAndPlay("fx_slow_in"),q.x=g.x,q.y=g.y+2,x.addChild(q)),g.slowRate<e.strength&&(g.slowRate=e.strength,g.slowTime=e.duration);"slow_players_1"==f.config.skill?utils.playSound(SoundsConfig.skill_slow_players_1):"slow_players_2"==f.config.skill&&utils.playSound(SoundsConfig.skill_slow_players_2)}f.damageOverTime&&0<f.damageOverTime.remainingTime&&(f.damageOverTime.remainingTime-=
a,k(f,f.damageOverTime.dps*a));if(0<f.health){f.framerate=f.spriteSheet.framerate;g=f.config.walkSpeed;if(0<f.slowEffectRemainingTime){if(f.slowEffectRemainingTime-=a,null==f.config.skill||0>f.config.skill.indexOf("shield")||0>=f.shieldTime)g*=f.slowEffectFactor,f.framerate*=f.slowEffectFactor,f.framerate+=.01,f.slowFX||(f.slowFX=W.pop(),f.slowFX.gotoAndPlay("fx_slow_in"),x.addChild(f.slowFX))}else f.slowFX&&0<=f.slowFX.currentAnimation.indexOf("loop")&&f.slowFX.gotoAndPlay("fx_slow_out"),f.slowFX&&
0<=f.slowFX.currentAnimation.indexOf("end")&&(x.removeChild(f.slowFX),W.push(f.slowFX),f.slowFX=null);f.slowFX&&(f.slowFX.x=f.x,f.slowFX.y=f.y+1);"special"==f.currentAnimation&&(g=0);S||(z.parent?(g=0,f.framerate=.001):f.framerate=f.spriteSheet.framerate);b(f,f.path[f.pathIdx].x,f.path[f.pathIdx].y,f.xOffset,f.yOffset,g,a)&&++f.pathIdx;!S&&O==X.ENEMY_INFO-1&&30<f.x&&J(f,65,0);f.shieldFX&&(f.shieldFX.x=f.x,f.shieldFX.y=f.y);f.healthBar.x=f.x-f.healthBar.maxSize/2;f.healthBar.y=f.y+10;f.pathIdx>=f.path.length&&
(A(),f.isBoss?ea+=5E4:null!=f.config.skill&&"spawn_minion"==f.config.skill?ea+=2:++ea,y(),I.removeChild(f.healthBar),x.removeChild(f),f.shieldFX&&x.removeChild(f.shieldFX),M.splice(h,1),f.pool.push(f))}else if(A(),f.framerate=f.spriteSheet.framerate,f.damageOverTime=null,f.slowEffectFactor=0,f.slowEffectRemainingTime=0,M.splice(h,1),da.push(f),f.gotoAndPlay("die"),f.slowFX&&f.slowFX.gotoAndPlay("fx_slow_out"),I.removeChild(f.healthBar),utils.playSound(f.deathSFX),"spawn_minion"==f.config.skill)for(g=
{pool:qa.enemy_1,path:f.path,pos:f,pathIdx:f.pathIdx},e=2;0<e--;)n(g)}sa.x=main.stage.mouseX;sa.y=main.stage.mouseY;h=null;g=999999;for(e=P.length-1;0<=e;--e)f=P[e],q=t(sa,f,-20,-20),1600>q&&(q<g||null==h)&&(g=q,h=f),null!=f.troop&&f.troop!=w?f.troop.btn.highlight.visible=!1:f!=h&&"slot_free"!=f.highlight.currentAnimation&&f.highlight.gotoAndPlay("slot_free");null==w&&(null!=h&&null!=h.troop&&h.troop.state!=B.MOVING?(H.visible=!0,H.gotoAndPlay("character_mouseover"),H.x=h.troop.x,H.y=h.troop.y+0,
h.troop.btn.highlight.visible=!0):H.visible=!1);switch(G){case F.NORMAL:if(null!=h&&null!=h.troop&&h.troop.state!=B.MOVING&&(S||(O<X.MOVEMENT?ca=!1:O==X.MOVEMENT&&ca&&L({x:260,y:420},65,0)),ca))for(G=F.RELOCATING,w=h.troop,w.btn.highlight.visible=!0,H.visible=!0,H.gotoAndPlay("character_select"),H.x=w.x,H.y=w.y+0,utils.playSound(SoundsConfig.character_select),e=P.length-1;0<=e;--e)f=P[e],f.highlight.visible=null==f.troop,f.highlight.gotoAndPlay("slot_free");break;case F.PLACING:if(null!=h&&null==
h.troop)if(w.x=h.x+20,w.y=h.y+20,H.x=w.x,H.y=w.y+0,ca)for(S||2!=O||N.removeChild(z),G=F.NORMAL,w.state=B.NORMAL,w.fastRate=0,w.slowRate=0,w.slowTime=0,w.btn.mouseEnabled=!1,w.btn.notSpawned.visible=!1,w.foxhole=h,h.troop=w,H.visible=!1,w.btn.highlight.visible=!1,w=null,utils.playSound(SoundsConfig.character_place),e=P.length-1;0<=e;--e)P[e].highlight.visible=!1;else"slot_highlight"!=h.highlight.currentAnimation&&h.highlight.gotoAndPlay("slot_highlight");else w.x=main.stage.mouseX,w.y=main.stage.mouseY,
H.x=w.x,H.y=w.y+0;break;case F.RELOCATING:if(null!=h&&(null==h.troop||h.troop==w))if(ca)for(w.foxhole==h?utils.playSound(SoundsConfig.button_click_back):(S||O!=X.MOVEMENT||N.removeChild(z),utils.playSound(SoundsConfig.character_move),w.state=B.MOVING,w.foxhole.troop=null,w.foxhole=h,h.troop=w,"teleport"==w.skill?(w.gotoAndPlay("teleport_out"),utils.playSound(SoundsConfig.skill_teleport)):(h=astar.search(ka,ka.grid[Math.floor(w.x/40)][Math.floor(w.y/40)],ka.grid[Math.floor(h.x/40)][Math.floor(h.y/
40)]),w.tilesPath=h)),G=F.NORMAL,w=null,H.visible=!1,e=P.length-1;0<=e;--e)P[e].highlight.visible=!1;else"slot_highlight"!=h.highlight.currentAnimation&&h.highlight.gotoAndPlay("slot_highlight")}x.sortChildren(c);for(v();ea>Q.stars[K];)oa.gotoAndPlay("hud_stars_flash"),--K,y(),0>K&&(menu.showPopup(menu.losePopup),utils.playSound(SoundsConfig.fanfare_lose),fa.stop());h=1;0!=ea&&(0==K?h=0:(h=Q.stars[K+1],h=1-(ea-h)/(Q.stars[K]-h)));.6>=h&&1<K&&(ha-=a,0>=ha&&(Y.currentAnimation.charAt(Y.currentAnimation.length-
1)==K?(ha=.2,Y.gotoAndPlay("hud_stars_"+(K-1))):(ha=utils.lerp(.1,.5,h),Y.gotoAndPlay("hud_stars_"+K))));0<=K&&d&&0==M.length&&0==da.length&&0==Z.length&&(Y.gotoAndPlay("hud_stars_"+K),menu.setCurrentStars(K),menu.showPopup(menu.winPopup),utils.playSound(SoundsConfig.fanfare_win),fa.stop());ca=!1};var ha=0;C.removeFromScene=function(){N.visible=!1;N.removeChild(m);fa.stop()};C.end=function(){for(w=null;0<M.length;)R(M.pop());for(;0<da.length;)R(da.pop());for(;0<P.length;){var b=P.pop();x.removeChild(b);
pa.push(b)}for(var a in T)if(b=T[a],b.state=B.LIMBO,b.parent){x.removeChild(b);I.removeChild(b.rangeMarker);for(a=b.flyingProjectiles.length;0<=a;--a)x.removeChild(b.flyingProjectiles[a]);for(a=b.hittingProjectiles.length;0<=a;--a)x.removeChild(b.hittingProjectiles[a]);b.slowFX&&(x.removeChild(b.slowFX),W.push(b.slowFX),b.slowFX=null);b.fastFX&&(x.removeChild(b.fastFX),W.push(b.fastFX),b.fastFX=null)}};var z,O,X={SELECT_FOR_SPAWN:1,SPAWN_CHARACTER:2,ENEMY_INFO:3,MOVEMENT:4,STARS_AND_LEVEL_UP:5}})();(function(){function e(b,a,c){return b.scaleX>a.scaleX?1:b.scaleX<a.scaleX?-1:0}var h=window.menu=window.menu||{},v=h.screenContainer=new createjs.Container,y=h.popupsContainer=new createjs.Container,a=h.mainScreen=new createjs.Container,c=h.levelScreen=new createjs.Container,b=h.charactersScreen=new createjs.Container,n=h.winPopup=new createjs.Container,d=h.losePopup=new createjs.Container,k=h.pausePopup=new createjs.Container,r=h.levelUpPopup=new createjs.Container,l=h.charUnlockPopup=new createjs.Container,
t=h.gameWonScreen=new createjs.Container,R,J=new createjs.Shape,L=h.transitionCover=new createjs.Shape,A=999,C=null,p=null,u=null,F=h.bgm=null;h.init=function(){function e(){utils.playSound(SoundsConfig.button_click_ok);game.end();h.startLevel(A,function(){h.hidePopups()})}function m(){for(game.end();0<v.numChildren;)v.removeChildAt(0);h.showScreen(h.levelScreen,function(){h.hidePopups();game.removeFromScene()});utils.playSound(SoundsConfig.button_click_back)}function x(){var b=[],a;for(a in CharacterConfig)-1==
main.charactersLevel[a]&&b.push(a);return b}function B(){var b=0,a;for(a in CharacterConfig)b+=main.charactersLevel[a];return b}function G(){var b=B();h.updateCharactersLevel();if(b!=B())r.charLvlNum.gotoAndPlay("levelup_level_"+main.charactersLevel.char_1),r.charLvlShine.gotoAndPlay("levelup_shine"),r.addChild(r.charLvlShine),h.showPopup(r);else{b=x();h.updateLockedCharacters();var a=x();if(b.length!=a.length){for(var c=0;c<a.length;++c){var d=b.indexOf(a[c]);b.splice(d,1)}b=b[0];h.updateCharactersLevel();
l.card.gotoAndPlay("card_"+CharacterConfig[b].name);l.cardDesc.gotoAndPlay("desc_"+CharacterConfig[b].name);h.showPopup(l);3>u.length&&u.push(null)}else if(R||A!=LevelConfig.length-1)m();else{R=!0;for(utils.save("game_was_already_won",!0);0<v.numChildren;)v.removeChildAt(0);h.showScreen(t)}}}createjs.Sound.muted=utils.load("sound_muted",!1);R=utils.load("game_was_already_won",!1);utils.mouseOverSound=SoundsConfig.button_over;F=h.bgm=utils.playSound(SoundsConfig.bgm_menu);F.volume=0;debug&&debug.muteBGM&&
(F.muted=!0);C=utils.load("stars_count",0);p=debug&&debug.maxStarsPerLevel?debug.maxStarsPerLevel:utils.load("max_stars_per_level",[]);u=utils.load("selected_characters_for_team",[null]);if(0==p.length)for(var y=15;0<y;--y)p.push(0);J.graphics.beginFill("black");J.graphics.drawRect(-1,-1,main.stage.canvas.width+1,main.stage.canvas.height+1);J.addEventListener("click",function(){});J.alpha=.5;L.graphics.beginFill("black");L.graphics.drawRect(-1,-1,main.stage.canvas.width+1,main.stage.canvas.height+
1);L.addEventListener("click",function(){});L.alpha=0;(function(){var b=main.createScreenItem("main","btn_sfx_on_idle");main.registerSFXToggle(b);var d=main.createScreenItem("main","btn_play_idle");utils.setupSpriteButton(d,"btn_play_idle","btn_play_over","btn_play_down");d.addEventListener("click",function(b){h.showScreen(c);utils.playSound(SoundsConfig.button_click_ok);utils.audioFixCheck()});a.addChild(main.createScreenItem("main","main_background"),main.createScreenItem("locale","logo"),b,d);
debug&&(b=utils.createLabelButton("[Clear Save]",20),b.addEventListener("click",function(){utils.clearSave();location.reload()}),b.x=main.stage.canvas.width/2-b.getBounds().width/2,b.y=180,a.addChild(b))})();(function(){var d=main.createScreenItem("select_level","btn_sfx_on_idle");main.registerSFXToggle(d);var e=main.createScreenItem("select_level","btn_back_idle");utils.setupSpriteButton(e,"btn_back_idle","btn_back_over","btn_back_down");e.addEventListener("click",function(b){h.showScreen(a);utils.playSound(SoundsConfig.button_click_back)});
c.addChild(main.createScreenItem("select_level","select_background"),main.createScreenItem("locale","select_title"),d,e);var u=[];(function(){for(var a=230,d=0;3>d;++d){for(var e=200,m=0;5>m;++m){var n=5*d+m,k=(9>n?"0":"")+(n+1),l=main.createScreenItem("select_level","btn_level_locked");u.push(l);utils.setupSpriteButton(l,"btn_level_"+k+"_idle","btn_level_"+k+"_over","btn_level_"+k+"_down");l.addEventListener("click",function(a){return function(c){utils.playSound(SoundsConfig.button_click_ok);h.selectedLevel=
a;h.showScreen(b)}}(n));l.mouseEnabled=!1;n=new createjs.Container;k=main.createScreenItem("select_level","stars_0");l.starCount=k;n.addChild(l,k);n.x=e;n.y=a;c.addChild(n);e+=100}a+=90}})();var d=new createjs.Container,e=c.teamLevel=main.createScreenItem("character_selection_levelup_unlock","card_level_"+(main.charactersLevel.char_1+1)),m=c.starsLeft=main.createScreenItem("locale","stars_left"),n=c.starCountNo_X=main.createScreenItem("character_selection_levelup_unlock","character_8"),k=c.starCountNoX_=
main.createScreenItem("character_selection_levelup_unlock","character_8");k.x-=24;d.addChild(main.createScreenItem("locale","card_level"),e,m,k,n);d.x=275;c.addChild(d);c.onEnterSetup=function(){for(var b=0;b<u.length;++b)u[b].starCount.gotoAndPlay("stars_"+p[b]);for(b=0;b<u.length;++b){var a=u[b];h.isLvlUnlocked(b)&&null!=LevelConfig[b].waves[0].time?(a.gotoAndPlay("btn_level_"+((9>b?"0":"")+(b+1))+"_idle"),a.mouseEnabled=!0,a.starCount.visible=!0):(a.gotoAndPlay("btn_level_locked"),a.mouseEnabled=
!1,a.starCount.visible=!1)}b=main.charactersLevel.char_1;if(4<=b)c.starsLeft.visible=c.starCountNoX_.visible=c.starCountNo_X.visible=!1;else if(c.starCountNo_X.visible=!0,a=CharacterConfig.char_1.levels[b+1].cost-C,10<=a){c.starCountNoX_.visible=!0;var d=Math.floor(a/10);c.starCountNo_X.gotoAndPlay("character_"+a%10);c.starCountNoX_.gotoAndPlay("character_"+d)}else c.starCountNoX_.visible=!1,c.starCountNo_X.gotoAndPlay("character_"+a);c.teamLevel.gotoAndPlay("card_level_"+(b+1))}})();(function(){function a(b){var a=
new createjs.Container,c=a.card=main.createScreenItem("character_selection_levelup_unlock","card_"+CharacterConfig[b].name);c.x=-main.stage.canvas.width/2;c.y=-66;var h=a.desc=main.createScreenItem("locale","desc_"+CharacterConfig[b].name);h.x=-main.stage.canvas.width/2;h.y=-116;var k=a.selectBtn=main.createScreenItem("character_selection_levelup_unlock","btn_char_select_idle");k.x=-main.stage.canvas.width/2;utils.setupSpriteButton(k,"btn_char_select_idle","btn_char_select_over","btn_char_select_down",
null,function(){return 0>u.indexOf(b)});k.addEventListener("click",function(){utils.playSound(SoundsConfig.button_click_back);for(var b=w[t],a=0;a<u.length;++a)if(null==u[a]){u[a]=b;b=b.split("_").pop();x[a].gotoAndPlay("hud_portrait_"+b);p[a].visible=!0;I.gotoAndStop("btn_continue_down");break}d();e();utils.save("selected_characters_for_team",u)});a.addChild(h,c,k);a.alpha=0;F.addChild(a);return a}function d(){u.every(function(b){return null!=b})?(I.mouseEnabled=!0,I.gotoAndPlay("btn_continue_idle")):
(I.mouseEnabled=!1,I.gotoAndStop("btn_continue_down"))}function e(){for(var b=0;b<w.length;++b){var a=v[b].selectBtn,c=v[b].card,d=v[b].desc,e=0<=u.indexOf(w[b]);0>main.charactersLevel[w[b]]||0<b&&0==h.selectedLevel?(a.visible=!1,a.mouseEnabled=!1,0>c.currentAnimation.indexOf("_locked")&&c.gotoAndPlay(c.currentAnimation+"_locked"),d.visible=!1):e||u.every(function(b){return null!=b})?(0<=c.currentAnimation.indexOf("_locked")&&c.gotoAndPlay(c.currentAnimation.replace("_locked","")),d.visible=!0,a.visible=
!0,a.mouseEnabled=!1,a.gotoAndPlay("btn_char_select_down"),e&&(c.uncache(),c.filters=y,a=c.spriteSheet.getFrameBounds(c.currentFrame),c.cache(a.x,a.y,a.width,a.height))):(0<=c.currentAnimation.indexOf("_locked")&&c.gotoAndPlay(c.currentAnimation.replace("_locked","")),d.visible=!0,a.visible=!0,a.mouseEnabled=!0,a.gotoAndPlay("btn_char_select_idle"),c.filters=G,c.uncache())}}function m(b){t+=b;0>t&&(t=w.length-1);t>w.length-1&&(t=0);utils.save("selected_car_idx",t);for(var a=0<b?-145:145,c=0;c<w.length;++c){var d=
(t-c)%w.length,h=w.length/2;d>h?d-=w.length:d<-h&&(d+=w.length);var k=main.stage.canvas.width/2,u;switch(Math.abs(d)){case 0:h=1;k+=0;d=0;u=1;break;case 1:h=.8;k+=a*d*b;d=100;u=.8;break;case 2:h=.6;k+=.8*a*d*b;d=200;u=.6;break;default:h=0,k+=a*(0<d?1:-1)*b,d=350,u=0}var m=createjs.Ease.quadInOut,l=v[c];createjs.Tween.get(l).to({alpha:h,x:k,y:d,scaleX:u,scaleY:u},250,m);createjs.Tween.get(l.desc).to({alpha:1==h?1:0},500,m);createjs.Tween.get(l.selectBtn).to({alpha:1==h?1:0},500,m)}e()}function n(){for(var b in CharacterConfig){for(var a=
main.charactersLevel[b];0<=a&&4>a&&CharacterConfig[b].levels[a+1].cost<=C;)main.charactersLevel[b]=++a;utils.save("characters_level_info",main.charactersLevel)}}var k=main.createScreenItem("character_selection_levelup_unlock","btn_sfx_on_idle");main.registerSFXToggle(k);var l=main.createScreenItem("character_selection_levelup_unlock","btn_select_idle");utils.setupSpriteButton(l,"btn_select_idle","btn_select_over","btn_select_down");l.addEventListener("click",function(b){h.showScreen(c);utils.playSound(SoundsConfig.button_click_back)});
var I=main.createScreenItem("character_selection_levelup_unlock","btn_continue_idle");utils.setupSpriteButton(I,"btn_continue_idle","btn_continue_over","btn_continue_down");I.addEventListener("click",function(b){utils.playSound(SoundsConfig.button_click_ok);h.startLevel(h.selectedLevel)});var r=main.createScreenItem("character_selection_levelup_unlock","char_select_bg");r.alpha=.6;b.addChild(r,main.createScreenItem("locale","char_select_title"),k,l,I);var F=b.rouletteContainer=new createjs.Container;
b.addChild(F);var w=[],v=[],B;for(B in CharacterConfig)w.push(B),v.push(a(B));var t=utils.load("selected_car_idx",0);v[t].alpha=1;for(var x=[main.createScreenItem("character_selection_levelup_unlock","hud_portrait_empty"),main.createScreenItem("character_selection_levelup_unlock","hud_portrait_empty"),main.createScreenItem("character_selection_levelup_unlock","hud_portrait_empty")],p=[main.createScreenItem("character_selection_levelup_unlock","btn_char_remove_idle"),main.createScreenItem("character_selection_levelup_unlock",
"btn_char_remove_idle"),main.createScreenItem("character_selection_levelup_unlock","btn_char_remove_idle")],G=[],y=[new createjs.ColorFilter(.5,.5,.6)],k=0;k<x.length;++k)b.addChild(x[k],p[k]),utils.setupSpriteButton(p[k],"btn_char_remove_idle","btn_char_remove_over","btn_char_remove_down"),p[k].addEventListener("click",function(b){return function(){u[b]=null;x[b].gotoAndPlay("hud_portrait_empty");p[b].visible=!1;d();e();utils.save("selected_characters_for_team",u)}}(k));m(1);m(-1);k=main.createScreenItem("character_selection_levelup_unlock",
"btn_left_idle");utils.setupSpriteButton(k,"btn_left_idle","btn_left_over","btn_left_down");k.addEventListener("click",function(){utils.playSound(SoundsConfig.button_click_back);m(-1)});k.x+=-150;l=main.createScreenItem("character_selection_levelup_unlock","btn_right_idle");utils.setupSpriteButton(l,"btn_right_idle","btn_right_over","btn_right_down");l.addEventListener("click",function(){utils.playSound(SoundsConfig.button_click_back);m(1)});l.x+=150;b.addChild(k,l);h.updateCharactersLevel=n;b.onEnterSetup=
function(){h.updateLockedCharacters();n();var b=0;if(0==h.selectedLevel)u=[null],b=1;else{for(var a in CharacterConfig)-1<main.charactersLevel[a]&&++b;for(;3>u.length&&b>u.length;)u.push(null)}d();e();for(a=0;a<x.length;++a)if(a<u.length)if(x[a].visible=!0,null==u[a])x[a].gotoAndPlay("hud_portrait_empty"),p[a].visible=!1;else{var c=u[a].split("_").pop();x[a].gotoAndPlay("hud_portrait_"+c);p[a].visible=!0}else x[a].visible=!1,p[a].visible=!1;switch(b){case 1:x[0].x=p[0].x=0;x[0].y=p[0].y=0;break;case 2:x[0].x=
p[0].x=-45;x[0].y=p[0].y=0;x[1].x=p[1].x=45;x[1].y=p[1].y=0;break;default:x[0].x=p[0].x=-90,x[0].y=p[0].y=0,x[1].x=p[1].x=0,x[1].y=p[1].y=0,x[2].x=p[2].x=90,x[2].y=p[2].y=0}}})();(function(){var b=main.createScreenItem("winlose","lose_btn_select_idle");utils.setupSpriteButton(b,"lose_btn_select_idle","lose_btn_select_over","lose_btn_select_down");b.addEventListener("click",m);var a=main.createScreenItem("winlose","lose_btn_restart_idle");utils.setupSpriteButton(a,"lose_btn_restart_idle","lose_btn_restart_over",
"lose_btn_restart_down");a.addEventListener("click",e);d.addChild(main.createScreenItem("winlose","lose_background"),main.createScreenItem("locale","lose_title"),b,a)})();(function(){var b=main.createScreenItem("winlose","win_btn_continue_idle");utils.setupSpriteButton(b,"win_btn_continue_idle","win_btn_continue_over","win_btn_continue_down");b.addEventListener("click",G);var a=main.createScreenItem("winlose","win_btn_restart_idle");utils.setupSpriteButton(a,"win_btn_restart_idle","win_btn_restart_over",
"win_btn_restart_down");a.addEventListener("click",e);n.starCount=main.createScreenItem("winlose","win_stars_0");n.addChild(main.createScreenItem("winlose","win_background"),main.createScreenItem("locale","win_title"),b,a,n.starCount)})();(function(){var b=main.createScreenItem("pause","btn_close_idle");utils.setupSpriteButton(b,"btn_close_idle","btn_close_over","btn_close_down");b.addEventListener("click",function(b){h.hidePopups();utils.playSound(SoundsConfig.button_click_back)});var a=main.createScreenItem("pause",
"btn_restart_idle");utils.setupSpriteButton(a,"btn_restart_idle","btn_restart_over","btn_restart_down");a.addEventListener("click",e);var c=main.createScreenItem("pause","btn_select_idle");utils.setupSpriteButton(c,"btn_select_idle","btn_select_over","btn_select_down");c.addEventListener("click",m);var d=main.createScreenItem("pause","btn_sfx_on_idle");main.registerSFXToggle(d);k.addChild(main.createScreenItem("pause","pause_background"),main.createScreenItem("locale","pause_title"),b,a,c,d)})();
(function(){var b=main.createScreenItem("locale","levelup_title"),a=main.createScreenItem("locale","levelup_text"),c=main.createScreenItem("character_selection_levelup_unlock","bg_shine");c.x=400;c.y=278;createjs.Tween.get(c,{loop:-1}).to({rotation:360},35E3);var d=r.charLvlShine=main.createScreenItem("character_selection_levelup_unlock","levelup_shine_end"),e=r.charLvlNum=main.createScreenItem("character_selection_levelup_unlock","levelup_level_1"),h=main.createScreenItem("character_selection_levelup_unlock",
"btn_continue_idle");utils.setupSpriteButton(h,"btn_continue_idle","btn_continue_over","btn_continue_down");h.addEventListener("click",G);r.addChild(c,b,a,h,e,d)})();(function(){var b=main.createScreenItem("locale","char_unlock_title"),a=main.createScreenItem("character_selection_levelup_unlock","bg_shine");a.x=400;a.y=278;createjs.Tween.get(a,{loop:-1}).to({rotation:360},35E3);var c=main.createScreenItem("character_selection_levelup_unlock","btn_continue_idle");utils.setupSpriteButton(c,"btn_continue_idle",
"btn_continue_over","btn_continue_down");c.addEventListener("click",G);var d=l.card=main.createScreenItem("character_selection_levelup_unlock","card_gumball"),e=l.cardDesc=main.createScreenItem("locale","desc_gumball");l.addChild(a,b,c,d,e)})();(function(){var b=main.createScreenItem("locale","end_background"),a=main.createScreenItem("end","btn_continue_idle");utils.setupSpriteButton(a,"btn_continue_idle","btn_continue_over","btn_continue_down");a.addEventListener("click",function(){utils.playSound(SoundsConfig.button_click_ok);
h.showScreen(h.levelScreen)});t.onEnterSetup=function(){h.hidePopups();game.end();game.removeFromScene()};t.addChild(b,a)})()};h.showScreen=function(b,a){main.state=main.STATE.MENU;v.visible=!0;L.alpha=0;var c=null;0<v.numChildren&&(c=v.getChildAt(0));h.transition(function(){F.volume=1;c&&v.removeChild(c);v.addChild(b);if(null!=b.onEnterSetup)b.onEnterSetup();a&&a();main.state=main.STATE.MENU},function(){main.state=main.STATE.MENU})};h.transition=function(b,a){createjs.Tween.get(L).to({alpha:1},150).wait(main.DT_MS).call(function(){b&&
b()}).to({alpha:0},150).call(function(){a&&a()})};h.showPopup=function(b){for(main.state=main.STATE.MENU;0<y.numChildren;)y.removeChildAt(0);game.container.cache(0,0,main.stage.canvas.width,main.stage.canvas.height);y.addChild(J);y.addChild(b);y.visible=!0};h.hidePopups=function(){game.container.uncache();main.state=main.STATE.GAME;y.visible=!1};h.startLevel=function(b,a){var c=0,d;for(d in CharacterConfig)0<=main.charactersLevel[d]&&++c;A=b;h.transition(function(){a&&a();v.visible=!1;F.volume=0;
game.start(b,u)},function(){main.state=main.STATE.GAME})};var B=0,G=0,N=0;h.update=function(a){if(y.visible)if(r.parent==y){a=r.charLvlShine;var c=r.charLvlNum,d="levelup_level_"+main.charactersLevel.char_1;"levelup_shine"!=a.currentAnimation&&c.currentAnimation==d?c.gotoAndPlay("levelup_level_"+(main.charactersLevel.char_1+1)):"levelup_shine_end"==a.currentAnimation&&r.removeChild(a)}else n.parent==y&&G<B&&(N-=a,0>=N&&(N=.8,++G,n.starCount.gotoAndPlay("win_stars_"+G),utils.playSound(SoundsConfig["star_appear_"+
G])));b.parent&&b.rouletteContainer.sortChildren(e)};h.setCurrentStars=function(b){var a=b-p[A];0<a&&(C+=a,utils.save("stars_count",C),p[A]=b,utils.save("max_stars_per_level",p));B=b;G=1;N=.8;n.starCount.gotoAndPlay("win_stars_1");utils.playSound(SoundsConfig.star_appear_1)};h.updateLockedCharacters=function(){for(var b in CharacterConfig){var a=CharacterConfig[b];0>main.charactersLevel[b]&&(-1==a.unlockLevel||0<p[a.unlockLevel])&&(main.charactersLevel[b]=0)}};h.isLvlUnlocked=function(b){var a=1>
b||0<p[b-1];return 0<=b&&b<LevelConfig.length&&a}})();(function(){function e(a,c){this.Container_constructor();var b=a.spritesheet;this.layers={};this.objectGroup={};for(var h=0;h<a.layers.length;h++){var d=a.layers[h];if("tilelayer"==d.type){var k=this.createLayer(d.name);k.data=d.data;k.layerWidth=d.width;k.layerHeight=d.height;for(var r=0;r<d.height;r++)for(var l=0;l<d.width;l++){var t=d.data[l+r*d.width]-1;if(0<=t&&t<b.getNumFrames()){var y=new v.Sprite(b);k.addChild(y);y.gotoAndStop(t);y.x=l*a.tilewidth;y.y=r*a.tileheight}}if(d.properties)if(d.properties.merge_down)if(1>
h)console.log("Can't merge down the first layer!");else for(r=this.numChildren-1-1,l=new v.Container,l.addChild(this.getChildAt(r)),l.addChild(k),this.addChildAt(l,r),this.layers[d.name]=l,this.layers[a.layers[h-1].name]=l,l.cache(0,0,d.width*a.tilewidth,d.height*a.tileheight);0<l.numChildren;)l.removeChildAt(0);else if(d.properties["static"])for(k.cache(0,0,d.width*a.tilewidth,d.height*a.tileheight);0<k.numChildren;)k.removeChildAt(0)}else if("objectgroup"==d.type){if(d.properties&&d.properties.logic){if(e.Debug.LogicAsText||
e.Debug.ObjectsAsText){var k=this.createLayer(d.name),J;for(J in d.objects)r=d.objects[J],l=new v.Text("*\n"+r.name),l.x=r.x,l.y=r.y,k.addChild(l)}}else if(e.Debug.ObjectsAsText){var k=this.createLayer(d.name),L;for(L in d.objects)r=d.objects[L],l=new v.Text("*\n"+r.name),l.x=r.x,l.y=r.y,k.addChild(l)}this.objectGroup[d.name]=d.objects}else"imagelayer"==d.type?c?(k=c(d))?this.addChild(k):console.log("Failed to create image layer",d.name):console.log("Image layer callback missing, can't create image layer",
d.name):console.log("Unsupported layer ",d.name,"of type",d.type)}}var h=window.hb=window.hb||{},v=window.createjs;e.Debug={LogicAsText:!1,ObjectsAsText:!1};e.LoadTileSheets=function(a,c){var b={images:[],frames:[]},e;for(e in a.tilesets)for(var d=a.tilesets[e],h=d.margin,r=d.margin,l=0;l<d.tilecount;++l)b.frames.push([h,r,d.tilewidth,d.tileheight,e]),h+=d.tilewidth+d.spacing,h+d.tilewidth+d.margin>d.imagewidth&&(h=d.margin,r+=d.tileheight+d.spacing);e=[];for(var t in a.tilesets)if(d=a.tilesets[t].image)(h=
y[d])?b.images[t]=h:(h=y[d]=document.createElement("canvas"),e.push({src:d,type:"image",id:d,tilesetIdx:t}));0<e.length?(t=new v.LoadQueue,t.addEventListener("fileload",function(a){b.images[a.item.tilesetIdx]=a.result}),t.addEventListener("complete",function(d){a.spritesheet=new v.SpriteSheet(b);c(d)}),t.loadManifest(e)):c()};var y={};e.InsertExternalTilesetInfo=function(a,c){for(var b in c)a[b]=c[b];delete a.source};v.extend(e,v.Container).createLayer=function(a){var c=new v.Container;c.name=a;this.layers[a]=
c;this.addChild(c);return c};h.Tilemap=v.promote(e,"Container")})();(function(){function e(b){t.removeEventListener("complete",e);t=null;r.load()}function h(b){l.removeEventListener("complete",h);l=null;y()}function v(b){r.removeEventListener("complete",v);r=null;for(var a in J)n[a]=new createjs.SpriteSheet(J[a]);J=R=null;y()}function y(){null==r&&null==l&&null==t&&(d?(preloader.preloadContainer.removeChild(preloader.preloadContainer.loadIcon),location.reload()):main.start())}var a=window.preloader={},c=window.tilemaps=window.tilemaps||{},b=window.images=window.images||
{},n=window.ss=window.ss||{},d=!1,k=null,r=null,l=null,t=null,R="boss_1 boss_2 boss_3 character_1 character_2 character_3 character_4 character_5 character_6 character_7 character_8 enemy_1 enemy_2 enemy_3 enemy_4 enemy_5 enemy_6 enemy_7 main paths pause select_level winlose ui character_selection_levelup_unlock fx tutorial end locale".split(" "),J={};a.start=function(){k=new createjs.LoadQueue(!1);k.addEventListener("fileload",L);k.addEventListener("error",p);k.addEventListener("fileerror",p);k.addEventListener("complete",
A);k.loadFile({src:"images/preloader.json",type:"spritesheet",id:"preloader",loadTimeout:9E5},!1);k.load()};var L=function(b){n[b.item.id]=b.result},A=function(b){k.removeEventListener("complete",A);b=preloader.preloadContainer=new createjs.Container;main.stage.addChild(b);if(d){d=!1;var a=new createjs.Shape;a.graphics.beginFill("rgba(0, 0, 0, 1)");a.graphics.drawRect(0,0,main.stage.canvas.width,main.stage.canvas.height);a.graphics.endFill();a.cache(0,0,main.stage.canvas.width,main.stage.canvas.height);
var c=new createjs.Text("Loading...","25px monospace","#FFF"),u=c.getBounds();c.x=main.stage.canvas.width/2-u.width/2;c.y=main.stage.canvas.height/2-u.height/2;createjs.Tween.get(c).wait(500).call(function(){c.text="Loading."}).wait(500).call(function(){c.text="Loading.."}).wait(500).call(function(){c.text="Loading..."}).wait(500).call(function(){c.text="Loading"}).loop=!0;b.addEventListener("removed",function(){createjs.Tween.removeTweens(c)});b.addChild(a,c)}else n.preloader&&(b.loadIcon=main.createScreenItem("preloader",
"preloader_icon"),b.addChild(main.createScreenItem("preloader","preloader_background"),b.loadIcon));r=new createjs.LoadQueue(!1);r.addEventListener("fileload",C);r.addEventListener("complete",v);r.addEventListener("error",p);r.addEventListener("fileerror",p);t=new createjs.LoadQueue(!1);t.addEventListener("fileload",C);t.addEventListener("complete",e);t.addEventListener("error",p);t.addEventListener("fileerror",p);for(b=0;b<R.length;++b)t.loadFile({src:"images/"+R[b]+".json",type:"json",id:R[b],loadTimeout:9E5},
!1);a=[];for(b=0;b<LevelConfig.length;++b)u=LevelConfig[b].map,0>a.indexOf(u)&&(a.push(u),t.loadFile({src:"levels/"+u+".json",type:"json",id:u,isTilemap:!0,loadTimeout:9E5},!1));t.load();l=new createjs.LoadQueue(!1);l.addEventListener("fileload",C);l.addEventListener("complete",h);l.addEventListener("error",p);l.addEventListener("fileerror",p);createjs.Sound.alternateExtensions=SoundsConfig.alternateExtensions;l.installPlugin(createjs.Sound);b=[];b.length=0;for(var y in SoundsConfig){var a=SoundsConfig[y],
I;for(I in a)(u=a[I].file)&&0>b.indexOf(u)&&(b.push(u),l.loadFile({src:"sounds/"+u+"."+SoundsConfig.mainExtension,type:"sound",id:u,loadTimeout:9E5},!1))}l.load()},C=function(a){if("sound"==a.item.type){if("mp3"==a.item.ext)for(var d in SoundsConfig){var e=SoundsConfig[d],h;for(h in e){var k=e[h];if(k.file&&0<=a.item.src.indexOf(k.file)){var l=MP3_Offsets[k.file];l&&(l.startOffset||0===l.startOffset?l.endOffset&&0!=l.endOffset&&a.result.duration?(k.startTime=l.startOffset,k.duration=1E3*a.result.duration-
l.endOffset):k.offset=l.startOffset:console.log("Bad MP3 config for",k.file))}}}}else if("image"==a.item.type)b[a.item.id]=a.result;else if("json"==a.item.type)if(a.item.isTilemap){d=a.result;c[a.item.id]=d;for(e in d.layers)if(a=d.layers[e],"game"===a.name){h=a.data;a.data=[];for(var l=[],m=0;m<a.width;++m){l.push([]);for(var n=0;n<a.height;++n)l[l.length-1].push(0)}for(m=0;m<h.length;++m)n=m%a.width,l[n][(m-n)/a.width]=h[m];d.walkArea=new Graph(l,{diagonal:!0})}else if("path"===a.name)for(k in a.objects)for(h=
a.objects[k],l=h.polyline,m=0;m<l.length;++m)l[m].x+=h.x,l[m].y+=h.y;e=d.tilesets;for(m=e.length-1;0<=m;--m)k=e[m],void 0!=k.image&&(k.image.indexOf("walk_area")?e.splice(m,1):k.image=k.image.replace("../export","images"));hb.Tilemap.LoadTileSheets(d,function(b){})}else for(d=a.result,J[a.item.id]=d,e=0;e<d.images.length;++e)k=d.images[e],k in r._loadItemsBySrc||r.loadFile({src:k,type:"image",id:k,loadTimeout:9E5},!1)},p=function(b){d=!0;var a;a="----------------------------------\n"+("ERROR: "+b.title+
"\n");b.data&&(a+="\tid  : "+b.data.id+"\n",a+="\tsrc : "+b.data.src+"\n",a+="\ttype: "+b.data.type+"\n");console.log(a+"----------------------------------\n");console.log(b)}})();(function(){window.debug=window.debug||!1;var e=window.main=window.main||{};utils.savePrefix="winter_2017_td_game";var h=e.FPS=24,v=e.DT_MS=1E3/h,y=e.DT_S=1/h,a=e.DELTA_OBJ={delta:v};e.preloader=null;e.STATE={PRELOAD:-1,MENU:0,GAME:1};e.state=e.STATE.PRELOAD;e.startLoading=function(){var b=document.getElementById("game_canvas");b.style.backgroundColor="#000000";utils.setupWindowsResize(800/600,b);e.stage=new createjs.Stage(b);e.stage.enableMouseOver(15);preloader.start();window.setInterval(e.update,
v)};e.charactersLevel=null;e.start=function(){if(debug&&debug.charactersLevel)e.charactersLevel=debug.charactersLevel;else if(e.charactersLevel=utils.load("characters_level_info",null),null==e.charactersLevel){e.charactersLevel={};for(var b in CharacterConfig)e.charactersLevel[b]="char_1"==b?0:-1}menu.init();game.init();e.stage.addChild(game.container);e.stage.addChild(menu.popupsContainer);e.stage.addChild(menu.screenContainer);e.stage.addChild(menu.transitionCover);e.state=e.STATE.MENU;menu.mainScreen.alpha=
0;menu.screenContainer.addChild(menu.mainScreen);createjs.Tween.get(menu.mainScreen).to({alpha:1},500).call(function(){e.stage.removeChild(preloader.preloadContainer)});menu.bgm.play();createjs.Tween.get(menu.bgm).to({volume:1},500);debug&&debug.skipToGame&&menu.startLevel(debug.skipToGame.levelIndex)};e.update=function(){switch(e.state){case e.STATE.MENU:menu.update(y);break;case e.STATE.GAME:game.update(y)}e.stage.update(a)};e.createScreenItem=function(b,a){var c=new createjs.Sprite(ss[b]);c.gotoAndPlay(a);
return c};var c=[];e.registerSFXToggle=function(b,a,d){b.onAnim=(void 0===a?"btn_sfx_on_idle":a)||"on";b.offAnim=(void 0===d?"btn_sfx_off_idle":d)||"off";b.gotoAndStop(createjs.Sound.muted?b.offAnim:b.onAnim);b.stop();c.push(b);null!=b.currentAnimation&&(b.on("pressup",function(){b.gotoAndPlay(createjs.Sound.muted?"btn_sfx_off_idle":"btn_sfx_on_idle")}),b.on("mouseout",function(){b.gotoAndPlay(createjs.Sound.muted?"btn_sfx_off_idle":"btn_sfx_on_idle")}),b.on("mouseover",function(){b.gotoAndPlay(createjs.Sound.muted?
"btn_sfx_off_over":"btn_sfx_on_over");utils.playSound(SoundsConfig.button_over)}),b.on("mousedown",function(){b.gotoAndPlay(createjs.Sound.muted?"btn_sfx_off_down":"btn_sfx_on_down")}));b.addEventListener("click",function(a){createjs.Sound.muted=!createjs.Sound.muted;createjs.Sound.muted||(utils.playSound(SoundsConfig.button_click_back),utils.audioFixCheck());utils.save("sound_muted",createjs.Sound.muted);a=createjs.Sound.muted?"offAnim":"onAnim";for(var d in c)c[d].gotoAndStop(b[a])})}})();
