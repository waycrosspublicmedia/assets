function LoadSpritesheetImage(a,b,c){var d=LoadCallbacks[a];d||(d=LoadCallbacks[a]={OnComplete:[]}),d.OnComplete.push(function(b){b?c&&c(!0,null):c&&c(!1,'Loading of "'+a+'" failed.')}),game.load.spritesheet(a,b.relativePath,b.frameWidth,b.frameHeight,b.frameMax,b.frameMax,b.spacing),game.load.start()}function LoadSlushSpritesheet(a,b){if(game.cache.checkImageKey(a))return void(b&&b(!0,null));var c=game.cache.getJSON(a);if(c)LoadSpritesheetImage(a,c,function(a,c){b&&b(a,c)});else{var d=LoadCallbacks[a];d||(d=LoadCallbacks[a]={OnComplete:[]}),d.OnComplete.push(function(d){d?(c=game.cache.getJSON(a),LoadSpritesheetImage(a,c,function(a,c){b&&b(a,c)})):b&&b(null,'Loading of "'+a+'" failed.')}),game.load.json(a,"assets/"+a),game.load.start()}}function OnFileComplete(a,b,c,d,e){var f=LoadCallbacks[b];if(f){delete LoadCallbacks[b];for(var g=0;g<f.OnComplete.length;++g)f.OnComplete[g](c)}}function OnFileError(a,b){var c=LoadCallbacks[a];if(c){for(var d=0;d<c.OnError.length;++d)c.OnError[d](success);delete LoadCallbacks[a]}}function ParsePrefabJSONObject(a,b,c){var d=game.add.group();d.x=a,d.y=b;for(var e=0;e<c.elements.length;++e){var f=ParsePrefabJSONElement(c.elements[e]);f&&d.addChild(f)}return d}function ParsePrefabJSONElement(a){switch(a.type){case"sprite":var b=Assets.SpriteFactory(a.position.x,a.position.y,a.relativePath.substring(assetsDir.length));if(!b)return null;b.name=a.name,b.rotation=a.rotation,b.scale.x=a.scale.x,b.scale.y=a.scale.y,b.anchor.x=a.anchor.x,b.anchor.y=a.anchor.y,b.pivot.x=a.pivot.x,b.pivot.y=a.pivot.y;for(var c=0;c<a.children.length;++c){var d=ParsePrefabJSONElement(a.children[c]);d&&b.addChild(d)}return b;case"button":var e=Assets.ButtonFactory(a.position.x,a.position.y,a.relativePath.substring(assetsDir.length),void 0,void 0,void 0,2,3,1,0);e.name=a.name,e.rotation=a.rotation,e.scale.x=a.scale.x,e.scale.y=a.scale.y,e.anchor.x=a.anchor.x,e.anchor.y=a.anchor.y,e.pivot.x=a.pivot.x,e.pivot.y=a.pivot.y;for(var f=0;f<a.children.length;++f){var g=ParsePrefabJSONElement(a.children[f]);g&&e.addChild(g)}return e;case"spine":var h=Assets.SpineFactory(a.position.x,a.position.y,a.relativePath.substring(assetsDir.length));h.name=a.name,h.rotation=a.rotation,h.scale.x=a.scale.x,h.scale.y=a.scale.y,h.pivot.x=a.pivot.x,h.pivot.y=a.pivot.y;for(var i=0;i<a.children.length;++i){var j=ParsePrefabJSONElement(a.children[i]);j&&h.addChild(j)}return h;case"prefab":var k=Assets.PrefabFactory(a.position.x,a.position.y,a.relativePath.substring(assetsDir.length));k.name=a.name,k.rotation=a.rotation,k.scale.x=a.scale.x,k.scale.y=a.scale.y,k.pivot.x=a.pivot.x,k.pivot.y=a.pivot.y;for(var l=0;l<a.children.length;++l){var m=ParsePrefabJSONElement(a.children[l]);m&&k.addChild(m)}return k;case"container":var n=game.add.group();n.x=a.position.x,n.y=a.position.y,n.name=a.name,n.rotation=a.rotation,n.scale.x=a.scale.x,n.scale.y=a.scale.y,n.pivot.x=a.pivot.x,n.pivot.y=a.pivot.y;for(var o=0;o<a.children.length;++o){var p=ParsePrefabJSONElement(a.children[o]);p&&n.addChild(p)}return n;case"polygon":var q=game.add.graphics(a.position.x,a.position.y);q.name=a.name,q.rotation=a.rotation,q.scale.x=a.scale.x,q.scale.y=a.scale.y,q.anchor.x=a.anchor.x,q.anchor.y=a.anchor.y,q.pivot.x=a.pivot.x,q.pivot.y=a.pivot.y,q.data.vertices=a.vertices;for(var r=0;r<a.children.length;++r){var s=ParsePrefabJSONElement(a.children[r]);s&&q.addChild(s)}return q;case"path":var t=game.add.graphics(a.position.x,a.position.y);t.name=a.name,t.rotation=a.rotation,t.scale.x=a.scale.x,t.scale.y=a.scale.y,t.pivot.x=a.pivot.x,t.pivot.y=a.pivot.y,t.data.vertices=a.vertices;for(var u=0;u<a.children.length;++u){var v=ParsePrefabJSONElement(a.children[u]);v&&t.addChild(v)}return t}return null}function AvivaBuzzBike(a,b,c,d,e){var f=!1,g=new Target(a,b,c,d,e);c.scale.x=e.scale,g.velocity.x=d.speed*e.scale;var h=c.position.y,i=0,j=g.OnUpdate;return g.OnUpdate=function(){return j(),f||g.wasHit?g:(i+=a.time.elapsedMS/1e3*Math.PI*d.bobsPerSecond,void(c.position.y=h+Math.sin(i)*d.bobDistance))},g.OnSpawn=function(){AvivaBuzzBike.instanceExists=!0},g.OnDespawn=function(){AvivaBuzzBike.instanceExists=!1},AvivaBuzzBike.CanSpawn=function(){return!AvivaBuzzBike.instanceExists},g.OnWaveEnd=function(){f=!0,c.body&&(g.velocity.y=-d.waveEndSpeed)},g}function AvivaScreen(a,b){function c(){var d;d=j?j[k]:b[h];var e=function(){f.dialogueActions[d.action](d.arg);var e,g;j?(k++,e=k,g=j):(h++,e=h,g=b),e<g.length&&!window.Cheats.disableAvivaScreen?c():j?(j=null,h++,c()):(game.add.tween(f.position).to({x:a.screen.offScreenPosition.x,y:a.screen.offScreenPosition.y},Phaser.Timer.SECOND*a.screen.moveTime,Phaser.Easing.Quadratic.In,!0),game.time.events.add(Phaser.Timer.SECOND*a.screen.moveTime,function(){f.destroy(),VoiceOverManager.SetMinimumPriority(0)}),WaveManager.currentInstance.StartFirstWave())};d.delay?game.time.events.add(Phaser.Timer.SECOND*d.delay,e):e()}var d=Assets.SpriteFactory(0,0,"sprites/ScreenOverlay.png");d||(d=game.add.group()),d.visible=!1;var e=null,f=Assets.SpriteFactory(0,0,"sprites/UI/AvivaScreen.png"),g=Assets.SpriteSheetFactory(0,0,"AvivaScreen_Sheet");f.addChild(g),f.position=new Phaser.Point(a.screen.offScreenPosition.x,a.screen.offScreenPosition.y),game.add.tween(f.position).to({x:a.screen.onScreenPosition.x,y:a.screen.onScreenPosition.y},Phaser.Timer.SECOND*a.screen.moveTime,Phaser.Easing.Quadratic.Out,!0),g.position=new Phaser.Point(a.avatar.position.x,a.avatar.position.y),g.scale.set(a.avatar.scale),g.anchor.set(.5);var h=0,i=null,j=null,k=-1;return f.dialogueActions={UpdateAvatarFrame:function(){var b=a.avatar.poses[g.pose];if(g.isMouthMoving){for(var c=[],d=0;d<b.talkFrames.length;d++)b.talkFrames[d]!=g.frame&&c.push(b.talkFrames[d]);var e=a.avatar.mouthMoveTime,h=e.min+(e.max-e.min)*Math.random();g.frame=c[Math.floor(Math.random()*c.length)],i=game.time.events.add(Phaser.Timer.SECOND*h,f.dialogueActions.UpdateAvatarFrame)}else g.frame=b.restFrame},SetPose:function(a){i&&game.time.events.remove(i),g.pose=a,f.dialogueActions.UpdateAvatarFrame()},StartMouthMovement:function(){i&&game.time.events.remove(i),g.isMouthMoving=!0,f.dialogueActions.UpdateAvatarFrame()},StopMouthMovement:function(){i&&game.time.events.remove(i),g.isMouthMoving=!1,f.dialogueActions.UpdateAvatarFrame()},PlayVO:function(b){VoiceOverManager.Play(b,a.voPriority,3,!0)},DesktopSubSequence:function(a){game.device.desktop&&(j=a,k=-1)},MobileSubSequence:function(a){game.device.desktop||(j=a,k=-1)},ShowImage:function(a){d.visible=!0,a&&(e=Assets.SpriteFactory(550,270,a),e.anchor.set(.5))},HideImage:function(){d.visible=!1,e.parent.removeChild(e),e=null}},f.dialogueActions.SetPose("default"),c(),f}function Bee(a,b,c,d,e){var f=!1,g=new Target(a,b,c,d,e);c.scale.x=-e.scale;var h=c.x,i=0,j=c.position.y,k=0,l=g.OnUpdate;return g.OnUpdate=function(){if(l(),!f&&!g.wasHit){var b=Assets.LowEndDevice()?.5:1;h+=d.speed*(a.time.elapsedMS/1e3)*e.scale,i+=a.time.elapsedMS/1e3*Math.PI*d.shimmyPerSecond*b,c.position.x=h+Math.sin(i)*d.shimmyDistance*e.scale,k+=a.time.elapsedMS/1e3*Math.PI*d.bobsPerSecond*b,c.position.y=j+Math.sin(k)*d.bobDistance}},g.OnWaveEnd=function(){f=!0,c.body&&(g.velocity.y=-d.waveEndSpeed)},g}function Beetle(a,b,c,d,e){var f=!1,g=this,h=new Target(a,b,c,d,e);c.anchor={x:.5,y:.5};var i=b.getByName("beetleLandingPoint").position;h.phase=Beetle.Phase.MoveToLandingPoint,this.TakeFlight=function(){f||h.wasHit||c.animations.currentAnim&&c.animations.play(d.animations[1].name).onComplete.add(function(){c.animations.play(d.animations[0].name),h.phase=Beetle.Phase.FlyAway},this)};var j=h.OnUpdate;return h.OnUpdate=function(){if(j(),!f&&!h.wasHit&&h.phase!==Beetle.Phase.Idle){var b=h.phase===Beetle.Phase.MoveToLandingPoint?i:d.destination,e={x:b.x-c.position.x,y:b.y-c.position.y},k=Math.sqrt(e.x*e.x+e.y*e.y),l=a.time.elapsedMS/1e3;if(k>d.speed*l){var m={x:e.x/k,y:e.y/k};h.velocity={x:m.x*d.speed,y:m.y*d.speed}}else h.velocity={x:0,y:0},h.phase++,h.phase===Beetle.Phase.Idle&&(c.animations.play(d.animations[2].name),a.time.events.add(Phaser.Timer.SECOND*d.idleTime,g.TakeFlight,g))}},h.OnWaveEnd=function(){return h},h}function BroFly(a,b,c,d,e){var f=new Target(a,b,c,d,e);return c.scale.x=-e.scale,f.velocity.x=d.speed*e.scale,f.velocity.y=0,f.OnSpawn=function(){BroFly.instanceExists=!0},f.OnDespawn=function(){BroFly.instanceExists=!1},BroFly.CanSpawn=function(){return!BroFly.instanceExists},f.OnWaveEnd=function(){c.body&&(f.velocity.y=-d.waveEndSpeed)},f}function Caterpillar(a,b,c,d,e){function f(){h.wasHit||(c.animations.play(d.animations[1].name),c.body&&(c.body.enable=!1),c.animations.currentAnim?c.animations.currentAnim.onComplete.add(function(){c.destroy()}):c.destroy())}var g=this,h=new Target(a,b,c,d,e);return c.body.enable=!1,c.animations.currentAnim.onComplete.add(function(){c.body.enable=!0,a.time.events.add(Phaser.Timer.SECOND*d.idleTime,f,g)}),h.OnWaveEnd=function(){c.animations.currentAnim&&(c.animations.play(d.animations[1].name),c.animations.currentAnim.onComplete.add(function(){c.destroy()}))},h}function Debris(a,b,c,d,e){var f=!1,g=new Target(a,b,c,d,e);g.velocity.y=d.speed;var h=c.position.x,i=0,j=g.OnUpdate;return g.OnUpdate=function(){j(),f||g.wasHit||(i+=a.time.elapsedMS/1e3*Math.PI*d.bobsPerSecond,c.position.x=h+Math.sin(i)*d.bobDistance)},g.OnWaveEnd=function(){f=!0;var b=c.position.x>a.world.width/2?1:-1;c.body&&(g.velocity.x=d.waveEndSpeed*b)},g}function Dragonfly(a,b,c,d,e){var f=new Target(a,b,c,d,e);return c.scale.x=-e.scale,f.velocity.x=d.speed*e.scale,f.velocity.y=0,f.OnWaveEnd=function(){c.body&&(f.velocity.y=-d.waveEndSpeed)},f}function Hummingbird(a,b,c,d,e){var f=new Target(a,b,c,d,e);return c.scale.x=-e.scale,c.scale.y=Math.abs(e.scale),f.velocity.x=d.speed*e.scale,f.velocity.y=0,f.OnWaveEnd=function(){c.body&&(f.velocity.y=-d.waveEndSpeed)},f}function Moth(a,b,c,d,e){var f=!1,g=new Target(a,b,c,d,e);c.scale.x=-e.scale,g.velocity.x=d.speed*e.scale;var h=c.position.y,i=0,j=g.OnUpdate;return g.OnUpdate=function(){j(),f||g.wasHit||(i+=a.time.elapsedMS/1e3*Math.PI*d.bobsPerSecond,c.position.y=h+Math.sin(i)*d.bobDistance)},g.OnWaveEnd=function(){f=!0,c.body&&(g.velocity.y=-d.waveEndSpeed)},g}function Player(a,b,c,d){function e(a,b){for(var c=a-b;c>=Math.PI;)c-=2*Math.PI;for(;c<-Math.PI;)c+=2*Math.PI;return c}function f(a){a.sprite.destroy(),a.destroy();var b=x.indexOf(a);b>=0&&x.splice(b,1)}function g(a,b){var e=x.indexOf(a);a.velocity.x*=c.projectileSpawning.impactDampingFactor,a.velocity.x*=c.projectileSpawning.impactDampingFactor;var f=a.sprite.animations.play(impactAnimation.name,null,!1);f.onComplete.add(function(){a.sprite.destroy(),a.destroy(),e>=0&&x.splice(e,1)}),WaveManager.currentInstance.score+=b.score,WaveManager.currentInstance.score=Math.max(WaveManager.currentInstance.score,0),-1!==WaveManager.currentInstance.minScore&&WaveManager.currentInstance.score>=WaveManager.currentInstance.minScore&&WaveManager.currentInstance.NextWave(),d.TargetCollisionText(b),b.behaviour.OnHit()}var h=b.getByName(c.name),i=Assets.SpriteSheetFactory(h.position.x,h.position.y,c.sheetPath);i=h.parent.addChildAt(i,h.parent.children.indexOf(h)),i.anchor.set(.5),i.scale=h.scale;for(var j=0;j<c.animations.length;++j)i.animations.add(c.animations[j].name,c.animations[j].frames,c.animations[j].frameRate,c.animations[j].loop);var k=c.projectileSounds.shootSmall,l=c.projectileSounds.shootLarge,m=.75,n=1.25,o=c.angles.playerRotationClamp;o=180-o,o/=2;var p={right:-Phaser.Math.degToRad(o),left:-Phaser.Math.degToRad(180-o)};i.animations.play(c.animations[0].name);var q=SceneHelpers.GetChildWithName(h,c.projectileSpawning.spawnPointName);q.parent=i,shootingAnimation=c.projectileAnimations.shooting,impactAnimation=c.projectileAnimations.impact;var r,s=a.input.activePointer,t=Math.PI/2,u=0,v=!1,w=!1,x=[],y=!1,z=0,A=!1,B={x:0,y:0};i.UpdatePlayerRotation=function(){GameState.currentInstance.isLegendVisible||(a.device.desktop?(A?Phaser.Math.distance(s.worldX,s.worldY,B.x,B.y)>5&&(A=!1):(a.input.keyboard.isDown(Phaser.Keyboard.LEFT)||a.input.keyboard.isDown(Phaser.Keyboard.RIGHT))&&(A=!0),A?(a.input.keyboard.isDown(Phaser.Keyboard.LEFT)&&(u-=2*a.time.elapsedMS/Phaser.Timer.SECOND),a.input.keyboard.isDown(Phaser.Keyboard.RIGHT)&&(u+=2*a.time.elapsedMS/Phaser.Timer.SECOND),u>-.6?u=-.6:-2.6>u&&(u=-2.6)):(u=Phaser.Math.angleBetween(i.position.x,i.position.y,s.worldX,s.worldY),B={x:s.worldX,y:s.worldY}),-t>u?i.rotation=u-c.angles.rotationForNozzleAlignment:i.rotation=u+c.angles.rotationForNozzleAlignment,u>p.right&&t>u&&(i.rotation=p.right),(u<p.left||u>t)&&(i.rotation=p.left)):(u=Phaser.Math.angleBetween(i.position.x,i.position.y,s.worldX,s.worldY),r=e(u,i.rotation),Assets.LowEndDevice()?i.rotation=u:(r>0&&(r<=c.snappingAngleRadians?i.rotation=u:i.rotation+=c.angularVelocity*(a.time.elapsedMS/1e3)),0>r&&(r>=-c.snappingAngleRadians?i.rotation=u:i.rotation-=c.angularVelocity*(a.time.elapsedMS/1e3)))),i.rotation<-t||i.rotation>t?i.scale.y=-Math.abs(i.scale.y):i.scale.y=Math.abs(i.scale.y))};var C=function(){app.paused||y||v||GameState.currentInstance.isLegendVisible||(z=0,i.animations.play(c.animations[1].name),y=!0)},D=function(){if(!v&&y){i.animations.play(c.animations[0].name),globalSpawnPosition=i.toGlobal(q.position);var b=a.add.sprite(globalSpawnPosition.x,globalSpawnPosition.y);b.velocity={x:0,y:0};var e=b.sprite=Assets.SpriteSheetFactory(globalSpawnPosition.x,globalSpawnPosition.y,c.projectileAnimations.spritesheetPath);if(i.parent.addChildAt(b.sprite,i.parent.children.indexOf(i)),a.time.events.add(3*Phaser.Timer.SECOND,function(){e.parent&&e.parent.removeChild(e)}),x.push(b),a.physics.enable(b,Phaser.Physics.ARCADE,!0),b.body.isProjectile=!0,b.body.allowGravity=!1,b.body.setSize(c.projectileSpawning.hitboxSideLength,c.projectileSpawning.hitboxSideLength),b.checkWorldBounds=!0,!b.body){b.destroy();var f=x.indexOf(b);f>=0&&x.splice(f,1)}for(var g=Math.max(Math.floor(shootingAnimation.frames.length*z),1),h=[],j=0;g>j&&j<shootingAnimation.frames.length;++j)h.push(shootingAnimation.frames[j]);b.sprite.animations.add(shootingAnimation.name,h,c.projectileAnimations.fps,!1),b.sprite.animations.add(impactAnimation.name,impactAnimation.frames,c.projectileAnimations.fps),b.sprite.animations.play(shootingAnimation.name),b.sprite.scale={x:i.scale.y,y:i.scale.x},b.anchor={x:.5,y:.5},b.sprite.anchor={x:c.projectileSpawning.spriteAnchor.x,y:c.projectileSpawning.spriteAnchor.y},b.sprite.rotation=u+t;var o=c.projectileSpawning.minSpeed+(c.projectileSpawning.maxSpeed-c.projectileSpawning.minSpeed)*z;b.velocity.x=o*Math.cos(u),b.velocity.y=o*Math.sin(u);var p=z>=.75,r=p?l:k,s=p?{min:m*z,max:n*z}:null;Assets.StreamAudio(r,1,!1,s),y=!1,d.ChargeShotMeter(0)}};a.input.onDown.add(C),a.input.onUp.add(D);var E=a.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);return E.onDown.add(C),E.onUp.add(D),i.UpdateProjectiles=function(b){(s.isDown||a.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR))&&y&&(GameState.currentInstance.isLegendVisible?y&&D():z=Math.min(z+a.time.elapsedMS/1e3/c.projectileSpawning.chargeTime,1),d.ChargeShotMeter(z));for(var e=x.length-1;e>=0;--e)if(x[e]){var h=a.time.elapsedMS/1e3;if(x[e].velocity.y+=1e3*h,x[e].position.x+=x[e].velocity.x*h,x[e].position.y+=x[e].velocity.y*h,x[e].body)if(x[e].body.position.x<0||x[e].body.position.x>a.width||x[e].body.position.y>a.height)f(x[e]);else{var i=Math.atan2(x[e].velocity.y,x[e].velocity.x);x[e].sprite.rotation=i+t,x[e].sprite.position={x:x[e].position.x,y:x[e].position.y};for(var j=0;j<b.length;++j)b[j].behaviour.wasHit===!1&&a.physics.arcade.collide(x[e],b[j],g)}else f(x[e])}},i.OnEndGame=function(){w=!0,v=!0,i.animations.play(c.animations[0].name);for(var a=0;a<x.length;++a)x[a].sprite.destroy(),x[a].destroy()},i.DebugRenderer=function(){for(var b=0;b<x.length;++b)a.debug.body(x[b])},i}function Spider(a,b,c,d,e){function f(){if(!h.wasHit){c.body&&(h.velocity.y=0),c.animations.play(d.animations[1].name);var b=RandomInclusive(d.minIdleTime,d.maxIdleTime);a.time.events.add(Phaser.Timer.SECOND*b,g,this)}}function g(){c.animations.play(d.animations[0].name),c.body&&(h.velocity.y=-d.speed)}var h=new Target(a,b,c,d,e);h.velocity.y=d.speed;var i=RandomInclusive(d.minClimbTime,d.maxClimbTime);return a.time.events.add(Phaser.Timer.SECOND*i,f,this),h.OnWaveEnd=function(){g()},h}function RandomInclusive(a,b){return a=Math.ceil(a),b=Math.floor(b),Math.floor(Math.random()*(b-a+1))+a}function Stars(a,b,c){var d,e,f=[],g=[];this.LoadStars=function(a){for(var b=0;b<c.scores.length;++b)e=c.starBurstName,d=a.getByName(e),d.visible=!1,e=c.starEmptyBaseName+String(b+1),f[b]=a.getByName(e),f[b].visible=!1,e=c.starFilledBaseName+String(b+1),g[b]=a.getByName(e),g[b].visible=!1},this.Show=function(b){for(var e=Math.min(g.length,f.length),h=0,i=0;e>i;++i){var j=b>=c.scores[i]*Math.floor(WaveManager.currentInstance.GetMinScoreMultiplier()),k=j?g[i]:f[i];j&&h++,k.visible=!0,k.alpha=0,k.scale.set(2),a.add.tween(k).to({alpha:1},Phaser.Timer.SECOND*c.tweenTime,Phaser.Easing.Cubic.In,!0,Phaser.Timer.SECOND*c.timeBetweenStars*i),a.add.tween(k.scale).to({x:1,y:1},Phaser.Timer.SECOND*c.tweenTime,Phaser.Easing.Cubic.In,!0,Phaser.Timer.SECOND*c.timeBetweenStars*i)}if(b>=c.scores[c.scores.length-1]*Math.floor(WaveManager.currentInstance.GetMinScoreMultiplier())){d.visible=!0,d.scale.set(0),a.add.tween(d.scale).to({x:1,y:1},Phaser.Timer.SECOND*c.tweenTime,Phaser.Easing.Cubic.Out,!0,Phaser.Timer.SECOND*c.timeBetweenStars*e);var l=function(){d.angle++,a.time.events.add(.015*Phaser.Timer.SECOND,l,this)};l()}return h}}function Target(a,b,c,d,e){var f=this;this.velocity={x:0,y:0},a.physics.enable(c,Phaser.Physics.ARCADE,!0),c.body.allowGravity=!1,c.body.setSize(d.hitbox.width,d.hitbox.height,d.hitbox.xOffset,d.hitbox.yOffset),Target.waterLineHeight=Target.waterLineHeight||SceneHelpers.GetChildWithName(b,"WaterLineFront").y,this.waterLineHit=!1;var g=d.sounds.spawn.id,h={min:d.sounds.spawn.pitchMin,max:d.sounds.spawn.pitchMax};Assets.StreamAudio(g,1,!1,h),a.time.events.add(2.5*Phaser.Timer.SECOND,function(){if(d.sounds.firstSpawnVO&&!VoiceOverManager.previouslyPlayedFlags[d.sounds.firstSpawnVO]){var a=VoiceOverManager.Play(d.sounds.firstSpawnVO,5,2);VoiceOverManager.previouslyPlayedFlags[d.sounds.firstSpawnVO]=a}}),c.checkWorldBounds=!0,this.wasHit=!1,c.events.onEnterBounds.add(function(){c.events.onOutOfBounds.add(function(){c.behaviour.OnDespawn&&c.behaviour.OnDespawn(),GameState.currentInstance.OnTargetDespawn(c),c.destroy()})}),this.OnHit=function(){f.wasHit=!0,c.animations.stop(c.animations.currentAnim.name);var a="enemy"===d.targetType?"audio/player_hitInsect":"audio/player_hitFriend",b={min:.7,max:1.3};Assets.StreamAudio(a,1,!1,b);var e,g="enemy"===d.targetType;if(d.sounds.onHitVO)e=VoiceOverManager.Play(d.sounds.onHitVO,5,1,!0);else{var h=g?"audio/voice/vo_aviva_firstHitBug":"audio/voice/vo_aviva_firstMiss";if(VoiceOverManager.previouslyPlayedFlags[h]){if(!g||Math.random()<.1){var i=g?["audio/voice/vo_chris_hitBug1","audio/voice/vo_chris_hitBug2"]:["audio/voice/vo_chris_miss1","audio/voice/vo_chris_miss2"],j=i[Math.floor(Math.random()*i.length)];e=VoiceOverManager.Play(j,0,2)}}else e=VoiceOverManager.Play(h,5,1),VoiceOverManager.previouslyPlayedFlags[h]=e}g||Assets.StreamAudio("audio/buzzer_bad")},this.OnUpdate=function(){var b=a.time.elapsedMS/1e3;if(c.position.x+=f.velocity.x*b,c.position.y+=f.velocity.y*b,f.wasHit&&(f.velocity.y+=1e3*b),f.wasHit&&!f.waterLineHit&&c.y>=Target.waterLineHeight){f.waterLineHit=!0;var e=d.sounds.splash.id,g={min:d.sounds.splash.pitchMin,max:d.sounds.splash.pitchMax};Assets.StreamAudio(e,1,!1,g)}}}function TargetSpawner(a,b,c,d){function e(d,j){if(!g&&!h){if((!window[d.className].CanSpawn||window[d.className].CanSpawn())&&!GameState.currentInstance.isLegendVisible){var k=Math.random(),l=i.x[0]+(i.x[f.data.vertices.length-1]-i.x[0])*k,m=i.y[0]+(i.y[f.data.vertices.length-1]-i.y[0])*k,n=Assets.SpriteSheetFactory(l,m,d.sheetPath);if(!n)return;f.parent.addChildAt(n,f.parent.children.indexOf(f));for(var o=0;o<d.animations.length;++o)n.animations.add(d.animations[o].name,d.animations[o].frames,d.animations[o].frameRate,d.animations[o].loop);n.targetType=d.targetType,n.score=d.score,n.animations.play(d.animations[0].name),n.anchor={x:.5,y:.5};for(var p,q=0;q<d.spawn.points.length;++q)if(d.spawn.points[q].name===c){p=d.spawn.points[q];break}n.behaviour=new window[d.className](a,b,n,d,p),n.behaviour.OnSpawn&&n.behaviour.OnSpawn(),GameState.currentInstance.OnTargetSpawn(n)}var r=RandomizeTime(d.spawn.frequency,d.spawn.variance);a.time.events.add(Phaser.Timer.SECOND*r,e,this,d)}}for(var f=b.getByName(c),g=!1,h=!1,i={vertices:[],x:[],y:[]},j=0;j<f.data.vertices.length;++j)i.vertices[j]=f.toGlobal(f.data.vertices[j]),i.x[j]=i.vertices[j].x,i.y[j]=i.vertices[j].y;this.StartSpawning=function(b){var c=d.frequency*Assets.LowEndDevice()?4:1,f=d.variance*Assets.LowEndDevice()?4:1,g=RandomizeTime(c,f);a.time.events.add(Phaser.Timer.SECOND*g,e,this,b)},this.OnEndGame=function(){g=!0},this.OnWaveStart=function(){h=!1},this.OnWaveEnd=function(){h=!0}}function RandomizeTime(a,b){var c=a-b+Math.random()*b*2;return c}function RandomInclusive(a,b){return a=Math.ceil(a),b=Math.floor(b),Math.floor(Math.random()*(b-a+1))+a}function UI(a,b,c){var d,e=Assets.PrefabFactory(0,0,"prefabs/chargeShotMeter.prefab"),f=e.getByName("Charge Meter Back"),g=c.scoreText,h=c.minScoreText,i=c.timeText,j=c.targetCollisionText;c.tutorialText;g.imagePosition=b.getByName(g.name).position,i.imagePosition=b.getByName(i.name).position,g.position=b.getByName(g.name).position,i.position=b.getByName(i.name).position,this.PutTextOnScreen=function(){this.scoreText=a.add.text(g.position.x,g.position.y,String(WaveManager.currentInstance.score),{font:g.font,fontSize:g.fontSize,fontWeight:g.fontWeight,fill:g.fill,stroke:g.strokeColor,strokeThickness:g.strokeThickness,align:g.align}),h.position={x:this.scoreText.position.x+this.scoreText.width,y:this.scoreText.position.y+this.scoreText.height},this.minScoreText=a.add.text(h.position.x,g.position.y,"/  "+WaveManager.currentInstance.minScore,{font:h.font,fontSize:h.fontSize,fontWeight:h.fontWeight,fill:h.fill,stroke:h.strokeColor,strokeThickness:h.strokeThickness/2,align:h.align}),this.timeText=a.add.text(i.position.x,i.position.y,"-",{font:i.font,fontSize:i.fontSize,fontWeight:i.fontWeight,fill:i.fill,stroke:i.strokeColor,strokeThickness:i.strokeThickness,align:i.align}),this.timeText.anchor.setTo(.5)},this.UpdateMinScorePosition=function(){this.minScoreText&&this.scoreText&&(this.minScoreText.position={x:this.scoreText.position.x+this.scoreText.width+5,y:this.scoreText.position.y+10})},this.UpdateMinScoreText=function(a){a>=0?this.minScoreText.text="/  "+a:this.minScoreText.text=""},this.UpdateScoreText=function(){this.scoreText&&(this.scoreText.text=String(WaveManager.currentInstance.score))},this.UpdateTextColor=function(a){5>=a?this.timeText.fill="#FA4C2D":this.timeText.fill="#FFCB0D"},this.TargetCollisionText=function(b){var c=a.add.text(b.x,b.y,b.score,{font:j.font,fontSize:j.fontSize,fontWeight:j.fontWeight,stroke:j.strokeColor,strokeThickness:j.strokeThickness});c.anchor.setTo(.5),"enemy"===b.targetType?(c.fill=j.enemyTargetFill,c.text="+"+b.score):c.fill=j.friendlyTargetFill,a.add.tween(c).to({alpha:0},Phaser.Timer.SECOND*j.alphaTimer,Phaser.Easing.Quadratic.Out,!0),a.add.tween(c).to({y:c.y-j.positionAnimation},Phaser.Timer.SECOND*j.positionTimer,Phaser.Easing.Quadratic.Out,!0).onComplete.add(function(){c.destroy()},this)},this.ChargeShotMeter=function(b){d?d.clear():(d=new Phaser.Graphics(a,f.x,f.y),f.parent.addChildAt(d,f.parent.children.indexOf(f)+1),a.input.onUp.add(function(){d.clear()}));var e=c.chargeMeter.fillShape,g=(1-b)*e.left+b*e.right,h=(1-b)*e.topEmpty+b*e.topFull,i=(1-b)*e.bottomEmpty+b*e.bottomFull,j=new Phaser.Point(f.width*e.left,f.height*e.topEmpty),k=new Phaser.Point(f.width*e.left,f.height*e.bottomEmpty),l=new Phaser.Point(f.width*g,f.height*h),m=new Phaser.Point(f.width*g,f.height*i);d.beginFill(parseInt(c.chargeMeter.fill)),d.drawPolygon([j,l,m,k]),d.endFill()},this.OnChrisEndscreenPose=function(){a.add.tween(e.position).to({x:2*-e.width},Phaser.Timer.SECOND,Phaser.Easing.Quadratic.In,!0)}}function WaveManager(a,b,c,d,e){function f(a){for(var b=0;b<h.types.length;++b)if(h.types[b].wave==a)for(var c=h.types[b].spawn.points,d=0;d<c.length;++d)if("INVALID_SPAWN_POINT"!=c[d].name){var f=e[c[d].name];f.StartSpawning(h.types[b])}}var g=this;a.tutorialHasBeenViewed=a.tutorialHasBeenViewed||!1,WaveManager.currentInstance=this;var h=Assets.ConfigFactory("configs/targets.json");this.GetMinScoreMultiplier=function(){return Assets.LowEndDevice()?.5:1},this.currentWave=1,this.wavesCompleted=0,this.minScore=Math.floor(b.waveData[this.wavesCompleted].minScore*this.GetMinScoreMultiplier()),this.timeRemaining=b.waveData[this.wavesCompleted].timeLimit,this.score=0,this.NextWave=function(){if(this.countDownEvent&&a.time.events.remove(this.countDownEvent),this.currentWave>=b.waveData.length||this.score<this.minScore)GameState.currentInstance.EndGame();else if(++this.wavesCompleted,++this.currentWave,this.minScore=Math.floor(b.waveData[this.wavesCompleted].minScore*this.GetMinScoreMultiplier()),d.UpdateMinScoreText(this.minScore),GameState.currentInstance.OnWaveEnd(),this.timeRemaining=b.waveData[this.wavesCompleted].timeLimit,GameState.currentInstance.OnWaveStart(),GameState.currentInstance.ShowLegend(this.currentWave),this.wavesCompleted<=1)VoiceOverManager.Play(b.waveCompleteVOs.firstWave,b.waveCompleteVOs.priority,1);else if(this.wavesCompleted<b.waveCompleteVOs.minWavesForFunFacts)VoiceOverManager.Play(b.waveCompleteVOs.cheers[Math.floor(Math.random()*b.waveCompleteVOs.cheers.length)],b.waveCompleteVOs.priority,1);else if(this.wavesCompleted<b.waveData.length-1){var c,e=[];for(c=0;c<b.waveCompleteVOs.cheers.length;c++)e.push(b.waveCompleteVOs.cheers[c]);for(c=0;c<b.waveCompleteVOs.funFacts.length;c++)e.push(b.waveCompleteVOs.funFacts[c]);VoiceOverManager.Play(e[Math.floor(Math.random()*e.length)],b.waveCompleteVOs.priority,1)}},this.OnLegendDismissed=function(){f(this.currentWave);var c=b.transitionTime;this.WaveTitleTween(c),this.wavesCompleted==b.waveData.length-1&&(VoiceOverManager.Play(b.waveCompleteVOs.bonusRound,b.waveCompleteVOs.priority+1,1),GameState.currentInstance.FadeOutMusic(),a.time.events.add(Phaser.Timer.SECOND,function(){GameState.currentInstance.PlayMusic(music.bonusRound,!1)}))},this.CountDown=function(){this.timeRemaining--,d.timeText.text=this.timeRemaining,d.UpdateTextColor(this.timeRemaining),this.timeRemaining<=0?this.NextWave():this.countDownEvent=a.time.events.add(Phaser.Timer.SECOND,this.CountDown,this)},this.WaveTitleTween=function(c){var d=b.waveData[this.currentWave-1].image,e=Assets.SpriteFactory(-a.cache.getImage(d).width/2,a.world.centerY,d);e.anchor.set(.5);var f=a.add.tween(e.position).to({x:a.world.centerX},Phaser.Timer.SECOND*b.transitionTime/2,Phaser.Easing.Quintic.Out,!0);f.onComplete.add(function(){var c=a.add.tween(e.position).to({x:a.world.width+e.width/2},Phaser.Timer.SECOND*b.transitionTime/2,Phaser.Easing.Quintic.In,!0);c.onComplete.add(function(){this.CountDown(),e.destroy()},this,1)},this,1)},this.StartTutorial=function(){var b=Assets.ConfigFactory("configs/avivaScreen.json");VoiceOverManager.SetMinimumPriority(b.voPriority),a.time.events.add(.5*Phaser.Timer.SECOND,function(){var c=a.tutorialHasBeenViewed?b.sequences.replay:b.sequences.tutorial;a.tutorialHasBeenViewed=!0,AvivaScreen(b,c)})},this.StartFirstWave=function(){GameState.currentInstance.ShowLegend(this.currentWave),VoiceOverManager.ResetPreviouslyPlayedFlags()},window.Cheats=window.Cheats||{},window.Cheats.GoToBonusRound=function(){g.currentWave=b.waveData.length-1,g.score=Math.floor(b.waveData[b.waveData.length-2].minScore*this.GetMinScoreMultiplier()),g.timeRemaining=2},window.Cheats.SkipWave=function(a){void 0===a&&(a=g.minScore),g.timeRemaining=2,g.score=a},window.Cheats.disableAvivaScreen=!1}function GameState(a){function b(b,c){var d=b.getByName(c.back.name),e=b.getByName(c.front.name);e.alpha=c.front.alpha,a.add.tween(e.position).to({x:e.position.x-c.tween.distance},Phaser.Timer.SECOND*c.tween.time,Phaser.Easing.Quadratic.InOut,!0,0,-1,!0),a.add.tween(d.position).to({x:d.position.x-c.tween.distance},Phaser.Timer.SECOND*c.tween.time,Phaser.Easing.Quadratic.InOut,!0,0,-1,!0)}var c=this;GameState.currentInstance=this;var d,e,f,g,h,i,j,k=[],l={},m=!1;this.isLegendVisible=!1,this.currentMusic=null,this.create=function(){d=Assets.PrefabFactory(0,0,"prefabs/game.prefab"),e=Assets.ConfigFactory("configs/gameplay.json"),this.PlayMusic(music.gameplay,!0),b(d,e.WaterLines),this.ui=new UI(a,d,e.UI),g=new Player(a,d,e.ChrisFish,this.ui),g.score=0,a.physics.startSystem(Phaser.Physics.ARCADE),a.physics.arcade.gravity=new Phaser.Point(0,980);for(var c=0;c<e.spawnPoints.length;++c)l[e.spawnPoints[c]]=new TargetSpawner(a,d,e.spawnPoints[c],e.startSpawnTimes);f=new WaveManager(a,e.Waves,g,this.ui,l),playbutton=d.getByName("playbutton"),playbutton.visible=!1,starScore=new Stars(a,d,e.starsScore),starScore.LoadStars(d),h=d.getByName("Chris_Win"),h.visible=!1,chrisLosePose=d.getByName("Chris_Lose"),chrisLosePose.visible=!1,this.ui.PutTextOnScreen(),f.StartTutorial(),i=d.getByName("ScreenOverlay")||a.add.group(),j=Assets.PrefabFactory(0,0,"prefabs/legends.prefab"),PhaserHelpers.AddButtonOnClick(j.getByName("goButton"),function(){GameState.currentInstance.ShowLegend(0),WaveManager.currentInstance.OnLegendDismissed(),k.visible=!0,m.visible=!1,i.visible=!1,app.paused=!1},this),this.ShowLegend(0);var k=d.getByName("pause button"),m=d.getByName("unpause button");m.visible=!1,PhaserHelpers.AddButtonOnClick(k,function(){k.visible=!1,m.visible=!0,i.visible=!0,app.paused=!0},this),PhaserHelpers.AddButtonOnClick(m,function(){k.visible=!0,m.visible=!1,i.visible=GameState.currentInstance.isLegendVisible,app.paused=!1},this)},this.PlayMusic=function(a,b){Assets.StreamAudio(a,.5,b,null,function(a){GameState.currentInstance.currentMusic=a})},this.FadeOutMusic=function(){GameState.currentInstance.currentMusic&&GameState.currentInstance.currentMusic.fadeOut(Phaser.Timer.SECOND)},this.StopMusic=function(){GameState.currentInstance.currentMusic&&GameState.currentInstance.currentMusic.stop()},this.update=function(){a.time.desiredFps=a.time.suggestedFps,this.ui.UpdateScoreText(),this.ui.UpdateMinScorePosition();for(var b=0;b<k.length;++b)k[b].behaviour.OnUpdate();m||(g.UpdatePlayerRotation(),g.UpdateProjectiles(k))},this.render=function(){},this.OnWaveEnd=function(){for(var a=0;a<k.length;++a)k[a].behaviour.OnWaveEnd();for(var b in l)l[b].OnWaveEnd()},this.OnWaveStart=function(){for(var a=0;a<e.spawnPoints.length;++a)l[e.spawnPoints[a]].OnWaveStart()},this.OnTargetSpawn=function(a){k.push(a)},this.OnTargetDespawn=function(a){var b=k.indexOf(a);b>=0&&k.splice(b,1)},this.EndGame=function(){m=!0,this.OnWaveEnd();for(var b in l)l[b].OnEndGame();g.OnEndGame(),playbutton.visible=!0;var d=starScore.Show(WaveManager.currentInstance.score);WaveManager.currentInstance.currentWave<e.Waves.waveData.length?(GameState.currentInstance.FadeOutMusic(),a.time.events.add(Phaser.Timer.SECOND,function(){GameState.currentInstance.PlayMusic(music.endScreen,!0),GameState.currentInstance.ShowChrisEndscreenPose(d>0)}),VoiceOverManager.Play("audio/voice/vo_aviva_results_"+d,10,0,!0)):(GameState.currentInstance.ShowChrisEndscreenPose(!0),a.time.events.add(2*Phaser.Timer.SECOND,function(){GameState.currentInstance.PlayMusic(music.endScreen,!0),VoiceOverManager.Play("audio/voice/vo_aviva_results_3",10,0,!0)})),PhaserHelpers.AddButtonOnClick(playbutton,function(){m=!1,GameState.currentInstance.currentMusic.stop(),VoiceOverManager.Stop(),a.state.restart()},c)},this.ShowChrisEndscreenPose=function(b){GameState.currentInstance.ui.OnChrisEndscreenPose(),a.add.tween(g.position).to({y:g.position.y+300},Phaser.Timer.SECOND,Phaser.Easing.Quadratic.InOut,!0);var c=b?h:chrisLosePose;c.visible=!0,a.add.tween(c.position).from({x:c.position.x-200,y:c.position.y+300},Phaser.Timer.SECOND/2,Phaser.Easing.Quartic.Out,!0,Phaser.Timer.SECOND);
},this.ShowLegend=function(a){this.isLegendVisible=a>0,i.visible=this.isLegendVisible,j.getByName("level1").visible=1==a,j.getByName("level2").visible=2==a,j.getByName("level3").visible=3==a,j.getByName("level4").visible=4==a,j.getByName("level5").visible=5==a,j.getByName("bonus round").visible=6==a;var b=j.getByName("goButton");b.visible=this.isLegendVisible,a>=5&&(b.position.x=480)}}function LoadingState(a){this.preload=function(){var b=a.add.sprite(a.world.centerX,a.world.centerY,"assets/sprites/SplashScreen.jpg");b.anchor={x:.5,y:.5},b.scale={x:a.width/b.width,y:a.height/b.height};var c=Assets.SpriteSheetFactory(a.world.centerX,a.height-55,"spritesheets/loading.sheet");c.anchor={x:.5,y:.5},c.animations.add("load",[0,1,2,3],8,!0),c.animations.play("load"),a.load.onLoadComplete.addOnce(function(){Assets.InitFonts(),a.state.start("start")}),Assets.InitAssets()}}function StartState(a){var b="TTARK",c=0,d=!1;this.create=function(){var e,f=Assets.PrefabFactory(0,0,"prefabs/title.prefab"),g=f.getByName("playbutton");Assets.StreamAudio("audio/voice/vo_chris_title",1,!1,null,function(a){e=a}),window.music={gameplay:"audio/music/gameplay",bonusRound:"audio/music/bonusround",endScreen:"audio/music/endscreen"},PhaserHelpers.AddButtonOnClick(g,function(){try{a.sound.context.resume()}catch(b){}d&&(music.gameplay="audio/music/easteregg"),e&&e.stop(),a.state.start("game")},this),document.body.addEventListener("keypress",function(a){if(c!==b.length){var e=String.fromCharCode(a.charCode).toUpperCase();e===b[c]?(c++,c===b.length&&(d=!0)):c=0}})}}var assetsDir="assets/",LoadCallbacks={},DoNotLoadList=[],Assets={InitAssets:function(){game.load.crossOrigin=!0,game.load.onFileComplete.add(OnFileComplete,{}),game.load.onFileError.add(OnFileError,{});for(var a=0;a<PreloadList.audio.length;++a){var b=PreloadList.audio[a];b.path||(b.path=game.device.desktop?b.path_desktop:b.path_mobile);var c=this.GetSupportedAudioPaths(b.path);game.load.audio(b.key,c,!0)}for(var d=0;d<PreloadList.images.length;++d){var e=PreloadList.images[d];e.skipOnLowEnd&&Assets.LowEndDevice()?DoNotLoadList.push(e.key):(e.path||(e.path=game.device.desktop?e.path_desktop:e.path_mobile),game.load.image(e.key,e.path,!0))}for(var f=0;f<PreloadList.prefabs.length;++f){var g=PreloadList.prefabs[f];game.load.json(g.key,g.path,!0)}for(var h=0;h<PreloadList.configs.length;++h){var i=PreloadList.configs[h];game.load.json(i.key,i.path,!0)}for(var j=0;j<PreloadList.spine.length;++j){var k=PreloadList.spine[j];game.load.spine(k.key,k.path)}for(var l=0;l<PreloadList.spritesheets.length;++l){var m=PreloadList.spritesheets[l];m.skipOnLowEnd&&Assets.LowEndDevice()?DoNotLoadList.push(m.key):game.load.spritesheet(m.key,m.relativePath,m.frameWidth,m.frameHeight,m.frameMax,m.frameMax,m.spacing)}var n=Assets.ConfigFactory("configs/fonts.json");if(n)for(var o=0;o<n.preloadList.length;++o){var p=n.preloadList[o],q=document.createElement("style");q.appendChild(document.createTextNode("@font-face { font-family: "+p.name+"; src: url('"+p.url+"') format('"+p.format+"');")),document.head.appendChild(q);var r=game.add.text(0,0,"Loading fonts...",{font:p.name});r.alpha=0}},LowEndDevice:function(){return game.device.iOS?game.device.iOSVersion<10:!1},InitFonts:function(){var a=Assets.ConfigFactory("configs/fonts.json");if(a)for(var b=0;b<a.preloadList.length;++b){var c=a.preloadList[b],d=document.createElement("style");d.appendChild(document.createTextNode("@font-face { font-family: "+c.name+"; src: url('"+c.url+"') format('"+c.format+"');")),document.head.appendChild(d);var e=game.add.text(0,0,"Loading fonts...",{font:c.name,fontSize:50});e.alpha=0}},SpriteFactory:function(a,b,c,d,e,f){if(game.cache.checkImageKey(c)){var g=game.add.sprite(a,b,c,d,e);return f&&f(g,null),g}if(-1!==DoNotLoadList.indexOf(c))return null;var h=LoadCallbacks[c];return h||(h=LoadCallbacks[c]={OnComplete:[]}),h.OnComplete.push(function(g){if(g){var h=game.add.sprite(a,b,c,d,e);f&&f(h,null)}else f&&f(null,'Loading of "'+c+'" failed.')}),game.load.image(c,"assets/"+c,!0),game.load.start(),null},AudioFactory:function(a,b,c,d,e){if(game.cache.checkSoundKey(a)){var f=game.add.audio(a,b,c,d);return e&&e(f),f}var g=LoadCallbacks[a];g||(g=LoadCallbacks[a]={OnComplete:[]}),g.OnComplete.push(function(f){if(f){var g=game.add.audio(a,b,c,d);e&&e(g,null)}else e&&e(null,'Loading of "'+a+'" failed.')});var h=this.GetSupportedAudioPaths("assets/"+a);return game.load.audio(a,h,!0),game.load.start(),null},PrefabFactory:function(a,b,c,d){var e=game.cache.getJSON(c);if(e){var f=ParsePrefabJSONObject(a,b,e);return d&&d(f,null),f}var g=LoadCallbacks[c];return g||(g=LoadCallbacks[c]={OnComplete:[]}),g.OnComplete.push(function(e){if(e){var f=game.cache.getJSON(c),g=ParsePrefabJSONObject(a,b,f);d&&d(g,null)}else d&&d(null,'Loading of "'+c+'" failed.')}),game.load.json(c,"assets/"+c),game.load.start(),null},ConfigFactory:function(a,b){var c=game.cache.getJSON(a);if(c)return b&&b(c,null),c;var d=LoadCallbacks[a];return d||(d=LoadCallbacks[a]={OnComplete:[]}),d.OnComplete.push(function(c){if(c){var d=game.cache.getJSON(a);b&&b(d,null)}else b&&b(null,'Loading of "'+a+'" failed.')}),game.load.json(a,"assets/"+a),game.load.start(),null},SpineFactory:function(a,b,c,d){if(game.cache.spine.hasOwnProperty(c)){var e=game.add.spine(a,b,c);return d&&d(e,null),e}var f=LoadCallbacks[c];return f||(f=LoadCallbacks[c]={OnComplete:[]}),f.OnComplete.push(function(e){if(e){var f=game.add.spine(a,b,c);d&&d(f,null)}else d&&d(null,'Loading of "'+c+'" failed.')}),game.load.spine(c,"assets/"+c),game.load.start(),null},ButtonFactory:function(a,b,c,d,e,f,g,h,i,j,k){if(game.cache.checkImageKey(c)){var l=game.add.button(a,b,c,e,f,g,h,i,j);return void 0!==k&&(l.DisableButton=function(){this.input.enabled=!1,this.setFrames(k,k,k,k)},l.EnableButton=function(){this.input.enabled=!0,this.setFrames(g,h,i,j)}),d&&d(l,null),l}return LoadSlushSpritesheet(c,function(k){if(k){var l=game.add.button(a,b,c,e,f,g,h,i,j);d&&d(l,null)}else d&&d(null,'Loading of "'+c+'" failed.')}),null},SpriteSheetFactory:function(a,b,c,d){if(game.cache.checkImageKey(c)){var e=game.add.sprite(a,b,c);return d&&d(e,null),e}return-1!==DoNotLoadList.indexOf(c)?null:(LoadSlushSpritesheet(c,function(e){if(e){var f=game.add.sprite(a,b,c,frame,group);d&&d(f,null)}else d&&d(null,'Loading of "'+c+'" failed.')}),null)},StreamAudio:function(a,b,c,d,e){var f=function(f,g){if(e&&e(f,g),f){var h=Assets.StreamAudio.currentSounds=Assets.StreamAudio.currentSounds||{},i=h[a];i&&i.onStop.remove(i.stopCallback),h[a]=f,f.stopCallback=function(){h[a]=null,game.cache.removeSound(a),f.onStop.remove(f.stopCallback)},f.onStop.add(f.stopCallback),f.play(void 0,0,b,c),d&&f._sound&&(f._sound.playbackRate.value=d.min+(d.max-d.min))}};this.AudioFactory(a,b,c,!0,f)},GetSupportedAudioPaths:function(a){return[a+".ogg",a+".mp3",a+".m4a"]}},PhaserHelpers={TweenTint:function(a,b,c){var d=arguments[3];void 0===d&&(d=1e3);var e=arguments[4];void 0===e&&(e=null);var f=arguments[5];void 0===f&&(f=!1);var g=arguments[6];void 0===g&&(g=0);var h=arguments[7];void 0===h&&(h=0);var i=arguments[8];void 0===i&&(i=!1);var j={step:0},k=game.add.tween(j).to({step:100},d,e,f,g,h,i);return k.onUpdateCallback(function(){a.tint=Phaser.Color.interpolateColor(b,c,100,j.step)}),a.tint=b,k},AddButtonOnClick:function(a,b,c){b&&a.onInputUp.add(function(a,c,d){d&&b()},c)}},PolygonHelpers={GetGlobalVerticiesFromSlushPolygon:function(a){if(a&&a.data&&a.data.vertices){game.stage.updateTransform();for(var b=[],c=0;c<a.data.vertices.length;++c)b.push(a.toGlobal(a.data.vertices[c]));return b}return[]},GetPhysicsDataFromSlushPolygon:function(a){for(var b=this.GetGlobalVerticiesFromSlushPolygon(a),c=[],d=0;d<b.length;++d)c.push(b[d].x-a.x),c.push(b[d].y-a.y);return{density:2,friction:0,bounce:0,filter:{categoryBits:1,maskBits:65535},shape:c}}},SceneHelpers={GetChildrenWithPostfix:function(a,b,c){var d=[];c&&(b=b.toUpper());for(var e=0;e<a.children.length;++e){var f=a.children[e].name;c&&(f=f.toUpper()),f.endsWith(b)&&d.push(a.children[e]);for(var g=this.GetChildrenWithPostfix(a.children[e],b),h=0;h<g.length;++h)d.push(g[h])}return d},GetChildWithName:function(a,b){void 0===a.children;for(var c=0;c<a.children.length;++c){if(a.children[c].name==b)return a.children[c];var d=this.GetChildWithName(a.children[c],b);if(d)return d}return null}};Phaser.Game.prototype.boot=function(){this.isBooted||(this.onPause=new Phaser.Signal,this.onResume=new Phaser.Signal,this.onBlur=new Phaser.Signal,this.onFocus=new Phaser.Signal,this.isBooted=!0,PIXI.game=this,this.math=Phaser.Math,this.scale=new Phaser.ScaleManager(this,this._width,this._height),this.stage=new Phaser.Stage(this),this.setUpRenderer(),this.world=new Phaser.World(this),this.add=new Phaser.GameObjectFactory(this),this.make=new Phaser.GameObjectCreator(this),this.cache=new Phaser.Cache(this),this.load=new Phaser.Loader(this),this.time=new Phaser.Time(this),this.tweens=new Phaser.TweenManager(this),this.input=new Phaser.Input(this),this.sound=new Phaser.SoundManager(this),this.physics=new Phaser.Physics(this,this.physicsConfig),this.particles=new Phaser.Particles(this),this.create=new Phaser.Create(this),this.plugins=new Phaser.PluginManager(this),this.net=new Phaser.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug?(this.debug=new Phaser.Utils.Debug(this),this.debug.boot()):this.debug={preUpdate:function(){},update:function(){},reset:function(){}},this.showDebugHeader(),this.isRunning=!0,this.config&&this.config.forceSetTimeOut?this.raf=new Phaser.RequestAnimationFrame(this,this.config.forceSetTimeOut):this.raf=new Phaser.RequestAnimationFrame(this,!1),this._kickstart=!0,window.focus&&(!window.PhaserGlobal||window.PhaserGlobal&&!window.PhaserGlobal.stopFocus),this.raf.start())};var PatchLibraries=function(){game.cache.removeSpriteSheet=function(a){delete this._cache.image[a]};var a=Phaser.Sound.prototype.play;Phaser.Sound.prototype.play=function(b,c,d,e,f){if(!this.context&&this._sound&&this._sound.context&&(this.context=this._sound.context),this.isDecoded)a.call(this,b,c,d,e,f);else{var g=this;this.onDecoded.addOnce(function(){a.call(g,b,c,d,e,f)})}};var b=Phaser.Sound.prototype.resume;Phaser.Sound.prototype.resume=function(){b.call(this),this.update()}},game;!function(){$(window).ready(function(){function a(){game.scale.scaleMode=Phaser.ScaleManager.USER_SCALE,game.input.mspointer.capture=!1,game.state.add("loading",LoadingState),game.state.add("start",StartState),game.state.add("game",GameState),game.state.start("loading"),window.app=new c({name:"archer-fish",canvasId:"stage",displayOptions:{clearView:!0}}),app.on("init",function(){window.app.onWindowResize=$.noop,window.updateCanvasScale(),game.device.touch&&(game.input.mouse.stop(),game.input.touch.start())}),app.on("pause",function(a){game.paused=a}),game.onPause.add(game.sound.pauseAll,game.sound),game.onResume.add(game.sound.resumeAll,game.sound),PatchLibraries()}function b(){game.load.image("assets/sprites/SplashScreen.jpg","assets/sprites/SplashScreen.jpg"),game.load.spritesheet("spritesheets/loading.sheet","assets/sprites/sheets/loading.png",357,94,-1,0,0)}var c=include("springroll.Application");window.game=new Phaser.Game(960,540,Phaser.AUTO,"content",{preload:b,create:a},!0),window.game.config={enableDebug:!0,canvasID:"stage"}})}();var MouseInput={position:new Phaser.Point(0,0),ConvertToPhaserCoordinates:function(){if(void 0!==game){var a=$("canvas").offset();if(a){a=new Phaser.Point(a.left,a.top),Phaser.Point.subtract(MouseInput.position,a,MouseInput.position);var b={width:$("canvas").width(),height:$("canvas").height()},c={horizontal:game.width/b.width,vertical:game.height/b.height};MouseInput.position.multiply(c.horizontal,c.vertical)}}},AddClickHandler:function(a){$("html").click(a)},AddMouseMoveHandler:function(a){$("html").mousemove(a)},AddDoubleClickHandler:function(a){$("html").dblclick(a)}};$("html").mousemove(function(a){MouseInput.position=new Phaser.Point(a.clientX,a.clientY),MouseInput.ConvertToPhaserCoordinates()}),"function"!=typeof Object.assign&&(Object.assign=function(a,b){"use strict";if(null===a||void 0===a)throw new TypeError("Cannot convert undefined or null to object");for(var c=Object(a),d=1;d<arguments.length;d++){var e=arguments[d];if(null!==e&&void 0!==e)for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(c[f]=e[f])}return c}),Object.values=Object.values||function(a){return Object.keys(a).map(function(b){return a[b]})},String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var c=this.toString();("number"!=typeof b||!isFinite(b)||Math.floor(b)!==b||b>c.length)&&(b=c.length),b-=a.length;var d=c.lastIndexOf(a,b);return-1!==d&&d===b}),window.PreloadList={audio:[{key:"vo_aviva_tutorial1",path:"assets/audio/voice/vo_aviva_tutorial1"},{key:"vo_aviva_tutorial2",path:"assets/audio/voice/vo_aviva_tutorial2"},{key:"vo_aviva_tutorial3",path_desktop:"assets/audio/voice/vo_aviva_tutorial3_desktop",path_mobile:"assets/audio/voice/vo_aviva_tutorial3_mobile"},{key:"vo_aviva_tutorial4",path:"assets/audio/voice/vo_aviva_tutorial4"},{key:"vo_aviva_tutorial5",path:"assets/audio/voice/vo_aviva_tutorial5"},{key:"vo_aviva_tutorial6",path:"assets/audio/voice/vo_aviva_tutorial6"},{key:"assets/audio/voice/vo_aviva_replay",path:"assets/audio/voice/vo_aviva_replay"},{key:"assets/audio/music/bonusround",path:"assets/audio/music/bonusround"}],configs:[{key:"configs/fonts.json",path:"assets/configs/fonts.json"},{key:"configs/gameplay.json",path:"assets/configs/gameplay.json"},{key:"configs/avivaScreen.json",path:"assets/configs/avivaScreen.json"},{key:"configs/targets.json",path:"assets/configs/targets.json"}],prefabs:[{key:"prefabs/chargeShotMeter.prefab",path:"assets/prefabs/chargeShotMeter.prefab"},{key:"prefabs/game.prefab",path:"assets/prefabs/game.prefab"},{key:"prefabs/title.prefab",path:"assets/prefabs/title.prefab"},{key:"prefabs/legends.prefab",path:"assets/prefabs/legends.prefab"}],images:[{key:"sprites/FG_Log.png",path:"assets/sprites/FG_Log.png",skipOnLowEnd:!0},{key:"sprites/FG_RightGrass2.png",path:"assets/sprites/FG_RightGrass2.png",skipOnLowEnd:!0},{key:"sprites/FG_RightLeaves.png",path:"assets/sprites/FG_RightLeaves.png",skipOnLowEnd:!0},{key:"sprites/FG_RightLeftDarkLeaves.png",path:"assets/sprites/FG_RightLeftDarkLeaves.png"},{key:"sprites/FG_TreeTrunk.png",path:"assets/sprites/FG_TreeTrunk.png",skipOnLowEnd:!0},{key:"sprites/FG_WillowBranch.png",path:"assets/sprites/FG_WillowBranch.png",skipOnLowEnd:!0},{key:"sprites/FG_WillowFlowerBranches.png",path:"assets/sprites/FG_WillowFlowerBranches.png",skipOnLowEnd:!0},{key:"sprites/GameBG.jpg",path:"assets/sprites/GameBG.jpg"},{key:"sprites/Chris_win.png",path:"assets/sprites/Chris_win.png"},{key:"sprites/Chris_lose.png",path:"assets/sprites/Chris_lose.png"},{key:"sprites/Star_Burst.png",path:"assets/sprites/Star_Burst.png"},{key:"sprites/Star_Empty.png",path:"assets/sprites/Star_Empty.png"},{key:"sprites/Star_Filled.png",path:"assets/sprites/Star_Filled.png"},{key:"sprites/SplashScreen.jpg",path:"assets/sprites/SplashScreen.jpg"},{key:"sprites/UI/Recharge_BGblack.png",path:"assets/sprites/UI/Recharge_BGblack.png"},{key:"sprites/UI/Recharge_BG.png",path:"assets/sprites/UI/Recharge_BG.png"},{key:"sprites/UI/ScoreSymbol.png",path:"assets/sprites/UI/ScoreSymbol.png"},{key:"sprites/UI/TimerSymbol.png",path:"assets/sprites/UI/TimerSymbol.png"},{key:"sprites/UI/AvivaScreen.png",path:"assets/sprites/UI/AvivaScreen.png"},{key:"sprites/UI/Wave/wave1.png",path:"assets/sprites/UI/Wave/wave1.png"},{key:"sprites/UI/Wave/wave2.png",path:"assets/sprites/UI/Wave/wave2.png"},{key:"sprites/UI/Wave/wave3.png",path:"assets/sprites/UI/Wave/wave3.png"},{key:"sprites/UI/Wave/wave4.png",path:"assets/sprites/UI/Wave/wave4.png"},{key:"sprites/UI/Wave/wave5.png",path:"assets/sprites/UI/Wave/wave5.png"},{key:"sprites/UI/Wave/bonus.png",path:"assets/sprites/UI/Wave/bonus.png"},{key:"sprites/WaterHit_110x204.png",path:"assets/sprites/WaterHit_110x204.png"},{key:"sprites/WaterLine.png",path:"assets/sprites/WaterLine.png"},{key:"sprites/WaterLine_long.png",path:"assets/sprites/WaterLine_long.png"},{key:"sprites/WaterStart_110x204.png",path:"assets/sprites/WaterStart_110x204.png"},{key:"sprites/WaterSurface.png",path:"assets/sprites/WaterSurface.png"},{key:"sprites/ScreenOverlay.png",path:"assets/sprites/ScreenOverlay.png",skipOnLowEnd:!0},{key:"sprites/legends/level1.png",path:"assets/sprites/legends/level1.png"},{key:"sprites/legends/level2.png",path:"assets/sprites/legends/level2.png"},{key:"sprites/legends/level3.png",path:"assets/sprites/legends/level3.png"},{key:"sprites/legends/level4.png",path:"assets/sprites/legends/level4.png"},{key:"sprites/legends/level5.png",path:"assets/sprites/legends/level5.png"},{key:"sprites/legends/bonus round.png",path:"assets/sprites/legends/bonus round.png"},{key:"sprites/legends/goButton.png",path:"assets/sprites/legends/goButton.png"},{key:"sprites/tutorials/tutorial1.png",path_desktop:"assets/sprites/tutorials/tutorial1_desktop.png",path_mobile:"assets/sprites/tutorials/tutorial1_mobile.png"},{key:"sprites/tutorials/tutorial2.png",path_desktop:"assets/sprites/tutorials/tutorial2_desktop.png",path_mobile:"assets/sprites/tutorials/tutorial2_mobile.png"},{key:"sprites/tutorials/tutorial3.png",path:"assets/sprites/tutorials/tutorial3.png"}],spine:[],spritesheets:[{relativePath:"assets/sprites/sheets/loading.png",frameWidth:357,frameHeight:94,frameMax:-1,margin:0,spacing:0,key:"spritesheets/loading.sheet"},{relativePath:"assets/sprites/sheets/GoodTargets/Beetle_106x102.png",frameWidth:106,frameHeight:102,frameMax:-1,margin:0,spacing:0,key:"spritesheets/beetle.sheet",skipOnLowEnd:!0},{relativePath:"assets/sprites/sheets/BadTargets/BroFirefly_152x152.png",frameWidth:152,frameHeight:152,frameMax:-1,margin:0,spacing:0,key:"spritesheets/broFirefly.sheet"},{relativePath:"assets/sprites/sheets/BadTargets/BuzzBike_220x130.png",frameWidth:220,frameHeight:130,frameMax:-1,margin:0,spacing:0,key:"spritesheets/buzzBike.sheet"},{relativePath:"assets/sprites/sheets/GoodTargets/Caterpillar_110x90.png",frameWidth:110,frameHeight:90,frameMax:-1,margin:0,spacing:0,key:"spritesheets/caterpillar.sheet"},{relativePath:"assets/sprites/sheets/ChrisArcherfish_340x160.png",frameWidth:340,frameHeight:160,frameMax:-1,margin:0,spacing:0,key:"spritesheets/chrisFish.sheet"},{relativePath:"assets/sprites/sheets/GoodTargets/Dragonfly_120x64.png",frameWidth:120,frameHeight:64,frameMax:-1,margin:0,spacing:0,key:"spritesheets/dragonfly.sheet",skipOnLowEnd:!0},{relativePath:"assets/sprites/sheets/GoodTargets/DragonflyRed_120x64.png",frameWidth:120,frameHeight:64,frameMax:-1,margin:0,spacing:0,key:"spritesheets/dragonflyRed.sheet"},{relativePath:"assets/sprites/sheets/GoodTargets/HoneyBee_78x78.png",frameWidth:78,frameHeight:78,frameMax:-1,margin:0,spacing:0,key:"spritesheets/honeybee.sheet"},{relativePath:"assets/sprites/sheets/BadTargets/HummingbirdGreen_188x188.png",frameWidth:188,frameHeight:188,frameMax:-1,margin:0,spacing:0,key:"spritesheets/hummingbirdGreen.sheet",skipOnLowEnd:!0},{relativePath:"assets/sprites/sheets/BadTargets/HummingbirdRed_188x188.png",frameWidth:188,frameHeight:188,frameMax:-1,margin:0,spacing:0,key:"spritesheets/hummingbirdRed.sheet",skipOnLowEnd:!0},{relativePath:"assets/sprites/sheets/BadTargets/Leaf_120x110.png",frameWidth:120,frameHeight:110,frameMax:-1,margin:0,spacing:0,key:"spritesheets/leaf.sheet",skipOnLowEnd:!0},{relativePath:"assets/sprites/sheets/GoodTargets/MothGrey_68x68.png",frameWidth:68,frameHeight:68,frameMax:-1,margin:0,spacing:0,key:"spritesheets/mothGrey.sheet",skipOnLowEnd:!0},{relativePath:"assets/sprites/sheets/GoodTargets/MothOrange_68x68.png",frameWidth:68,frameHeight:68,frameMax:-1,margin:0,spacing:0,key:"spritesheets/mothOrange.sheet"},{relativePath:"assets/sprites/sheets/GoodTargets/MothPink_68x68.png",frameWidth:68,frameHeight:68,frameMax:-1,margin:0,spacing:0,key:"spritesheets/mothPink.sheet",skipOnLowEnd:!0},{relativePath:"assets/sprites/sheets/PlayAgainButton.png",frameWidth:226,frameHeight:138,frameMax:-1,margin:0,spacing:0,overFrame:1,outFrame:0,downFrame:2,upFrame:3,key:"spritesheets/playagainbutton.sheet"},{relativePath:"assets/sprites/sheets/PlayButton.png",frameWidth:207,frameHeight:116,frameMax:-1,margin:0,spacing:0,overFrame:1,outFrame:0,downFrame:2,upFrame:3,key:"spritesheets/playbutton.sheet"},{relativePath:"assets/sprites/sheets/Button_Pause.png",frameWidth:103,frameHeight:101,frameMax:-1,margin:0,spacing:0,overFrame:1,outFrame:0,downFrame:2,upFrame:3,key:"spritesheets/pauseButton.sheet"},{relativePath:"assets/sprites/sheets/Button_Unpause.png",frameWidth:103,frameHeight:101,frameMax:-1,margin:0,spacing:0,overFrame:1,outFrame:0,downFrame:2,upFrame:3,key:"spritesheets/unpauseButton.sheet"},{relativePath:"assets/sprites/sheets/BadTargets/Seed_86x86.png",frameWidth:86,frameHeight:86,frameMax:-1,margin:0,spacing:0,key:"spritesheets/seed.sheet",skipOnLowEnd:!0},{relativePath:"assets/sprites/sheets/GoodTargets/Spider_60x86.png",frameWidth:60,frameHeight:86,frameMax:-1,margin:0,spacing:0,key:"spritesheets/spider.sheet"},{relativePath:"assets/sprites/sheets/WaterProjectile.png",frameWidth:128,frameHeight:205,frameMax:-1,margin:0,spacing:0,key:"spritesheets/waterProjectile.sheet"},{relativePath:"assets/sprites/UI/AvivaScreen_Sheet.png",frameWidth:142,frameHeight:118,frameMax:-1,margin:0,spacing:0,key:"AvivaScreen_Sheet"},{relativePath:"assets/sprites/legends/goButton.png",frameWidth:179,frameHeight:179,frameMax:-1,margin:0,spacing:0,overFrame:1,outFrame:0,downFrame:2,upFrame:3,key:"spritesheets/goButton.sheet"}]},VoiceOverManager={currentVO:null,currentVOPriority:-1,minimumPriority:0,previouslyPlayedFlags:{vo_aviva_firstHitBug:!1,vo_aviva_firstMiss:!1,vo_martin_onScreen:!1,vo_aviva_onScreen:!1,vo_martin_beetleIntro:!1,vo_aviva_spiderIntro:!1,vo_martin_caterpillarIntro:!1,vo_chris_dragonflyIntro:!1,vo_aviva_beeIntro:!1,vo_aviva_mothIntro:!1,vo_chris_hummingbirdIntro:!1},Play:function(a,b,c,d){if(b<this.minimumPriority)return!1;var e=d&&!this.currentVO;return b>this.currentVOPriority||e?(this.currentVO&&this.currentVO.stop(),this.currentVO=null,this.currentVOPriority=b,Assets.StreamAudio(a,1,!1,null,function(a,b){a&&(VoiceOverManager.currentVO=a,VoiceOverManager.currentVO.onStop.add(function(a){if(a===VoiceOverManager.currentVO){VoiceOverManager.currentVO=null;var b=function(){null===VoiceOverManager.currentVO&&(VoiceOverManager.currentVOPriority=-1)};c?game.time.events.add(Phaser.Timer.SECOND*c,b):b()}}))}),!0):!1},Stop:function(){this.currentVO.stop(),currentVO=null,currentVOPriority=-1,minimumPriority=0},SetMinimumPriority:function(a){this.minimumPriority=a,this.currentVO&&this.currentVOPriority<a&&(this.currentVO.stop(),this.currentVO=null,this.currentVOPriority=-1)},ResetPreviouslyPlayedFlags:function(){for(var a in this.previouslyPlayedFlags)this.previouslyPlayedFlags[a]=!1}},$(document).ready(function(){window.updateCanvasScale=function(){var a=$(window).width(),b=$(window).height();Phaser.Device.iOS&&(a=window.screen.width,b=window.screen.height,(90===window.orientation||-90===window.orientation)&&(a=window.screen.height,b=window.screen.width));var c=a/b,d=game.width/game.height,e=1;e=c>d?b/game.height:a/game.width,game.scale.setUserScale(e,e),game.scale.refresh()},window.addEventListener("resize",window.updateCanvasScale)}),AvivaBuzzBike.instanceExists=!1,Beetle.Phase={MoveToLandingPoint:0,Idle:1,FlyAway:2,Complete:3},BroFly.instanceExists=!1;