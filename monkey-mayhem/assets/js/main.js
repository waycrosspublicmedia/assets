!function(){"use strict";var a=include("springroll.Application"),b=include("springroll.pixi.PixiDisplay"),c=new a({name:"Monkey Mayhem",canvasId:"stage",configPath:"assets/config/config.json",display:b,displayOptions:{clearView:!0,autoPreventDefault:!1},enableHiDPI:!0,keepFocus:!0,state:"load",responsive:!0});c.on("init",function(){window.PBS&&window.PBS.KIDS&&window.PBS.KIDS.KartKingdom||(c.platypus.kartKingdom={isFake:!0,powerUps:{Hummingbird:0,Binoculars:0,Rainforest:0},hasPowerUp:function(a){return this.powerUps[a]?this.powerUps[a]:0},usePowerUps:function(a,b,c){var d="",e=!1;for(d in a)a.hasOwnProperty(d)&&this.powerUps[d]>=a[d]&&(this.powerUps[d]-=a[d],e=!0);e?b():c()},levelComplete:function(){},event:function(a){}},window.console.warn("FAKE Kart Kingdom loaded."))}),window.app=c}(),platypus.Vector2D=function(){var a=function(a,b){this.x=a||0,this.y=b||0},b=a.prototype;return b.set=function(a,b){return this.x=a,this.y=b,this},b.copyValues=function(a){return this.x=a.x,this.y=a.y,this},b.setX=function(a){return this.x=a,this},b.setY=function(a){return this.y=a,this},b.getX=function(){return this.x},b.getY=function(){return this.y},b.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},b.direction=function(){var a=this.magnitude(),b=0;return 0!==a&&(b=Math.acos(this.x/a),this.y<0&&(b=2*Math.PI-b)),b},b.getUnit=function(){var a=this.magnitude();return 0===a?new platypus.Vector2D(0,0):new platypus.Vector2D(this.x/a,this.y/a)},b.getInverse=function(){return new platypus.Vector2D(-this.x,-this.y)},b.normalize=function(){var a=this.magnitude();return 0!==a&&(this.x/=a,this.y/=a),this},b.rotate=function(a){var b=this.x,c=this.y;return this.x=b*Math.cos(a)-c*Math.sin(a),this.y=b*Math.sin(a)+c*Math.cos(a),this},b.add=function(a,b){return this.x+=a,this.y+=b,this},b.addVector=function(a){return this.x+=a.x,this.y+=a.y,this},b.subtractVector=function(a){return this.x-=a.x,this.y-=a.y,this},b.scale=function(a){return this.x*=a,this.y*=a,this},b.dot=function(a){return this.x*a.x+this.y*a.y},b.shortestAngleTo=function(a){return Math.acos(this.dot(a)/(this.magnitude()*a.magnitude()))},b.scalarProjection=function(a){var b=0,c=null;return"number"==typeof a?b=a:(c=a,b=this.shortestAngleTo(c)),this.magnitude()*Math.cos(b)},b.copy=function(){return new a(this.x,this.y)},a}(),function(){"use strict";return platypus.createComponentClass({id:"LogicChargeBar",constructor:function(a){this.state=this.owner.state},events:{"handle-logic":function(){},"percent-complete":function(a){a>=1?this.state.set("ready",!0):this.state.set("frame"+Math.floor(16*a),!0)}},methods:{destroy:function(){this.state=null}}})}(),function(){"use strict";var a=include("createjs.Tween"),b=null,c=null,d=function(){this.root.removeChild(b)},e=function(d,e){this.ending||(this.ending=!0,this.root.appendChild(b),new a(b.style).to({opacity:0},500).to({opacity:1},500).call(function(){c(d,e)}))};return platypus.createComponentClass({id:"TransitionFader",constructor:function(a){c||(c=platypus.game.loadScene.bind(platypus.game)),this.ending=!1,this.root=document.getElementById("content"),platypus.game.loadScene=e.bind(this)},events:{"scene-live":function(c){b?new a(b.style).wait(500).to({opacity:0},500).call(d.bind(this)):(b=document.createElement("div"),b.style.width="100%",b.style.height="100%",b.style.position="absolute",b.style.top="0",b.style.left="0",b.style.zIndex="1200",b.style.opacity="0",b.style.background="#000")}}})}(),function(){"use strict";return platypus.createComponentClass({id:"once-only",properties:{toRelay:{}},publicProperties:{},constructor:function(a){var b=0,c=null;for(b in this.toRelay)c=this.createOnceFunc(b),this.addEventListener(b,c.bind(this))},events:{},methods:{createOnceFunc:function(a){return function(b){this.removeEventListener(a),this.owner.triggerEvent(this.toRelay[a],b)}},destroy:function(){this.toRelay=null}},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"debug-reporter",properties:{summaryInterval:1e3},publicProperties:{},constructor:function(a){this.lastReport=(new Date).getTime(),this.lastSummary=(new Date).getTime(),this.deltaTime=0,this.channels={},this.summaries=[]},events:{tick:function(a){var b=(new Date).getTime(),c=null,d=null;if(b-this.lastSummary>=this.summaryInterval){c={},c.time=b-this.lastSummary,this.lastSummary=b;for(d in this.channels)c[d]=this.channels[d],this.channels[d]=0;this.summaries.push(c)}},"enter-report":function(a){var b=(new Date).getTime();a.channel&&(this.channels[a.channel]||(this.channels[a.channel]=0),this.channels[a.channel]+=b-this.lastReport,this.lastReport=b)},"publish-reports":function(){for(var a={},b=null,c={},d=0;d<this.summaries.length;d++)for(b in this.summaries[d])"number"!=typeof a[b]&&(a[b]=0,c[b]=0),a[b]+=this.summaries[d][b],c[b]+=1;for(b in a)a[b]=a[b]/c[b]}},methods:{destroy:function(){this.channels=null,this.summaries=null}},publicMethods:{}})}(),function(){"use strict";return platypus.createComponentClass({id:"reporter",properties:{channel:"default"},constructor:function(a){},events:{tick:function(){this.owner.triggerEvent("enter-report",{channel:this.channel})}}})}(),function(){"use strict";return platypus.createComponentClass({id:"ProgressBar",events:{load:function(){setTimeout(function(){this.owner.triggerEvent("load-assets")}.bind(this),200)},"file-load":function(a){this.owner.triggerEvent("set-style",{width:Math.floor(100*a.fraction)+"%"})}}})}(),function(){"use strict";return platypus.createComponentClass({id:"nut-brain",constructor:function(a){this.vX=this.owner.dx,this.vY=2e-4,this.aY=.001,this.owner.dx=0,this.falling=!1},events:{"handle-logic":function(a){var b=a.delta;this.falling&&(this.vY+=this.aY*b),this.owner.x+=this.vX*b,this.owner.y+=this.vY*b},"hit-wall":function(){this.vX=this.vX*-.2,this.falling=!0},"hit-floor":function(){this.owner.triggerEvent("destroy-me")}}})}(),function(){"use strict";return platypus.createComponentClass({id:"smart-camera-target",properties:{offsetX:0,offsetY:0,facingOffset:0,pause:0,stopFollowingTime:0},constructor:function(a){this.smartCamera=null,this.stopFollowingTimer=0},events:{"peer-entity-added":function(a){"smart-camera"===a.type&&(this.smartCamera=a)},"handle-logic":function(a){var b=a.delta;this.stopFollowingTimer&&(this.stopFollowingTimer-=b,this.stopFollowingTimer<=0&&this.owner.triggerEvent("stop-following-me"))},"follow-me":function(){this.smartCamera.triggerEvent("follow",{entity:this.owner,pause:this.pause,offset:{x:this.offsetX,y:this.offsetY,facing:this.facingOffset}}),this.stopFollowingTime&&(this.stopFollowingTimer=this.stopFollowingTime)},"stop-following-me":function(){this.smartCamera.triggerEvent("stop-follow",this.owner)},"update-facing-offset":function(a){this.facingOffset=a,this.owner.triggerEvent("follow-me")}}})}(),function(){"use strict";return platypus.createComponentClass({id:"logic-smart-camera",constructor:function(a){this.targetInfo=null,this.prevTargetInfo=null,this.offset=new platypus.Vector,this.goalPosition=new platypus.Vector,this.lead=new platypus.Vector},events:{"handle-logic":function(a){var b=(a.delta,0);this.targetInfo&&(b=this.targetInfo.entity.state.get("right")?this.targetInfo.offset.facing:-this.targetInfo.offset.facing,this.owner.x=this.targetInfo.entity.x+this.targetInfo.offset.x+b,this.owner.y=this.targetInfo.entity.y+this.targetInfo.offset.y)},follow:function(a){var b=0;!this.targetInfo||"chris"!==this.targetInfo.entity.type&&"martin"!==this.targetInfo.entity.type||(this.prevTargetInfo=this.targetInfo),this.targetInfo=a,this.targetInfo&&(b=this.targetInfo.entity.state.get("right")?this.targetInfo.offset.facing:-this.targetInfo.offset.facing,this.owner.x=this.targetInfo.entity.x+this.targetInfo.offset.x+b,this.owner.y=this.targetInfo.entity.y+this.targetInfo.offset.y),this.targetInfo.pause&&(this.owner.parent.trigger("pause-logic",{time:this.targetInfo.pause}),this.owner.parent.trigger("pause-render",{time:this.targetInfo.pause}))},"stop-follow":function(a){this.targetInfo.entity===a&&this.owner.triggerEvent("follow-previous")},"follow-previous":function(){var a=this.targetInfo;this.targetInfo=this.prevTargetInfo,this.prevTargetInfo=a}},methods:{destroy:function(){this.targetInfo=null,this.prevTargetInfo=null}}})}(),function(){"use strict";return platypus.createComponentClass({id:"logic-jiggle",properties:{sweep:15,speed:250},constructor:function(a){this.time=0},events:{"handle-logic":function(a){this.time=(this.time+a.delta/this.speed)%(2*Math.PI),this.owner.rotation=Math.cos(this.time)*this.sweep}}})}(),function(){return platypus.createComponentClass({id:"logic-final-music",constructor:function(a){this.turnUpTimer=26e3,this.started=!1,this.turnedUp=!1},events:{"handle-logic":function(a){!this.turnedUp&&this.started&&(this.turnUpTimer-=a.delta,this.turnUpTimer<=0&&(this.turnedUp=!0,this.owner.trigger("audio-set-volume",.4)))},"start-music":function(){this.started||(this.owner.trigger("party-music"),this.owner.trigger("audio-set-volume",.15),window.GA_obj&&window.GA_obj.trackEvent("Wild Kratts Monkey Mayhem","Game End")),this.started=!0}},methods:{destroy:function(){this.owner.trigger("stop-audio")}}})}(),function(){return platypus.createComponentClass({id:"logic-noisy-monkey",constructor:function(a){this.wasColliding=!1,this.colliding=!1},events:{"handle-logic":function(){var a=0;this.colliding&&!this.wasColliding&&(a=Math.floor(6*Math.random()),0===a?this.owner.trigger("sound-monkey-0"):1===a?this.owner.trigger("sound-monkey-1"):2===a&&this.owner.trigger("sound-monkey-2")),this.wasColliding=this.colliding,this.colliding=!1},"hit-monkey":function(a){this.colliding=!0}},methods:{}})}(),function(){"use strict";var a=include("platypus.StateMap");return platypus.createComponentClass({id:"logic-level-summary",constructor:function(b){this.timePassed=0,this.fruitAppear=1e3,this.monkeyAppear=2e3,this.feedbackAppear=3500,this.kartKingdomAppear=5e3,this.message={text:""},this.otherState=a.setUp("appear",!0),this.feedbackText=["Keep Trying!","Nice Job!","Great!","Amazing!"]},events:{"scene-loaded":function(a){var b=0;this.message.text=a.levelFruitCount+" x ",this.owner.trigger("set-fruit",this.message),this.message.text=a.levelMonkeyCount+" x ",this.owner.trigger("set-monkey",this.message),a.levelName&&(this.message.text=a.levelName+"<BR>Complete!",this.owner.trigger("set-title",this.message)),b=a.levelFruitCount+10*a.levelMonkeyCount,15>b?this.message.text=this.feedbackText[0]:35>b?this.message.text=this.feedbackText[1]:50>b?this.message.text=this.feedbackText[2]:b>=50&&(this.message.text=this.feedbackText[3]),this.owner.trigger("set-feedback",this.message),a.nextScene&&this.owner.trigger("set-scene",a.nextScene),this.owner.trigger("set-persistent-scene-data",a)},"handle-logic":function(a){this.timePassed+=a.delta,-1!==this.fruitAppear&&this.timePassed>this.fruitAppear&&(this.fruitAppear=-1,this.owner.trigger("state-fruit",this.otherState),this.owner.trigger("sound-appear")),-1!==this.monkeyAppear&&this.timePassed>this.monkeyAppear&&(this.monkeyAppear=-1,this.owner.trigger("state-monkey",this.otherState),this.owner.trigger("sound-appear")),-1!==this.feedbackAppear&&this.timePassed>this.feedbackAppear&&(this.feedbackAppear=-1,this.owner.trigger("state-feedback",this.otherState),this.owner.trigger("sound-appear")),-1!==this.kartKingdomAppear&&this.timePassed>this.kartKingdomAppear&&(this.kartKingdomAppear=-1,platypus.game.kartKingdom&&platypus.game.kartKingdom.levelComplete())}},methods:{destroy:function(){this.message=null,this.otherState.recycle()}}})}(),function(){return platypus.createComponentClass({id:"logic-level-end-zone",constructor:function(a){this.used=!1,this.activated=!1,this.chris=!1,this.martin=!1,this.flagMartin=null,this.flagChris=null,this.chrisPlayed=!1,this.martinPlayed=!1},events:{adopted:function(){var a={properties:{x:this.owner.x-this.owner.width/2,y:this.owner.y}};this.flagMartin=this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["flag-martin"],a)),this.flagChris=this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["flag-chris"],a)),this.flagMartin.state.set("onstart",!0),this.flagChris.state.set("onstart",!0),this.flagMartin.trigger("state-changed",this.flagMartin.state),this.flagChris.trigger("state-changed",this.flagChris.state)},"handle-logic":function(a){var b=Math.floor(Math.random(2));!this.used&&this.activated?(this.owner.trigger("brothers-in-endzone"),this.used=!0):this.used&&!this.activated&&(this.used=!1),(this.chris&&!this.martin||!this.chris&&this.martin)&&(this.chris&&!this.chrisPlayed?(this.owner.trigger("C-WAIT-"+b),this.chrisPlayed=!0):this.martin&&!this.martinPlayed&&(this.owner.trigger("M-WAIT-"+b),this.martinPlayed=!0)),this.martin?(this.flagMartin.state.set("up",!0),this.flagMartin.state.set("onstart",!1),this.flagMartin.triggerEvent("state-changed",this.flagMartin.state),this.martin=!1):this.flagMartin.state.get("up")&&(this.flagMartin.state.set("up",!1),this.flagMartin.triggerEvent("state-changed",this.flagMartin.state)),this.chris?(this.flagChris.state.set("up",!0),this.flagChris.state.set("onstart",!1),this.flagChris.trigger("state-changed",this.flagChris.state),this.chris=!1):this.flagChris.state.get("up")&&(this.flagChris.state.set("up",!1),this.flagChris.trigger("state-changed",this.flagChris.state)),this.chris=!1,this.martin=!1},occupied:function(a){"chris"===a.entity.type&&(this.chris=!0),"martin"===a.entity.type&&(this.martin=!0),this.chris&&this.martin?this.activate():(this.chris&&!this.martin||!this.chris&&this.martin)&&this.deactivate()}},methods:{activate:function(){this.activated=!0},deactivate:function(){this.activated=!1}}})}(),function(){return platypus.createComponentClass({id:"logic-map-selector",constructor:function(a){var b=window.localStorage.getItem("wk-level"),c=null;b?(c=b.greenSplit("-"),this.playerSkill=+c[c.length-1],c.recycle()):this.playerSkill=1,this.levels=a.levels,this.allLevels=null,this.selection=[0,1,2],this.playerData=JSON.parse(localStorage.getItem("player-data")),this.playerData||(this.playerData={levels:[]},localStorage.setItem("player-data",JSON.stringify(this.playerData))),platypus.game.kartKingdom&&platypus.game.kartKingdom.hasPowerUp&&platypus.game.kartKingdom.hasPowerUp("Rainforest")?this.bonusLevels=!0:this.bonusLevels=!1,this.levelDefinition=["openingEditor","level-1a","level-1b","level-1c","closingEditor"],this.sections=[],this.scene={layers:[{type:"jungle-a",properties:{levelPieces:{start:"openingEditor",filler1:"level-1a",filler2:"level-1b",filler3:"level-1c",end:"closingEditor"},bro:"martin",levelName:"Your New Level",levelTemplate:[["start","filler1","filler2","filler3","end"]]}},{type:"touch-interface-layer"},{type:"desktop-interface-layer"}]},this.sceneData={sections:this.levelDefinition,powers:{}}},events:{load:function(){var a=0,b=0,c=[],d=[],e=this.playerSkill;for(a=0;a<this.levels.length;a++)for(b=0;b<this.levels[a].length;b++)c.push(this.levels[a][b]),e>a||this.bonusLevels&&a>=12?d.push(!0):d.push(!1);this.allLevels=c,this.levels=d},"child-entity-added":function(a){this.sections[0]?this.sections[1]?this.sections[2]||(this.sections[2]=a.element,this.sections[2].style.webkitTransform="translate(0,-6em)",this.sections[2].style.mozTransform="translate(0,-6em)",this.sections[2].style.msTransform="translate(0,-6em)",this.sections[2].style.oTransform="translate(0,-6em)",this.sections[2].style.transform="translate(0,-6em)"):(this.sections[1]=a.element,this.sections[1].style.webkitTransform="translate(0,-3em)",this.sections[1].style.mozTransform="translate(0,-3em)",this.sections[1].style.msTransform="translate(0,-3em)",this.sections[1].style.oTransform="translate(0,-3em)",this.sections[1].style.transform="translate(0,-3em)"):(this.sections[0]=a.element,this.sections[0].style.webkitTransform="translate(0,0)",this.sections[0].style.mozTransform="translate(0,0)",this.sections[0].style.msTransform="translate(0,0)",this.sections[0].style.oTransform="translate(0,0)",this.sections[0].style.transform="translate(0,0)")},"link-entity":function(){this.owner.trigger("set-scene",this.scene),this.owner.trigger("set-persistent-scene-data",this.sceneData)},"scene-loaded":function(a){a&&a.sections?this.owner.triggerEvent("load-level",{sections:[a.sections[1],a.sections[2],a.sections[3]]}):this.bonusLevels?this.owner.triggerEvent("load-level",{sections:[53,54,55]}):this.owner.triggerEvent("load-level",{sections:[0,1,2]}),this.owner.trigger("instructions")},"load-level":function(a){var b=0;for(a.title&&(this.scene.layers[0].properties.levelName=a.title),a.segments&&(a=a.segments),b=0;b<a.sections.length;b++)this.set(b,a.sections[b])},up0:function(){this.scene.layers[0].properties.levelName="Your New Level",this.up(0)},down0:function(){this.scene.layers[0].properties.levelName="Your New Level",this.down(0)},up1:function(){this.scene.layers[0].properties.levelName="Your New Level",this.up(1)},down1:function(){this.scene.layers[0].properties.levelName="Your New Level",this.down(1)},up2:function(){this.scene.layers[0].properties.levelName="Your New Level",this.up(2)},down2:function(){this.scene.layers[0].properties.levelName="Your New Level",this.down(2)},"save-button-pressed":function(){this.owner.trigger("stop-audio"),this.saveLevel()},"load-button-pressed":function(){this.owner.trigger("stop-audio"),this.playerData.levels.length?(this.dialog&&this.owner.parent.removeEntity(this.dialog),this.dialog=this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["level-load-dialog"],{properties:{levels:this.playerData.levels}}))):this.owner.trigger("no-levels")}},methods:{set:function(a,b){var c=0,d=0,e=null;if("string"==typeof b)for(c=0;c<this.allLevels.length;c++)if(b===this.allLevels[c]){b=+c;break}for(this.selection[a]=b,this.sections[a].style.webkitTransform="translate(0,"+3*-b+"em)",this.sections[a].style.mozTransform="translate(0,"+3*-b+"em)",this.sections[a].style.msTransform="translate(0,"+3*-b+"em)",this.sections[a].style.oTransform="translate(0,"+3*-b+"em)",this.sections[a].style.transform="translate(0,"+3*-b+"em)",this.levelDefinition[a+1]=this.allLevels[b],this.selection[0]>=53||this.selection[1]>=53||this.selection[2]>=53?this.scene.layers[0].type="jungle-d":this.selection[0]<17?this.scene.layers[0].type="jungle-a":this.selection[0]<34?this.scene.layers[0].type="jungle-b":this.scene.layers[0].type="jungle-c",d=1;d<this.levelDefinition.length-1;d++)this.scene.layers[0].properties.levelPieces["filler"+d]=this.levelDefinition[d];this.owner.trigger("set-scene",this.scene),e=Math.max(this.selection[0],this.selection[1],this.selection[2]),e>3||this.playerSkill>1?(this.sceneData.powers["has-rhino"]=!0,e>12||this.playerSkill>3?(this.sceneData.powers["has-monkey"]=!0,e>21||this.playerSkill>5?(this.sceneData.powers["has-kangaroo"]=!0,e>25||this.playerSkill>6?(this.sceneData.powers["has-aardvark"]=!0,e>34||this.playerSkill>8?(this.sceneData.powers["has-basilisk"]=!0,e>38||this.playerSkill>9?this.sceneData.powers["has-draco"]=!0:this.sceneData.powers["has-draco"]=!1):(this.sceneData.powers["has-basilisk"]=!1,this.sceneData.powers["has-draco"]=!1)):(this.sceneData.powers["has-aardvark"]=!1,this.sceneData.powers["has-basilisk"]=!1,this.sceneData.powers["has-draco"]=!1)):(this.sceneData.powers["has-kangaroo"]=!1,this.sceneData.powers["has-aardvark"]=!1,this.sceneData.powers["has-basilisk"]=!1,this.sceneData.powers["has-draco"]=!1)):(this.sceneData.powers["has-monkey"]=!1,this.sceneData.powers["has-kangaroo"]=!1,this.sceneData.powers["has-aardvark"]=!1,this.sceneData.powers["has-basilisk"]=!1,this.sceneData.powers["has-draco"]=!1)):(this.sceneData.powers["has-rhino"]=!1,this.sceneData.powers["has-monkey"]=!1,this.sceneData.powers["has-kangaroo"]=!1,this.sceneData.powers["has-aardvark"]=!1,this.sceneData.powers["has-basilisk"]=!1,this.sceneData.powers["has-draco"]=!1),this.owner.trigger("set-persistent-scene-data",this.sceneData)},down:function(a){for(var b=this.selection[a];!this.levels[b]||b===this.selection[0]||b===this.selection[1]||b===this.selection[2];)b=(b+1)%this.levels.length;this.set(a,b)},up:function(a){for(var b=this.selection[a];!this.levels[b]||b===this.selection[0]||b===this.selection[1]||b===this.selection[2];)b=(b-1+this.levels.length)%this.levels.length;this.set(a,b)},saveLevel:function(a){var b="th",c="",d={title:"",segments:null};if(c+=this.playerData.levels.length+1,c.length<1||"1"!==c[c.length-2])switch(c[c.length-1]){case"1":b="st";break;case"2":b="nd";break;case"3":b="rd"}d.title="Your "+c+b+" Level",d.segments={sections:[this.levelDefinition[1],this.levelDefinition[2],this.levelDefinition[3]]},this.playerData.levels.push(d),localStorage.setItem("player-data",JSON.stringify(this.playerData)),this.dialog&&this.owner.parent.removeEntity(this.dialog),this.dialog=this.owner.parent.addEntity(new platypus.Entity(platypus.game.settings.entities["level-saved-dialog"])),this.scene.layers[0].properties.levelName=d.title}}})}(),function(){return platypus.createComponentClass({id:"logic-boulder",constructor:function(a){this.rolling=!1,this.v=0,this.initialV=a.initialV||20,this.distance=a.distance||192,this.time=this.distance/(this.initialV/2),this.f=this.initialV/this.time;var b=a.diameter||192,c=b*Math.PI;this.displacementRotationRatio=2*Math.PI/c,this.owner.rotation=0,this.rollDisplacement=0,this.rollTime=0,this.actualDisplacement=0,this.collisionThisTick=!1,this.collisionLastTick=!1},events:{"handle-logic":function(a){var b=a.delta/100,c=this.rollDisplacement,d=0,e=0;this.rolling&&(this.rollTime+=b,this.rollTime>=this.time?(this.rollTime=this.time,this.rollDisplacement=this.distance,this.rolling=!1):(e=this.initialV-this.rollTime*this.f,this.rollDisplacement=(this.initialV+e)/2*this.rollTime),d=this.rollDisplacement-c,this.actualDisplacement+=d*this.direction,this.owner.x+=d*this.direction,this.owner.rotation=this.actualDisplacement*this.displacementRotationRatio*(180/Math.PI)),this.collisionLastTick=this.collisionThisTick,this.collisionThisTick=!1},rammed:function(a){this.collisionThisTick=!0,!a.x||this.rolling||this.collisionLastTick||(this.rolling=!0,a.x<0?(this.direction=1,this.rollDisplacement=0,this.rollTime=0):a.x>0&&(this.direction=-1,this.rollDisplacement=0,this.rollTime=0),this.owner.trigger("jump",{pressed:!0}),this.owner.triggerEvent("rolled"))},"just-jumped":function(){this.owner.trigger("jump",{pressed:!1})},"hit-wall":function(a){a.x&&this.rolling&&(this.rolling=!1)}},methods:{destroy:function(){}}})}(),function(){"use strict";var a=include("platypus.StateMap");return platypus.createComponentClass({id:"set-level",constructor:function(a){},events:{"scene-loaded":function(b){var c=window.localStorage.getItem("wk-saved-game"),d=a.setUp("saved-game",!1,"rainforest-map",!1),e=null;if(c&&"false"!==c&&(c=JSON.parse(c),c.nextScene&&this.owner.trigger("set-scene",c.nextScene),this.owner.trigger("set-persistent-scene-data",c),d.set("saved-game",!0)),platypus.game.kartKingdom&&platypus.game.kartKingdom.hasPowerUp&&platypus.game.kartKingdom.hasPowerUp("Rainforest")&&d("rainforest-map",!0),d.get("saved-game")||d.get("rainforest-map"))for(e in this.owner.parent.entities)this.owner.parent.entities[e].trigger("state-changed",d);d.recycle()}},methods:{}})}(),function(){return platypus.createComponentClass({id:"logic-gate",constructor:function(a){this.owner.state.set("onstart",!0),this.owner.state.set("open",!1),this.owner.state.set("closed",!0),this.gateChanged="",this.openCount=0},events:{"handle-logic":function(a){this.openCount>0&&!this.owner.state.get("open")?(this.owner.state.set("onstart",!1),this.owner.state.set("open",!0),this.owner.triggerEvent("collide-off")):this.openCount<=0&&this.owner.state.get("open")&&(this.owner.state.set("onstart",!1),this.owner.state.set("open",!1),this.owner.triggerEvent("collide-on"))},"turn-on":function(){this.openCount++},"turn-off":function(){this.openCount--}}})}(),function(){return platypus.createComponentClass({id:"logic-tutorial-trigger",constructor:function(a){this.manager=null,this.id=this.owner.id||0,this.message={id:this.id,bro:null},this.remove=!1},events:{"prepare-logic":function(){this.remove&&this.owner.parent.removeEntity(this.owner)},"peer-entity-added":function(a){"tutorial"===a.type&&(this.manager=a)},"trigger-tutorial":function(a){this.manager&&(this.message.bro=a.entity.type,this.manager.trigger("cue-tutorial",this.message)),this.manager=null,this.remove=!0}},methods:{destroy:function(){this.manager=null}}})}(),function(){return platypus.createComponentClass({id:"logic-tutorial",constructor:function(a){this.tutorials=a.tutorials||{},this.currentTutorial=null,this.currentScene=0,this.messageReady=!1,this.newScene=!1,this.played={},this.replayLimit=3,this.tutorialsDisabled=!1,this.messageObj={message:"update",value:{text:"",side:"",character:"",expression:"",visibility:"hide"},debug:!1}},events:{"scene-loaded":function(a){a.tutorialsPlayed&&(this.played=a.tutorialsPlayed),a.sections&&(this.tutorialsDisabled=!0)},"handle-logic":function(a){var b=!1;this.newScene&&(this.newScene=!1,(this.currentTutorial[this.currentScene].audio||this.currentTutorial[this.currentScene].audioTouch)&&(b=platypus.supports.mobile&&this.currentTutorial[this.currentScene].audioTouch?this.currentTutorial[this.currentScene].audioTouch:this.currentTutorial[this.currentScene].audio,b&&!Array.isArray(b)&&this.owner.trigger(b))),this.messageReady&&(this.messageReady=!1,this.owner.trigger("to-tutorial-entities",this.messageObj))},"cue-tutorial":function(a){var b=a.id;this.tutorialsDisabled||!this.tutorials[b]||this.played[b]&&!(this.played[b]<this.replayLimit)||this.tutorials[b][0].forBro&&this.tutorials[b][0].forBro!==a.bro||(this.played[b]?this.played[b]++:this.played[b]=1,this.owner.trigger("update-played-tutorials",this.played),this.currentTutorial&&this.owner.trigger("stop-audio"),this.currentTutorial=this.tutorials[b],this.currentScene=0,this.owner.triggerEvent("show"))},"end-tutorial":function(){this.owner.triggerEvent("hide"),this.currentTutorial=null,this.newScene=!1,this.currentScene=0},show:function(){this.currentTutorial[this.currentScene].visibility="show",this.newScene=!0,this["ready-message"]()},hide:function(){this.currentTutorial[this.currentScene].visibility="hide",this["ready-message"]()},advance:function(){var a=this.currentScene+1;this.currentTutorial&&(a>=this.currentTutorial.length?this.owner.triggerEvent("end-tutorial"):(this.currentScene=a,this.owner.triggerEvent("show")))},"audio-clip-complete":function(a){}},methods:{"ready-message":function(){platypus.supports.mobile&&this.currentTutorial[this.currentScene].textTouch?this.messageObj.value.text=this.currentTutorial[this.currentScene].textTouch:this.messageObj.value.text=this.currentTutorial[this.currentScene].text,this.messageObj.value.side=this.currentTutorial[this.currentScene].side,this.messageObj.value.character=this.currentTutorial[this.currentScene].character,this.messageObj.value.expression=this.currentTutorial[this.currentScene].expression,this.messageObj.value.visibility=this.currentTutorial[this.currentScene].visibility,this.messageReady=!0},destroy:function(){this.tutorials=null,this.messageObj=null,this.played=null}}})}(),function(){return platypus.createComponentClass({id:"logic-gui-tutorial",constructor:function(a){this.textObj={text:""}},events:{update:function(a){a.text&&(this.textObj.text=a.text,this.owner.trigger("set-text",this.textObj)),a.visibility&&this.owner.trigger(a.visibility+"-window"),a.side&&this.owner.trigger("on-"+a.side),a.character&&this.owner.trigger("show-"+a.character),a.expression&&this.owner.trigger("express-"+a.expression)}},methods:{destroy:function(){this.textObj=null}}})}(),function(){return platypus.createComponentClass({id:"logic-monkey-final",constructor:function(a){this.monkeyTotal=0,this.fruitTotal=0,this.fruitList=["assorted-a","assorted-b","assorted-c","assorted-d","banana","mango","pear","prickly"],this.monkeyList=["monkey1","monkey2","monkey3","monkey4","monkey5","monkey6","monkey7","monkey8","monkey9"],this.messageObj={message:"",value:0,debug:!1},this.collected={},this.collected.powers={},this.countdownToShow=!0,this.showDelay=2e3,this.showCount=this.showDelay,this.shown=!1,this.dontHideTime=500,this.dontHideFruit=!1,this.dontHideFruitTimer=this.dontHideTime,this.dontHideMonkey=!1,this.dontHideMonkeyTimer=this.dontHideTime},events:{"child-entity-added":function(a){"fruit-pile"===a.type&&(this.collected.fruitGroups>this.fruitTotal?(a.state.set(this.fruitList[this.fruitTotal%8],!0),this.fruitTotal+=1):a.trigger("destroy-me")),"monkey-final"===a.type&&(this.collected.monkeyCount>this.monkeyTotal?(a.state.set(this.monkeyList[this.monkeyTotal%9],!0),this.monkeyTotal+=1):a.trigger("destroy-me"))},"world-loaded":function(a){this.collected.levelName&&this.owner.trigger("update-level-name",{text:this.collected.levelName})},"scene-loaded":function(a){a.monkeyCount?this.collected.monkeyCount=a.monkeyCount:this.collected.monkeyCount=36,a.fruitCount?(this.collected.fruitCount=a.fruitCount,this.collected.fruitGroups=Math.ceil(a.fruitCount/30)):(this.collected.fruitCount=360,this.collected.fruitGroups=12),a.powers&&(this.collected.powers=a.powers),this.owner.parent.layers[1].addEntity(new platypus.Entity(platypus.game.settings.entities["final-score-bar"],{properties:{innerHTML:"<div class='game-summary-title'>Final Results</div><div class='game-summary-fruit-count'>"+this.collected.fruitCount+" of 360 </div><div class='game-summary-fruit'></div><div class='game-summary-monkey-count'>"+this.collected.monkeyCount+" of 36 </div><div class='game-summary-monkey'></div>"}})),this.owner.trigger("action-fruit-hide"),this.owner.trigger("action-monkey-hide"),this.owner.levelName&&(this.collected.levelName=this.owner.levelName)},"go-home":function(){platypus.game.loadScene("menu")}}})}(),function(){return platypus.createComponentClass({id:"logic-monkey-guest",constructor:function(a){this.manager=null,this.state=this.owner.state,this.state.set("found",!1),this.found=!1,this.chris=null,this.martin=null},events:{"handle-logic":function(){this.found&&this.state.set("found",!0)},"peer-entity-added":function(a){"gui-manager"===a.type?(this.manager=a,this.manager.trigger("monkey-added",this.owner)):"chris"===a.type?this.chris=a:"martin"===a.type&&(this.martin=a)},"chris-moving":function(){this.chris.x>this.owner.x?this.owner.rotation=0:this.owner.rotation=180},"martin-moving":function(){this.martin.x>this.owner.x?this.owner.rotation=0:this.owner.rotation=180},"collect-monkey":function(){this.found||(this.manager&&this.manager.trigger("monkey-collected",this.owner),this.owner.trigger("sound-collect-gem"),this.found=!0)}},methods:{destroy:function(){this.manager=null,this.state=null}}})}(),function(){return platypus.createComponentClass({id:"logic-monkey-counter",constructor:function(a){var b=this.owner.state;this.state=b,this.count=0,b.set("icon-0-on",!1),b.set("icon-1-on",!1),b.set("icon-2-on",!1),b.set("icons-all-on",!1)},events:{"gui-monkey-collected":function(a){var b=this.state;this.count++,0===a?b.set("icon-0-on",!0):1===a?b.set("icon-1-on",!0):2===a&&b.set("icon-2-on",!0),3===this.count&&b.set("icons-all-on",!0),this.owner.trigger("state-changed",b)}},methods:{destroy:function(){this.state=null}}})}(),function(){return platypus.createComponentClass({id:"logic-fruit-icon",constructor:function(a){this.flip=!1,this.owner.state.set("boing0",!1),this.owner.state.set("boing1",!1)},events:{"gui-fruit-collected":function(){this.owner.stateChanged=!0,this.flip?(this.owner.state.set("boing0",!0),this.owner.state.set("boing1",!1)):(this.owner.state.set("boing0",!1),this.owner.state.set("boing1",!0)),this.owner.trigger("state-changed",this.owner.state),this.flip=!this.flip}}})}(),function(){"use strict";var a=["banana","mango","pineapple","pear","prickly","gouch"];return platypus.createComponentClass({id:"logic-fruit",constructor:function(a){this.manager=null,this.eat=!1,this.falling=!1,this.vy=0,this.grav=.004},events:{load:function(){
this.owner.state.set(a[Math.floor(6*Math.random())],!0),this.owner.y-=64,this.time=0},"prepare-logic":function(){this.eat&&this.owner.parent.removeEntity(this.owner)},"handle-logic":function(a){this.time+=a.delta/150,this.owner.rotation=.25*Math.cos(this.time)*(180/Math.PI),this.falling&&(this.vy+=this.grav*a.delta,this.owner.y+=this.vy)},"peer-entity-added":function(a){"gui-manager"===a.type&&(this.manager=a)},"collect-fruit":function(){this.manager&&this.manager.trigger("fruit-collected"),this.manager=null,this.eat=!0},"remove-from-level":function(){this.eat=!0},"hit-solid":function(a){1===a.y&&(this.falling=!1,this.vy=0)},"knocked-down":function(){this.falling||(this.falling=!0)}},methods:{destroy:function(){this.manager=null}}})}(),function(){"use strict";var a=["46df4a22-acf0-43ea-bf78-31277200d62e","603ff010-ffe0-444a-95bf-711caebd33a5","85cbd4e6-f004-4818-b3b3-d400f3802077","bfe99c7f-ff88-49cc-b0b8-297efb555e18","8eb3fc8d-37b1-490c-82ea-106f9420d9c8","04c9c7e7-7ee7-4748-baeb-811927eda38e","97220d28-daad-443b-8444-5df13b9d4b27","125b3a69-ec34-4cbe-9eb1-b88b8b329b7b","3f418116-ba7f-49c3-a5df-4680de40dd3e","e47f8413-7709-4ab1-9fb8-404c02065e73","cf307a82-2b91-43af-ac81-55891d7595fd","7c7aed81-076b-4e69-8526-29e658f284d8"];return platypus.createComponentClass({id:"logic-gui-manager",constructor:function(a){this.fruitSpots=0,this.fruitTotal=0,this.fruitCollected=0,this.monkeysCollected=0,this.monkeys=[],this.messageObj={message:"",value:0,debug:!1},this.collected={},this.collected.powers={},this.countdownToShow=!0,this.showDelay=0,this.showCount=this.showDelay,this.shown=!1,this.dontHideTime=2e3,this.dontHideTimeMonkey=4e3,this.dontHideFruit=!1,this.dontHideFruitTimer=this.dontHideTime,this.dontHideMonkey=!1,this.dontHideMonkeyTimer=this.dontHideTimeMonkey},events:{"peer-entity-added":function(a){var b=0,c=this.fruitTotal,d=!1;"fruit"===a.type&&(this.fruitSpots++,b=this.fruitSpots%15,d=Math.floor(this.fruitSpots/15)<Math.floor(c/10),c%=10,b=(10-c)/(15-b),!d&&b>Math.random()&&this.fruitTotal<30?this.fruitTotal++:a.trigger("remove-from-level"))},"world-loaded":function(a){this.messageObj.message="gui-fruit-totaled",this.messageObj.value=this.fruitTotal,this.owner.trigger("to-gui-entities",this.messageObj),this.time=(new Date).getTime(),this.collected.levelName&&this.owner.trigger("update-level-name",{text:this.collected.levelName})},"scene-loaded":function(a){a.monkeyCount&&(this.collected.monkeyCount=a.monkeyCount),a.fruitCount&&(this.collected.fruitCount=a.fruitCount),a.powers?this.collected.powers=a.powers:a.powers=this.collected.powers,platypus.game.kartKingdom&&platypus.game.kartKingdom.hasPowerUp&&(platypus.game.kartKingdom.hasPowerUp("Hummingbird")?this.collected.powers["has-macaw"]=!0:this.collected.powers["has-macaw"]=!1,platypus.game.kartKingdom.hasPowerUp("Binoculars")?this.collected.powers["has-spotter"]=!0:this.collected.powers["has-spotter"]=!1),this.owner.parent.nextLevel?this.collected.nextScene=this.owner.parent.nextLevel:a.sections?(this.collected.sections=a.sections,this.collected.nextScene="level-editor"):this.collected.nextScene="menu",this.owner.parent.levelName&&(this.collected.levelName=this.owner.parent.levelName,a.sections?window.GA_obj&&window.GA_obj.trackEvent("Wild Kratts Monkey Mayhem","Level Begin: Custom Level"):window.GA_obj&&window.GA_obj.trackEvent("Wild Kratts Monkey Mayhem","Level Begin: "+this.collected.levelName))},"handle-logic":function(a){var b=a.delta;this.countdownToShow&&!this.shown?(this.showCount-=b,this.showCount<0&&(this.owner.trigger("action-stop"),this.shown=!0,this.dontHideFruit=!1,this.dontHideMonkey=!1)):this.countdownToShow||(this.showCount=this.showDelay,this.shown=!1,this.dontHideFruit&&this.dontHideFruitTimer>0?this.dontHideFruitTimer-=b:this.dontHideFruit&&(this.dontHideFruit=!1,this.owner.trigger("action-fruit-hide")),this.dontHideMonkey&&this.dontHideMonkeyTimer>0?this.dontHideMonkeyTimer-=b:this.dontHideMonkey&&(this.dontHideMonkey=!1,this.owner.trigger("action-monkey-hide")))},"update-gui":function(a){0===a?(this.owner.trigger("action-start"),this.countdownToShow=!1):1===a&&(this.countdownToShow=!0)},"monkey-added":function(a){this.monkeys.push(a),a.state.set("monkey"+this.monkeys.length,!0)},"fruit-collected":function(){this.messageObj.message="gui-fruit-collected",this.owner.trigger("to-gui-entities",this.messageObj),this.fruitCollected++,30===this.fruitCollected&&platypus.game.kartKingdom&&platypus.game.kartKingdom.event("450fae19-4e8f-41c4-87a0-b58af632ef36"),this.owner.trigger("action-fruit"),this.dontHideFruit=!0,this.dontHideFruitTimer=this.dontHideTime},"monkey-collected":function(a){var b=0;for(b=0;b<this.monkeys.length;b++)if(a===this.monkeys[b]){this.messageObj.message="gui-monkey-collected",this.messageObj.value=b,this.owner.trigger("to-gui-entities",this.messageObj);break}this.owner.trigger("action-monkey"),platypus.game.kartKingdom&&platypus.game.kartKingdom.event(["41b00190-f91b-4fb1-b33d-7a82b461e26a","fbd1026a-93b7-41cb-834f-bf0edd0dde8b","be520dfd-a2b8-4cc5-9afe-a57ce0029b02"][this.monkeysCollected]),this.monkeysCollected++,this.dontHideMonkey=!0,this.dontHideMonkeyTimer=this.dontHideTimeMonkey},"update-tutorial-data":function(a){this.collected.tutorialsPlayed=a},"get-collected":function(){var a=null,b="",c="";this.collected.monkeyCount||(this.collected.monkeyCount=0),this.collected.fruitCount||(this.collected.fruitCount=0),this.collected.monkeyCount+=this.monkeysCollected,this.collected.fruitCount+=this.fruitCollected,this.collected.levelMonkeyCount=this.monkeysCollected,this.collected.levelFruitCount=this.fruitCollected,this.collected.skill=(6e5-((new Date).getTime()-this.time)+2e3*this.fruitCollected+2e4*this.monkeysCollected)/48e4,window.localStorage.removeItem("skill"),window.localStorage.setItem("skill",this.collected.skill),this.collected.nextScene&&"level-editor"!==this.collected.nextScene&&"menu"!==this.collected.nextScene&&"scene-finale"!==this.collected.nextScene?(b=window.localStorage.getItem("wk-level"),b?(a=b.greenSplit("-"),b=a[a.length-1],a.recycle(),a=this.collected.nextScene.greenSplit("-"),c=a[a.length-1],a.recycle(),+c>+b&&(window.localStorage.removeItem("wk-level"),window.localStorage.setItem("wk-level",this.collected.nextScene))):(window.localStorage.removeItem("wk-level"),window.localStorage.setItem("wk-level",this.collected.nextScene)),window.localStorage.removeItem("wk-saved-game"),window.localStorage.setItem("wk-saved-game",JSON.stringify(this.collected))):"scene-finale"===this.collected.nextScene&&window.localStorage.removeItem("wk-saved-game"),this.owner.trigger("set-persistent-scene-data",this.collected)},"level-finished":function(){3!==this.monkeysCollected?(this.owner.trigger("show-monkey-check",this.monkeysCollected),this.owner.parent.trigger("pause-render"),this.owner.parent.trigger("pause-logic")):this.owner.triggerEvent("next-level")},"next-level":function(){var b=null,c=0;this.owner.triggerEvent("get-collected"),"level-editor"===this.collected.nextScene?window.GA_obj&&window.GA_obj.trackEvent("Wild Kratts Monkey Mayhem","Level End: Custom Level"):(window.GA_obj&&window.GA_obj.trackEvent("Wild Kratts Monkey Mayhem","Level End: "+this.collected.levelName),platypus.game.kartKingdom&&(b=this.collected.levelName.greenSplit(" "),b[1]&&(c=parseInt(b[1],10),c&&platypus.game.kartKingdom.event(a[c-1])),b.recycle())),this.owner.trigger("new-scene")},"go-home":function(){this.owner.trigger("set-scene","menu"),this.owner.trigger("new-scene")},"monkey-disc":function(){this.collected.powers["has-monkey"]=!0,platypus.game.kartKingdom&&platypus.game.kartKingdom.event("335e2ce0-7bd8-4522-a248-50628ac90774")},"aardvark-disc":function(){this.collected.powers["has-aardvark"]=!0,platypus.game.kartKingdom&&platypus.game.kartKingdom.event("c769d525-1691-4b2e-b2c1-6f30b70be878")},"basilisk-disc":function(){this.collected.powers["has-basilisk"]=!0,platypus.game.kartKingdom&&platypus.game.kartKingdom.event("2f43baf8-c6e3-4005-a47f-45410b3d2b86")},"kangaroo-disc":function(){this.collected.powers["has-kangaroo"]=!0,platypus.game.kartKingdom&&platypus.game.kartKingdom.event("f31aa028-ca5a-4ba1-9195-2af5f2f936e2")},"rhino-disc":function(){this.collected.powers["has-rhino"]=!0,platypus.game.kartKingdom&&platypus.game.kartKingdom.event("2539097c-65f4-4d58-8cd9-546e8c4e9d3d")},"draco-disc":function(){this.collected.powers["has-draco"]=!0,platypus.game.kartKingdom&&platypus.game.kartKingdom.event("efe691cf-43a4-45af-b9f4-38e7da1ddea8")}},methods:{destroy:function(){this.monkeys.length=0,this.collected.powers=null,this.collected=null,this.messageObj=null}}})}(),function(){return platypus.createComponentClass({id:"reactive-dom",constructor:function(a,b){var c=this.owner.state;this.state=c,c.set("show",!1),c.set("show-fast",!1),c.set("hide",!1)},events:{show:function(a){var b=this.state;b.set("show",!0),b.set("show-fast",!1),b.set("hide",!1)},showFast:function(a){var b=this.state;b.set("show",!1),b.set("show-fast",!0),b.set("hide",!1)},hide:function(a){var b=this.state;b.set("show",!1),b.set("show-fast",!1),b.set("hide",!0)}},methods:{destroy:function(){this.state=null}}})}(),function(){var a=function(a){return function(b){this.x=0,this.y=0,this.time=0,this.animation=a}};return platypus.createComponentClass({id:"render-dom-animator",constructor:function(b){this.elementName=b.element,this.element=document.getElementById(this.elementName),this.animation=null;var c=null;if(b.animationMap)for(c in b.animationMap)this.addEventListener(c,a(b.animationMap[c]))},events:{"handle-dom":function(a){this.animation&&(this.element?(this.time+=a.delta,this.time>this.animation.frames.length&&(this.time=0,this.x+=1,this.x>=this.animation.frames.columns&&(this.x=0,this.y+=1),this.y>=this.animation.frames.rows&&(this.y=0),this.element.style.background="url("+this.animation.image+") "+100*this.x/(this.animation.frames.columns-1)+"% "+100*this.y/(this.animation.frames.rows-1)+"% no-repeat",this.element.style.backgroundSize=this.animation.frames.columns+"00%")):this.element=document.getElementById(this.elementName))}}})}(),function(){var a=function(a,b){return function(){b.selectedIndex=a,b.selectedElement.style.top=b.elements[a].offsetTop+"px"}};return platypus.createComponentClass({id:"logic-level-load",constructor:function(a){this.levels=this.owner.levels,this.elements=[],this.selectedIndex=0},events:{"handle-dom-load":function(){var b=0,c=this.levels;for(b=0;b<c.length;b++)this.elements.push(this.owner.addComponent(new platypus.components["dom-element"](this.owner,{innerHTML:c[b].title,parent:"level-selector",onmouseup:"selected-"+b,ontouchend:"selected-"+b})).element),this.addEventListener("selected-"+b,a(b,this));this.selectedElement=this.owner.addComponent(new platypus.components["dom-element"](this.owner,{parent:"level-selector",className:"current-selection"})).element,this.owner.parent.triggerEvent("child-entity-updated",this.owner)},done:function(){this.owner.trigger("selected-level",this.levels[this.selectedIndex])}},methods:{}})}(),function(){return platypus.createComponentClass({id:"logic-home-check",constructor:function(a){},events:{show:function(){this.owner.trigger("show-window"),this.owner.trigger("C-INTERFACE-ARE-YOU-SURE"),platypus.game.currentScene.layers[0].trigger("pause-render"),platypus.game.currentScene.layers[0].trigger("pause-logic")},hide:function(){this.owner.trigger("hide-window"),this.owner.trigger("stop-audio"),platypus.game.currentScene.layers[0].trigger("unpause-render"),platypus.game.currentScene.layers[0].trigger("unpause-logic")}},methods:{destroy:function(){}}})}(),function(){return platypus.createComponentClass({id:"logic-monkey-check",constructor:function(a){this.textObj={text:""},this.count=5,this.text0="We invited",this.text1A=" one monkey",this.text1B=" two monkeys",this.text2=" to Grabsy's birthday party!",this.text3=" Do you want to go back and",this.text4A=" find the two missing monkeys",this.text4B=" find the last monkey",this.text4C=" invite the monkeys",this.text5=" or continue?",this.audioMsg={next:null}},events:{show:function(a){0===a?(this.textObj.text=this.text3+this.text4C+this.text5,this.owner.trigger("MONKEYS-ZERO")):1===a?(this.textObj.text=this.text0+this.text1A+this.text2+this.text3+this.text4A+this.text5,this.owner.trigger("MONKEYS-ONE")):(this.textObj.text=this.text0+this.text1B+this.text2+this.text3+this.text4B+this.text5,this.owner.trigger("MONKEYS-TWO")),this.owner.trigger("set-text",this.textObj),this.owner.trigger("show-window")},hide:function(){this.owner.trigger("hide-window"),this.owner.trigger("audio-stop"),platypus.game.currentScene.layers[0].trigger("unpause-render"),platypus.game.currentScene.layers[0].trigger("unpause-logic")}},methods:{destroy:function(){this.textObj=null}}})}(),function(){var a=.89*Math.PI;return platypus.createComponentClass({id:"ai-hummingbird",constructor:function(a){this.runningTime=0,this.offset=2*Math.PI*Math.random()},events:{load:function(){this.owner.trigger("move")},"handle-ai":function(b){this.runningTime+=b.delta/500,this.owner.trigger("set-angle",a*Math.sin(this.runningTime)+this.offset)}}})}(),function(){return platypus.createComponentClass({id:"ai-bee",constructor:function(a){this.nodes=[],this.pathId=this.owner.pathId||a.pathId||0,this.firstNode=this.owner.firstNode||a.firstNode||"a",this.targetChanged=!1,this.target=null},events:{"peer-entity-added":function(a){"bee-node"===a.type&&a.pathId===this.pathId&&(this.nodes.push(a),a.id===this.firstNode&&(this.target=a,this.targetChanged=!0))},"handle-ai":function(a){this.targetChanged&&(this.targetChanged=!1,this.owner.trigger("set-target",this.target))},"hit-node":function(a){var b=a.entity,c=0;if(b.id===this.target.id){for(this.target=null,c=0;c<this.nodes.length;c++)if(this.nodes[c].id===b.next){this.target=this.nodes[c];break}this.targetChanged=!0}}},methods:{destroy:function(){this.nodes=null}}})}(),function(){"use strict";return platypus.createComponentClass({id:"logic-game-button",constructor:function(a){this.state=this.owner.state,this.pressed=!1,this.wasPressed=this.pressed,this.sticky=a.sticky||!1,this.state.set("pressed",!1),this.initialPress=!0},events:{"handle-logic":function(a){var b=!1;this.sticky?this.pressed&&!this.wasPressed&&(this.state.set("pressed",!0),this.wasPressed=!0,this.owner.trigger("button-on"),this.owner.trigger("sound-pressed-button"),b=!0):(this.pressed!==this.wasPressed&&(this.pressed?(this.state.set("pressed",!0),this.owner.trigger("button-on"),this.owner.trigger("sound-pressed-button")):(this.state.set("pressed",!1),this.owner.trigger("button-off")),b=!0),this.wasPressed=this.pressed,this.pressed=!1),b&&this.owner.trigger("state-changed",this.state)},"button-pressed":function(){this.pressed=!0,this.initialPress&&(this.owner.trigger("initial-press"),this.initialPress=!1)}}})}(),function(){"use strict";return platypus.createComponentClass({id:"logic-bullet",constructor:function(a){var b=this;this.state=this.owner.state,this.stateName=a.state||"firing",this.entityClass=platypus.game.settings.entities[a.bullet],this.speed=a.speed||this.owner.speed||0,this.state.set(this.stateName,!1),this.bulletPosition={x:0,y:0,dx:0,dy:0},this.bulletProperties={properties:this.bulletPosition},this.offsetX=a.offsetX||0,this.offsetY=a.offsetY||0,this.firing=!1,a.message&&this.addEventListener(a.message,function(a){b.firing=!a||a.pressed!==!1})},events:{"handle-logic":function(a){var b=0,c=this.state;this.firing&&(this.bulletPosition.x=this.owner.x,this.bulletPosition.y=this.owner.y,b=this.offsetX,c.get("left")&&(b*=-1),this.bulletPosition.x+=b,b=this.offsetY,c.get("top")&&(b*=-1),this.bulletPosition.y+=b,this.speed&&(c.get("left")?this.bulletPosition.dx=-this.speed:c.get("right")?this.bulletPosition.dx=this.speed:c.get("left")||c.get("right")||(this.bulletPosition.dx=-this.speed)),this.owner.triggerEvent("fired",this.owner.parent.addEntity(new platypus.Entity(this.entityClass,this.bulletProperties)))),c.set(this.stateName,this.firing),this.firing=!1},fire:function(a){this.firing=!a||a.pressed!==!1}},methods:{destroy:function(){this.state=null}}})}(),function(){"use strict";return platypus.createComponentClass({id:"logic-collectable",constructor:function(a){this.got=!1,this.collectedMessage=this.owner.collectedMessage||a.collectedMessage||"collected",this.collectedMessageContents=this.owner.collectedContents||a.collectedContents||"",this.collectedAudio=this.owner.collectedAudio||a.collectedAudio||"collected-audio",this.startState=this.owner.startState||a.startState},events:{load:function(a){this.startState&&this.owner.state.set(this.startState,!0)},"prepare-logic":function(a){this.got&&this.owner.parent.removeEntity(this.owner)},collected:function(){this.got=!0,this.owner.triggerEvent(this.collectedAudio),this.owner.trigger(this.collectedMessage,this.collectedMessageContents)}}})}(),function(){"use strict";var a=function(a,b){return"string"==typeof a?function(c){b.trigger(a,c),c.preventDefault()}:Array.isArray(a)?function(c){var d=0;for(d=0;d<a.length;d++)b.trigger(a[d],c);c.preventDefault()}:function(c){b.trigger(a.event,a.message),c.preventDefault()}};return platypus.createComponentClass({id:"handler-dom",properties:{},publicProperties:{},constructor:function(b){var c="",d="",e=null,f=this;this.element=this.owner.element=document.createElement("div"),this.tickMessage={delta:0,element:f.element};for(e in platypus.supports)platypus.supports.hasOwnProperty(e)&&platypus.supports[e]&&(this.element.className+="supports-"+e+" ");this.rootElement=document.getElementById("content"),this.rootElement.appendChild(this.element),this.owner.element=this.element,this.element.style.fontSize=Math.round(this.rootElement.offsetWidth/20)+"px";for(c in b)if(b.hasOwnProperty(c))if("style"===c)for(d in b[c])b[c].hasOwnProperty(d)&&(this.element.style[d]=b[c][d]);else"type"!==c&&(0===c.indexOf("on")?this.element[c]=a(b[c],this.owner):this.element[c]=b[c]);this.handleChildren=!0},events:{"child-entity-added":function(a){var b=this;a.trigger("handle-dom-load",{element:b.element})},tick:function(a){this.tickMessage.delta=a.delta,this.owner.triggerEventOnChildren&&this.owner.triggerEventOnChildren("handle-dom",this.tickMessage)},resize:function(a){this.element.style.fontSize=Math.round(this.rootElement.offsetWidth/20)+"px"}},methods:{destroy:function(){this.rootElement.removeChild(this.element),this.owner.element=null,this.element=void 0}},publicMethods:{getElementById:function(a){var b=0,c=this.element.getElementsByTagName("*");for(b=0;b<c.length;b++)if(c[b].getAttribute("id")===a)return c[b];return document.getElementById(a)}}})}(),function(){"use strict";var a=function(a,b){return"string"==typeof a?function(c){b.trigger(a,c),c.preventDefault()}:Array.isArray(a)?function(c){var d=0;for(d=0;d<a.length;d++)b.trigger(a[d],c);c.preventDefault()}:function(c){b.trigger(a.event,a.message),c.preventDefault()}};return platypus.createComponentClass({id:"dom-element",constructor:function(b){var c="",d="",e=b.element||"div";this.domElementReadied=!1,this.updateClassName=b.updateClassName||!1,this.className="",this.state=this.owner.state,this.stateChange=!1,this.potentialParent=b.parent,this.handleRenderLoadMessage=null,this.element=document.createElement(e),this.owner.element||(this.owner.element=this.element),this.element.ondragstart=function(){return!1};for(c in b)if(b.hasOwnProperty(c))if("style"===c)for(d in b[c])b[c].hasOwnProperty(d)&&(this.element.style[d]=b[c][d]);else"type"===c&&"input"!==e||"element"===c||"parent"===c||"updateClassName"===c||"attributes"===c||"messageMap"===c||(0===c.indexOf("on")?this.element[c]=a(b[c],this.owner):(this.element[c]=b[c],"className"===c&&(this.className=b[c])));this.owner.className&&(this.className=this.element.className=this.owner.className),this.owner.innerHTML&&(this.element.innerHTML=this.owner.innerHTML)},events:{"handle-dom-load":function(a){this.readyDomElement(a)},"child-entity-added":function(a){this.handleRenderLoadMessage&&a.trigger("handle-dom-load",this.handleRenderLoadMessage)},"set-parent":function(a){this.parentElement&&this.parentElement.removeChild(this.element),this.parentElement=a,this.parentElement.appendChild(this.element)},"handle-logic":function(a){},"handle-dom":function(a){var b="",c=this.className,d=this.state,e=d.keys,f=e.length;if(this.readyDomElement(a),this.stateChange&&this.updateClassName){for(;f--;)b=e[f],d.get(b)&&(c+=" "+b);this.element.className=c,this.stateChange=!1}},"set-attribute":function(a){var b="";if(a.attribute)this.element.setAttribute(a.attribute,a.value);else for(b in a)a.hasOwnProperty(b)&&this.element.setAttribute(b,a[b])},"set-style":function(a){var b=null;if(a.attribute)this.element.style[a.attribute]=a.value;else for(b in a)a.hasOwnProperty(b)&&(this.element.style[b]=a[b])},"update-content":function(a){var b=a;b&&"string"==typeof b.text&&(b=b.text),"string"==typeof b&&b!==this.element.innerHTML&&(this.element.innerHTML=b)},"state-changed":function(a){a!==this.state&&this.state.update(a),this.stateChange=!0}},methods:{readyDomElement:function(){var a=function(a,b){var c=0,d=a.getElementsByTagName("*");for(c=0;c<d.length;c++)if(d[c].getAttribute("id")===b)return d[c];return document.getElementById(b)};return function(b){var c="",d=null;if(!this.domElementReadied&&(this.domElementReadied=!0,b.element&&(this.parentElement||(this.potentialParent?(this.parentElement=a(b.element,this.potentialParent),this.parentElement.appendChild(this.element)):(this.parentElement=b.element,this.parentElement.appendChild(this.element))),this.owner.triggerEventOnChildren))){d=this.handleRenderLoadMessage={};for(c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);d.element=this.element,this.owner.triggerEventOnChildren("handle-dom-load",d)}}}(),destroy:function(){this.parentElement&&(this.parentElement.removeChild(this.element),this.parentElement=void 0),this.owner.element===this.element&&(this.owner.element=void 0),this.element=void 0,this.state=null}}})}(),function(){"use strict";return platypus.createComponentClass({id:"initial-brother",properties:{bro:"martin"},publicProperties:{},constructor:function(a){},events:{"world-loaded":function(a){this.owner.triggerEvent("initial-become-"+this.bro)}},methods:{destroy:function(){}},publicMethods:{}})}(),function(){"use strict";var a=include("platypus.StateMap");return platypus.createComponentClass({id:"update-powers",constructor:function(a){},events:{"scene-loaded":function(b){var c=a.setUp(b.powers);this.owner.triggerEvent("update-state",c),c.recycle()}}})}(),function(){return platypus.createComponentClass({id:"logic-binoculars",constructor:function(a){this.bro=this.martin=this.chris=null,this.active=!1,this.animals=[],this.hiddens=[]},events:{"new-animal":function(a){this.animals.push(a),("croc"===a.type||"gecko"===a.type||"vulture"===a.type)&&this.hiddens.push(a)},"Find-that-creature!":function(){var a=0,b=this,c=null,d=null;if(this.active){if(this.bro){for(a=0;a<this.animals.length;a++){if(this.animals[a].x>this.bro.x){d=this.animals[a];break}c=this.animals[a]}d?c&&this.bro.x-c.x<d.x-this.bro.x&&(d=c):d=c,d&&this.owner.parent.trigger("follow",{mode:"locked",offsetY:-60,time:3e3,entity:d})}}else platypus.game.kartKingdom&&platypus.game.kartKingdom.usePowerUps&&platypus.game.kartKingdom.usePowerUps({Binoculars:1},function(){for(b.active=!0,a=0;a<b.hiddens.length;a++)b.hiddens[a].state.set("sit",!0),b.hiddens[a].triggerEvent("state-changed",b.hiddens[a].state);b.animals.sort(function(a,b){return a.x-b.x})})},"handle-logic":function(a){},"peer-entity-added":function(a){"chris"===a.type?(this.chris=a,a.state.get("player-focus")&&(this.bro=a)):"martin"===a.type&&(this.martin=a,a.state.get("player-focus")&&(this.bro=a))},"be-martin":function(){this.bro=this.martin,this.connected=!1},"be-chris":function(){this.bro=this.chris,this.connected=!1}}})}(),function(){var a=55e-5*Math.PI,b=2*Math.PI,c=180,d=.85;return platypus.createComponentClass({id:"ai-macaw",constructor:function(a){this.bro=this.martin=this.chris=null,this.active=!1,this.angle=0},events:{load:function(){},"Release-yon-macaw!":function(){var a=this;platypus.game.kartKingdom&&platypus.game.kartKingdom.usePowerUps&&platypus.game.kartKingdom.usePowerUps({Hummingbird:1},function(){a.active=!0})},"handle-logic":function(a){},"handle-ai":function(e){var f=null,g=d*e.delta;this.active&&(this.angle=(this.angle+e.delta*a)%b,f=new platypus.Vector2D(this.bro.x,this.bro.y-60,0),f.add(c*Math.cos(this.angle),c*Math.sin(this.angle)),f.subtractVector(this.owner),f.magnitude()>g?(f.normalize(),f.x*=g,f.y*=g):this.connected||(this.connected=!0),this.owner.x+=f.x,this.owner.y+=f.y,this.connected?this.owner.rotation=(this.angle+b/4)*(180/Math.PI):(Math.abs(this.bro.x-this.owner.x)<120&&Math.abs(this.bro.y-this.owner.y)<120&&(this.connected=!0),this.owner.rotation=f.direction()*(180/Math.PI),this.angle=this.owner.rotation*(Math.PI/180)-b/4))},"peer-entity-added":function(a){"chris"===a.type?(this.chris=a,a.state.get("player-focus")&&(this.bro=a)):"martin"===a.type&&(this.martin=a,a.state.get("player-focus")&&(this.bro=a))},"be-martin":function(){this.bro=this.martin,this.connected=!1},"be-chris":function(){this.bro=this.chris,this.connected=!1}}})}(),function(){return platypus.createComponentClass({id:"old-ai-chaser",constructor:function(a){this.target=null,this.piOverTwo=Math.PI/2,this.prevAngle=0,this.chasing=!0},events:{"handle-ai":function(){var a=0,b=0,c=0;this.target&&this.chasing?(this.owner.trigger("move"),a=0,b=this.target.x-this.owner.x,c=this.target.y-this.owner.y,0===b?c>0?a=this.piOverTwo:0>c?a=-this.piOverTwo:(a=this.prevAngle,this.owner.trigger("stop")):(a=Math.atan(c/b),0>b&&(a=Math.PI+a)),this.owner.trigger("set-angle",a),this.prevAngle=a):this.owner.trigger("stop")},"set-target":function(a){this.target=a},"start-chasing":function(){this.chasing=!0},"stop-chasing":function(){this.chasing=!1}},methods:{destroy:function(){this.target=null}}})}(),function(){return platypus.createComponentClass({id:"old-logic-angular-movement",constructor:function(a){this.angle=0,this.v=[0,0],this.maxV=this.owner.maxVelocity||a.maxVelocity||3,this.a=this.owner.acceleration||a.acceleration||.01,this.moving=!1,this.piOverTwo=Math.PI/2,this.visualOffset=a.visualOrientationOffset||0,this.owner.rotation=this.owner.rotation||this.visualOffset},events:{"handle-logic":function(a){var b=a.delta,c=0;this.moving&&(this.v[0]+=this.a*Math.cos(this.angle)*b,this.v[1]+=this.a*Math.sin(this.angle)*b,0===this.v[0]?c=this.v[1]>0?this.piOverTwo:this.v[1]<0?-this.piOverTwo:this.angle:(c=Math.atan(this.v[1]/this.v[0]),this.v[0]<0&&(c=Math.PI+c)),this.v[0]>=0?this.v[0]=Math.min(this.v[0],this.maxV*Math.cos(c)):this.v[0]=Math.max(this.v[0],this.maxV*Math.cos(c)),this.v[1]>=0?this.v[1]=Math.min(this.v[1],this.maxV*Math.sin(c)):this.v[1]=Math.max(this.v[1],this.maxV*Math.sin(c)),this.owner.x+=this.v[0]*b,this.owner.y+=this.v[1]*b,this.owner.rotation=(c+this.visualOffset)*(180/Math.PI))},"set-angle":function(a){this.angle=a},move:function(){this.moving=!0},stop:function(){this.moving=!1}}})}();